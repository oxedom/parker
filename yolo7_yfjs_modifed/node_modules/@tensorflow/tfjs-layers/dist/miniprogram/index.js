/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@tensorflow/tfjs-core")):"function"==typeof define&&define.amd?define(["exports","@tensorflow/tfjs-core"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).tf=t.tf||{},t.tf)}(this,(function(t,e){"use strict";function n(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,e}var r=n(e),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function o(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))}function s(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(l(arguments[e]));return t}var h="Add",p="BatchMatMul",f="BatchToSpaceND",d="Cast",g="Concat",y="Conv2D",v="Conv2DBackpropInput",m="Cosh",b="Cumsum",w="RealDiv",k="ExpandDims",x="Floor",S="FloorDiv",N="GatherV2",z="GreaterEqual",I="Identity",A="Maximum",T="Multiply",C="Pack",E="PadV2",F="Reshape",D="Reverse",L="Rsqrt",_="Select",O="Slice",R="Sinh",M="Sigmoid",B="Sqrt",P="SpaceToBatchND",U="SplitV",j="Tile",W="Transpose",V="Unpack",q="UnsortedSegmentSum",K="ZerosLike",G="Step",H=function(){function t(){}return t.prototype.refCount=function(t){return Z("refCount")},t.prototype.incRef=function(t){return Z("incRef")},t.prototype.timerAvailable=function(){return!0},t.prototype.time=function(t){return Z("time")},t.prototype.read=function(t){return Z("read")},t.prototype.readSync=function(t){return Z("readSync")},t.prototype.readToGPU=function(t,e){return Z("readToGPU")},t.prototype.numDataIds=function(){return Z("numDataIds")},t.prototype.disposeData=function(t,e){return Z("disposeData")},t.prototype.write=function(t,e,n){return Z("write")},t.prototype.move=function(t,e,n,r,i){return Z("move")},t.prototype.memory=function(){return Z("memory")},t.prototype.floatPrecision=function(){return Z("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.dispose=function(){return Z("dispose")},t}();function Z(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function J(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Y(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||nt(t)&&!n)for(var r=0;r<t.length;++r)Y(t[r],e,n);else e.push(t);return e}function X(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function $(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Q(t){return t%1==0}function tt(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function et(t,e){var n=e.length;return J((t=null==t?e.map((function(t,e){return e})):[].concat(t)).every((function(t){return t>=-n&&t<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t})),J(t.every((function(t){return Q(t)})),(function(){return"All values in axis param must be integers but got axis "+t})),t.map((function(t){return t<0?n+t:t}))}function nt(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function rt(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function it(t){return"string"==typeof t||t instanceof String}function at(t){return Array.isArray(t)?at(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":"number"==typeof t?"float32":it(t)?"string":function(t){return"boolean"==typeof t}(t)?"bool":"float32"}function ot(t){return!!(t&&t.constructor&&t.call&&t.apply)}function st(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function ut(t,e,n,r){void 0===r&&(r=!1);var i=new Array;if(1===e.length)for(var a=e[0]*(r?2:1),o=0;o<a;o++)i[o]=n[t+o];else{a=e[0];var s=e.slice(1),u=s.reduce((function(t,e){return t*e}))*(r?2:1);for(o=0;o<a;o++)i[o]=ut(t+o*u,s,n,r)}return i}function lt(t,e,n){if(void 0===n&&(n=!1),0===t.length)return e[0];var r=t.reduce((function(t,e){return t*e}))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error("["+t+"] does not match the input size "+e.length+(n?" for a complex tensor":"")+".");return ut(0,t,e,n)}function ct(t,e){for(var n=ht(t,e),r=0;r<n.length;r++)n[r]=1;return n}function ht(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function pt(t){return t&&t.then&&"function"==typeof t.then}var ft="tfjsflags",dt=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=gt,this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&(vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+".")),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.getAsync=function(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return t in this.flags?[2,this.flags[t]]:(e=this.flags,n=t,[4,this.evaluateFlag(t)]);case 1:return e[n]=r.sent(),[2,this.flags[t]]}}))}))},t.prototype.get=function(t){if(t in this.flags)return this.flags[t];var e=this.evaluateFlag(t);if(pt(e))throw new Error("Flag "+t+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[t]=e,this.flags[t]},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if("undefined"!=typeof this.global&&"undefined"!=typeof this.global.location&&"undefined"!=typeof this.global.location.search){var e=this.getQueryParams(this.global.location.search);if(ft in e)e.tfjsflags.split(",").forEach((function(e){var n=l(e.split(":"),2),r=n[0],i=n[1];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,i)}))}},t}();function gt(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return yt(e,n[0],n[1]),n.join("=")})),e}function yt(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function vt(){return bt}var mt,bt=null;function wt(){if(null==mt){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}mt=t}return mt}function kt(t,e){var n,r=(null==(n=wt())._tfGlobals&&(n._tfGlobals=new Map),n._tfGlobals);if(r.has(t))return r.get(t);var i=e();return r.set(t,i),r.get(t)}function xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn.apply(console,c(t))}var St=kt("kernelRegistry",(function(){return new Map})),Nt=kt("gradRegistry",(function(){return new Map}));function zt(t,e){var n=function(t,e){return e+"_"+t}(t,e);return St.get(n)}function It(t){return Nt.get(t)}function At(t){for(var e=St.entries(),n=[];;){var r=e.next(),i=r.done,a=r.value;if(i)break;var o=l(a,2),s=o[0],u=o[1];l(s.split("_"),1)[0]===t&&n.push(u)}return n}var Tt=Et,Ct=null;try{Ct=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function Et(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function Ft(t){return!0===(t&&t.__isLong__)}Et.prototype.__isLong__,Object.defineProperty(Et.prototype,"__isLong__",{value:!0}),Et.isLong=Ft;var Dt={},Lt={};function _t(t,e){var n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=Lt[t])?r:(n=Rt(t,(0|t)<0?-1:0,!0),i&&(Lt[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=Dt[t])?r:(n=Rt(t,t<0?-1:0,!1),i&&(Dt[t]=n),n)}function Ot(t,e){if(isNaN(t))return e?Kt:qt;if(e){if(t<0)return Kt;if(t>=jt)return Yt}else{if(t<=-Wt)return Xt;if(t+1>=Wt)return Jt}return t<0?Ot(-t,e).neg():Rt(t%Ut|0,t/Ut|0,e)}function Rt(t,e,n){return new Et(t,e,n)}Et.fromInt=_t,Et.fromNumber=Ot,Et.fromBits=Rt;var Mt=Math.pow;function Bt(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return qt;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Bt(t.substring(1),e,n).neg();for(var i=Ot(Mt(n,8)),a=qt,o=0;o<t.length;o+=8){var s=Math.min(8,t.length-o),u=parseInt(t.substring(o,o+s),n);if(s<8){var l=Ot(Mt(n,s));a=a.mul(l).add(Ot(u))}else a=(a=a.mul(i)).add(Ot(u))}return a.unsigned=e,a}function Pt(t,e){return"number"==typeof t?Ot(t,e):"string"==typeof t?Bt(t,e):Rt(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}Et.fromString=Bt,Et.fromValue=Pt;var Ut=4294967296,jt=Ut*Ut,Wt=jt/2,Vt=_t(1<<24),qt=_t(0);Et.ZERO=qt;var Kt=_t(0,!0);Et.UZERO=Kt;var Gt=_t(1);Et.ONE=Gt;var Ht=_t(1,!0);Et.UONE=Ht;var Zt=_t(-1);Et.NEG_ONE=Zt;var Jt=Rt(-1,2147483647,!1);Et.MAX_VALUE=Jt;var Yt=Rt(-1,-1,!0);Et.MAX_UNSIGNED_VALUE=Yt;var Xt=Rt(0,-2147483648,!1);Et.MIN_VALUE=Xt;var $t=Et.prototype;$t.toInt=function(){return this.unsigned?this.low>>>0:this.low},$t.toNumber=function(){return this.unsigned?(this.high>>>0)*Ut+(this.low>>>0):this.high*Ut+(this.low>>>0)},$t.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Xt)){var e=Ot(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=Ot(Mt(t,6),this.unsigned),a=this,o="";;){var s=a.div(i),u=(a.sub(s.mul(i)).toInt()>>>0).toString(t);if((a=s).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},$t.getHighBits=function(){return this.high},$t.getHighBitsUnsigned=function(){return this.high>>>0},$t.getLowBits=function(){return this.low},$t.getLowBitsUnsigned=function(){return this.low>>>0},$t.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Xt)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},$t.isZero=function(){return 0===this.high&&0===this.low},$t.eqz=$t.isZero,$t.isNegative=function(){return!this.unsigned&&this.high<0},$t.isPositive=function(){return this.unsigned||this.high>=0},$t.isOdd=function(){return 1==(1&this.low)},$t.isEven=function(){return 0==(1&this.low)},$t.equals=function(t){return Ft(t)||(t=Pt(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},$t.eq=$t.equals,$t.notEquals=function(t){return!this.eq(t)},$t.neq=$t.notEquals,$t.ne=$t.notEquals,$t.lessThan=function(t){return this.comp(t)<0},$t.lt=$t.lessThan,$t.lessThanOrEqual=function(t){return this.comp(t)<=0},$t.lte=$t.lessThanOrEqual,$t.le=$t.lessThanOrEqual,$t.greaterThan=function(t){return this.comp(t)>0},$t.gt=$t.greaterThan,$t.greaterThanOrEqual=function(t){return this.comp(t)>=0},$t.gte=$t.greaterThanOrEqual,$t.ge=$t.greaterThanOrEqual,$t.compare=function(t){if(Ft(t)||(t=Pt(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},$t.comp=$t.compare,$t.negate=function(){return!this.unsigned&&this.eq(Xt)?Xt:this.not().add(Gt)},$t.neg=$t.negate,$t.add=function(t){Ft(t)||(t=Pt(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,a=t.high>>>16,o=65535&t.high,s=t.low>>>16,u=0,l=0,c=0,h=0;return c+=(h+=i+(65535&t.low))>>>16,l+=(c+=r+s)>>>16,u+=(l+=n+o)>>>16,u+=e+a,Rt((c&=65535)<<16|(h&=65535),(u&=65535)<<16|(l&=65535),this.unsigned)},$t.subtract=function(t){return Ft(t)||(t=Pt(t)),this.add(t.neg())},$t.sub=$t.subtract,$t.multiply=function(t){if(this.isZero())return qt;if(Ft(t)||(t=Pt(t)),Ct)return Rt(Ct.mul(this.low,this.high,t.low,t.high),Ct.get_high(),this.unsigned);if(t.isZero())return qt;if(this.eq(Xt))return t.isOdd()?Xt:qt;if(t.eq(Xt))return this.isOdd()?Xt:qt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Vt)&&t.lt(Vt))return Ot(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,a=t.high>>>16,o=65535&t.high,s=t.low>>>16,u=65535&t.low,l=0,c=0,h=0,p=0;return h+=(p+=i*u)>>>16,c+=(h+=r*u)>>>16,h&=65535,c+=(h+=i*s)>>>16,l+=(c+=n*u)>>>16,c&=65535,l+=(c+=r*s)>>>16,c&=65535,l+=(c+=i*o)>>>16,l+=e*u+n*s+r*o+i*a,Rt((h&=65535)<<16|(p&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},$t.mul=$t.multiply,$t.divide=function(t){if(Ft(t)||(t=Pt(t)),t.isZero())throw Error("division by zero");var e,n,r;if(Ct)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Rt((this.unsigned?Ct.div_u:Ct.div_s)(this.low,this.high,t.low,t.high),Ct.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Kt:qt;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Kt;if(t.gt(this.shru(1)))return Ht;r=Kt}else{if(this.eq(Xt))return t.eq(Gt)||t.eq(Zt)?Xt:t.eq(Xt)?Gt:(e=this.shr(1).div(t).shl(1)).eq(qt)?t.isNegative()?Gt:Zt:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(Xt))return this.unsigned?Kt:qt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=qt}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),a=i<=48?1:Mt(2,i-48),o=Ot(e),s=o.mul(t);s.isNegative()||s.gt(n);)s=(o=Ot(e-=a,this.unsigned)).mul(t);o.isZero()&&(o=Gt),r=r.add(o),n=n.sub(s)}return r},$t.div=$t.divide,$t.modulo=function(t){return Ft(t)||(t=Pt(t)),Ct?Rt((this.unsigned?Ct.rem_u:Ct.rem_s)(this.low,this.high,t.low,t.high),Ct.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},$t.mod=$t.modulo,$t.rem=$t.modulo,$t.not=function(){return Rt(~this.low,~this.high,this.unsigned)},$t.and=function(t){return Ft(t)||(t=Pt(t)),Rt(this.low&t.low,this.high&t.high,this.unsigned)},$t.or=function(t){return Ft(t)||(t=Pt(t)),Rt(this.low|t.low,this.high|t.high,this.unsigned)},$t.xor=function(t){return Ft(t)||(t=Pt(t)),Rt(this.low^t.low,this.high^t.high,this.unsigned)},$t.shiftLeft=function(t){return Ft(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Rt(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Rt(0,this.low<<t-32,this.unsigned)},$t.shl=$t.shiftLeft,$t.shiftRight=function(t){return Ft(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Rt(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Rt(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},$t.shr=$t.shiftRight,$t.shiftRightUnsigned=function(t){if(Ft(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?Rt(this.low>>>t|e<<32-t,e>>>t,this.unsigned):Rt(32===t?e:e>>>t-32,0,this.unsigned)},$t.shru=$t.shiftRightUnsigned,$t.shr_u=$t.shiftRightUnsigned,$t.toSigned=function(){return this.unsigned?Rt(this.low,this.high,!1):this},$t.toUnsigned=function(){return this.unsigned?this:Rt(this.low,this.high,!0)},$t.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},$t.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},$t.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Et.fromBytes=function(t,e,n){return n?Et.fromBytesLE(t,e):Et.fromBytesBE(t,e)},Et.fromBytesLE=function(t,e){return new Et(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Et.fromBytesBE=function(t,e){return new Et(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var Qt=Tt||Object.assign(Object.create(null),Tt,{default:Tt});function te(t){return Qt.fromString(t,!0,16)}function ee(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Y(t)),vt().getBool("DEBUG")&&function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var n=new Uint8Array(t.length),r=0;r<n.length;++r)0!==Math.round(t[r])&&(n[r]=1);return n}throw new Error("Unknown data type "+e)}function ne(){return vt().platform.now()}function re(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",vt().platform.decode(t,e)}te("c3a5c85c97cb3127"),te("b492b66fbe98f273"),te("9ae16a3b2f90404f");var ie=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new ae)}return t.prototype.profileKernel=function(t,e,n){var r,i,a,o,s=function(){a=n()},l=ne();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();try{for(var c=u(a),h=c.next();!h.done;h=c.next()){h.value.dataSync()}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}o=Promise.resolve({kernelMs:ne()-l})}if(vt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(e){var n=a[e];n.data().then((function(e){!function(t,e,n){if("float32"!==e)return!1;for(var r=0;r<t.length;r++){var i=t[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(e,n.dtype,t)}))},f=0;f<a.length;f++)p(f);return{kernelName:t,outputs:a,inputs:e,timeMs:o.then((function(t){return t.kernelMs})),extraInfo:o.then((function(t){return null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""}))}},t.prototype.logKernelProfile=function(t){var e=this,n=t.kernelName,r=t.outputs,i=t.timeMs,a=t.inputs,o=t.extraInfo;r.forEach((function(t){Promise.all([t.data(),i,o]).then((function(r){e.logger.logKernelProfile(n,t,r[0],r[1],a,r[2])}))}))},t}();var ae=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,i,a){var o="number"==typeof r?tt(r+"ms",9):r.error,s=tt(t,25),u=e.rank,l=e.size,c=tt(e.shape.toString(),14),h="";for(var p in i){var f=i[p];if(null!=f){var d=f.shape||e.shape,g=d.length;h+=p+": "+g+"D "+(g>0?d:"")+" "}}console.log("%c"+s+"\t%c"+o+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+h+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function oe(t,e,n,r){var i=st(e),a=function(t,e,n,r){var i=X(e),a=r[r.length-1],o=new Array(a).fill(0),s=e.length,u="complex64"===n?ce(t):t;if(s>1)for(var l=0;l<i/a;l++)for(var c=l*a,h=0;h<a;h++)o[h]=Math.max(o[h],se(u[c+h],0,n).length);return o}(t,e,n,i),o=e.length,s=le(t,e,n,i,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map((function(t){return"    "+t})).join("\n")),u.join("\n")}function se(t,e,n){return tt(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":it(t)?"'"+t+"'":"bool"===n?ue(t):parseFloat(t.toFixed(7)).toString(),e)}function ue(t){return 0===t?"false":"true"}function le(t,e,n,r,i,a){void 0===a&&(a=!0);var o="complex64"===n?2:1,s=e[0],u=e.length;if(0===u)return"complex64"===n?[se(ce(t)[0],0,n)]:"bool"===n?[ue(t[0])]:[t[0].toString()];if(1===u){if(s>20){var l=3*o,h=Array.from(t.slice(0,l)),p=Array.from(t.slice((s-3)*o,s*o));return"complex64"===n&&(h=ce(h),p=ce(p)),["["+h.map((function(t,e){return se(t,i[e],n)})).join(", ")+", ..., "+p.map((function(t,e){return se(t,i[s-3+e],n)})).join(", ")+"]"]}return["["+("complex64"===n?ce(t):Array.from(t)).map((function(t,e){return se(t,i[e],n)})).join(", ")+"]"]}var f=e.slice(1),d=r.slice(1),g=r[0]*o,y=[];if(s>20){for(var v=0;v<3;v++){var m=(b=v*g)+g;y.push.apply(y,c(le(t.slice(b,m),f,n,d,i,!1)))}y.push("...");for(v=s-3;v<s;v++){m=(b=v*g)+g;y.push.apply(y,c(le(t.slice(b,m),f,n,d,i,v===s-1)))}}else for(v=0;v<s;v++){var b;m=(b=v*g)+g;y.push.apply(y,c(le(t.slice(b,m),f,n,d,i,v===s-1)))}var w=2===u?",":"";y[0]="["+y[0]+w;for(v=1;v<y.length-1;v++)y[v]=" "+y[v]+w;var k=",\n";for(v=2;v<u;v++)k+="\n";return y[y.length-1]=" "+y[y.length-1]+"]"+(a?"":k),y}function ce(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}!function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=X(t),null!=n){var i=n.length;J(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||function(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}(e,this.size),this.strides=st(t)}t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),J(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"}));var i=this.locToIndex(n);this.values[i]=t},t.prototype.get=function(){for(var t,e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];0===n.length&&(n=[0]);var i=0;try{for(var a=u(n),o=a.next();!o.done;o=a.next()){var s=o.value;if(s<0||s>=this.shape[i]){var l="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(l)}i++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}for(var c=n[n.length-1],h=0;h<n.length-1;++h)c+=this.strides[h]*n[h];return this.values[c]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return he().makeTensor(this.values,this.shape,this.dtype)}}();var he=null,pe=null;var fe=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=X(t),this.strides=st(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,pe.buffer(this.shape,this.dtype,t)]}}))}))},t.prototype.bufferSync=function(){return pe.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,lt(this.shape,t,"complex64"===this.dtype)]}}))}))},t.prototype.arraySync=function(){return lt(this.shape,this.dataSync(),"complex64"===this.dtype)},t.prototype.data=function(){return o(this,void 0,void 0,(function(){var t,e;return s(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=he().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map((function(t){return re(t)}))]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}}))}))},t.prototype.dataToGPU=function(t){return this.throwIfDisposed(),he().readToGPU(this.dataId,t)},t.prototype.dataSync=function(){this.throwIfDisposed();var t=he().readSync(this.dataId);if("string"===this.dtype)try{return t.map((function(t){return re(t)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,he().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}}))}))},t.prototype.dispose=function(){this.isDisposed||(he().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.print=function(t){return void 0===t&&(t=!1),pe.print(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),pe.clone(this)},t.prototype.toString=function(t){return void 0===t&&(t=!1),oe(this.dataSync(),this.shape,this.dtype,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),pe.cast(this,t)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),he().makeVariable(this,t,e,n)},t}();Object.defineProperty(fe,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}}),kt("Tensor",(function(){return fe}));var de,ge,ye,ve,me,be=function(t){function e(e,n,r,i){var a=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return a.trainable=n,a.name=r,a}return a(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!$(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");he().disposeTensor(this),this.dataId=t.dataId,he().incRef(this,null)},e.prototype.dispose=function(){he().disposeVariable(this),this.isDisposedInternal=!0},e}(fe);Object.defineProperty(be,Symbol.hasInstance,{value:function(t){return t instanceof fe&&null!=t.assign&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(de||(de={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(ge||(ge={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(ye||(ye={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(ve||(ve={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(me||(me={}));var we={float32:ve,int32:ge,bool:ye,complex64:me};function ke(t,e){if(t.dtype===e.dtype)return[t,e];var n=function(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return we[t][e]}(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function xe(t){var e=[];return Se(t,e,new Set),e}function Se(t,e,n){if(null!=t)if(t instanceof fe)e.push(t);else if(r=t,Array.isArray(r)||"object"==typeof r){var r,i=t;for(var a in i){var o=i[a];n.has(o)||(n.add(o),Se(o,e,n))}}}function Ne(t){return null!=t.kernelName}var ze=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(t){return t.name}))))}}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),Ie=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ze}return t.prototype.ready=function(){return o(this,void 0,void 0,(function(){var t,e,n;return s(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(xt(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return o(this,void 0,void 0,(function(){var e,n,r;return s(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ie(this.backendInstance),[2,!0]}}))}))},t.prototype.setupRegisteredKernels=function(){var t=this;At(this.backendName).forEach((function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)}))},t.prototype.disposeRegisteredKernels=function(t){var e=this;At(t).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])}))},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(!r||r instanceof H||"function"!=typeof r.then)return this.registry[t]=r,{success:!0,asyncInit:!1};var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<e.pendingBackendInitId)&&(e.registry[t]=n,e.pendingBackendInit=null,!0)})).catch((function(n){return i<e.pendingBackendInitId||(e.pendingBackendInit=null,xt("Initialization of backend "+t+" failed"),xt(n.stack||n.message)),!1}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}catch(e){return xt("Initialization of backend "+t+" failed"),xt(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority}))},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e),a=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,i,n.shape,n.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=Ae.runKernel(I,{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(function(t){return{x:function(){var e={x:t},n={dtype:"float32"};return Ae.runKernel(d,e,n)}}}),[],{}),e},t.prototype.runKernel=function(t,e,n){if(null==this.backendName&&this.backend,!(null!=zt(t,this.backendName)))throw new Error("Kernel '"+t+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(t){i+="complex64"===t.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-e-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t){var e,n,r,i=this,a=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var l=Ne(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ne(t)){var c=t.kernelName,h=t.inputs,p=t.attrs;null==this.backendName&&this.backend;var f=zt(c,this.backendName);J(null!=f,(function(){return"Cannot find registered kernel '"+c+"' for backend '"+i.backendName+"'"})),n=function(){var t=i.backend.numDataIds();r=f.kernelFunc({inputs:h,attrs:p,backend:i.backend});var e=Array.isArray(r)?r:[r];i.shouldCheckForMemLeaks()&&i.checkKernelForMemLeak(c,t,e);var n=e.map((function(t){if(null!=t.rank)return t;var e=t.dataId,n=t.shape,r=t.dtype;return i.makeTensorFromDataId(e,n,r)}));if(o){var s=i.getTensorsForGradient(c,h,n);a=i.saveTensorsForBackwardMode(s)}return n}}else{var d=t.forwardFunc,g=function(t){o&&(a=t.map((function(t){return i.keep(i.clone(t))})))};n=function(){var t=i.backend.numDataIds();r=i.tidy((function(){return d(i.backend,g)}));var e=Array.isArray(r)?r:[r];return i.shouldCheckForMemLeaks()&&i.checkKernelForMemLeak(l,t,e),e}}var y,v=t.inputs,m=t.attrs,b=Ne(t)?null:t.backwardsFunc;return this.scopedRun((function(){return i.state.kernelDepth++}),(function(){return i.state.kernelDepth--}),(function(){i.ENV.getBool("DEBUG")||i.state.profiling?(y=i.profiler.profileKernel(l,v,(function(){return n()})),i.ENV.getBool("DEBUG")&&i.profiler.logKernelProfile(y),e=y.outputs):e=n()})),o&&this.addTapeNode(l,v,e,b,a,m),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(v).map((function(t){return null!=v[t]?v[t].shape:null})),outputShapes:e.map((function(t){return t.shape})),kernelTimeMs:y.timeMs,extraInfo:y.extraInfo}),Array.isArray(r)?e:e[0]},t.prototype.saveTensorsForBackwardMode=function(t){var e=this;return t.map((function(t){return e.keep(e.clone(t))}))},t.prototype.getTensorsForGradient=function(t,e,n){var r=It(t);if(null!=r){var i=r.inputsToSave||[],a=r.outputsToSave||[],o=void 0;r.saveAllInputs?(J(Array.isArray(e),(function(){return"saveAllInputs is true, expected inputs to be an array."})),o=Object.keys(e).map((function(t){return e[t]}))):o=i.map((function(t){return e[t]}));var s=n.filter((function(t,e){return a[e]}));return o.concat(s)}return[]},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=t;"string"===n&&it(t[0])&&(i=t.map((function(t){return e=t,void 0===n&&(n="utf-8"),n=n||"utf-8",vt().platform.encode(e,n);var e,n})));var a=r.write(i,e,n),o=new fe(e,n,a,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=function(t){if(null==t)return 0;var e=0;return t.forEach((function(t){return e+=t.length})),e}(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},t.prototype.makeTensorFromDataId=function(t,e,n,r){var i=new fe(e,n=n||"float32",t,this.nextTensorId());return this.trackTensor(i,r),i},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));var i=new be(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.trackTensor=function(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*rt(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof be||this.track(t)},t.prototype.incRef=function(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)},t.prototype.removeDataId=function(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){var e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){var n=t.size*rt(t.dtype);this.state.numBytes-=n}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,a,o,l,h,p,f,d;return s(this,(function(s){switch(s.label){case 0:return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],r=this.state.activeProfile,[4,t()];case 1:r.result=s.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,c(this.state.activeProfile.kernels.map((function(t){return t.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,s.label=2;case 2:s.trys.push([2,8,9,10]),i=u(this.state.activeProfile.kernels),a=i.next(),s.label=3;case 3:return a.done?[3,7]:(o=a.value,l=o,[4,o.kernelTimeMs]);case 4:return l.kernelTimeMs=s.sent(),h=o,[4,o.extraInfo];case 5:h.extraInfo=s.sent(),s.label=6;case 6:return a=i.next(),[3,3];case 7:return[3,10];case 8:return p=s.sent(),f={error:p},[3,10];case 9:try{a&&!a.done&&(d=i.return)&&d.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}}))}))},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,i,a){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},u=It(t);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(t){return t=t.map((function(t,e){if(null==t){var r=n[e],i=ht(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return t})),r(t.length>1?t:t[0],i,a)}),this.state.activeTape.push(s)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=xe(t),r=new Set(n.map((function(t){return t.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(t){t.kept||t.scopeId!==o.id||e.track(t)}))},t.prototype.gradients=function(t,e,n,r){var i=this;if(void 0===r&&(r=!1),J(e.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",t)}));J(a instanceof fe,(function(){return"The result y returned by f() must be a tensor."}));var o=function(t,e,n){for(var r={},i={},a=0;a<e.length;a++)r[e[a].id]=!0;for(a=0;a<t.length;a++){var o=(d=t[a]).inputs;for(var s in o){for(var u=o[s],l=!1,c=0;c<e.length;c++)if(r[u.id]){d.outputs.forEach((function(t){return r[t.id]=!0})),l=!0,i[d.id]=!0;break}if(l)break}}var h={};h[n.id]=!0;var p={};for(a=t.length-1;a>=0;a--)for(o=(d=t[a]).inputs,c=0;c<d.outputs.length;c++)if(h[d.outputs[c].id]){for(var s in o)h[o[s].id]=!0,p[d.id]=!0;break}var f=[];for(a=0;a<t.length;a++){var d;if(i[(d=t[a]).id]&&p[d.id]){var g={};for(var s in d.inputs){var y=d.inputs[s];r[y.id]&&(g[s]=y)}var v=Object.assign({},d);v.inputs=g,v.outputs=d.outputs,f.push(v)}}return f}(this.state.activeTape,e,a);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var t,r,s={};s[a.id]=null==n?(t=a.shape,r=ct(X(t),"float32"),Ae.makeTensor(r,t,"float32")):n,function(t,e,n,r){for(var i=function(i){var a=e[i],o=[];if(a.outputs.forEach((function(e){var n=t[e.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.kernelName+".");var s=a.gradient(o),u=function(e){if(!(e in s))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(s)+".");var i=n((function(){return s[e]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+i.dtype+"'");var o=a.inputs[e];if(!$(i.shape,o.shape))throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input '"+e+"' has shape '"+i.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==t[o.id])t[o.id]=i;else{var u=t[o.id];t[o.id]=r(u,i),u.dispose()}};for(var l in a.inputs)u(l)},a=e.length-1;a>=0;a--)i(a)}(s,o,(function(t){return i.tidy(t)}),Te);var l=e.map((function(t){return s[t.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(t){var e,n;try{for(var r=u(t.saved),i=r.next();!i.done;i=r.next()){i.value.dispose()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}})),i.state.activeTape=null),{value:a,grads:l}}))},t.prototype.customGrad=function(t){var e=this;return J(ot(t),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];J(r.every((function(t){return t instanceof fe})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};r.forEach((function(t,e){a[e]=t}));var o=function(e,i){return J((n=t.apply(void 0,c(r,[i]))).value instanceof fe,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),J(ot(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value},s=function(t,e){var i=n.gradFunc(t,e),a=Array.isArray(i)?i:[i];J(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),J(a.every((function(t){return t instanceof fe})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(t,e){o[e]=function(){return t}})),o};return e.runKernelFunc({forwardFunc:o,backwardsFunc:s,inputs:a})}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.readToGPU=function(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)},t.prototype.time=function(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return e=ne(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=ne()-e,[2,n]}}))}))},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ze,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t}();Ie.nextTensorId=0,Ie.nextVariableId=0;var Ae=function(){var t=wt();if(null==t._tfengine){var e=new dt(t);t._tfengine=new Ie(e)}return function(t){bt=t}(t._tfengine.ENV),he=function(){return t._tfengine},t._tfengine}();function Te(t,e){var n={a:t,b:e};return Ae.runKernel(h,n)}function Ce(t,e){var n=t;if(nt(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||nt(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&vt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Ee(t,r,[]),r}function Ee(t,e,n){if(n=n||[],Array.isArray(t)||nt(t)){J(e.length>0,(function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),J(t.length===e[0],(function(){return"Element arr["+n.join("][")+"] should have "+e[0]+" elements, but has "+t.length+" elements"}));for(var r=e.slice(1),i=0;i<t.length;++i)Ee(t[i],r,n.concat(i))}else J(0===e.length,(function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+e[0]+" elements"}))}function Fe(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}}function De(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof fe)return Fe(r,t.dtype,e,n),t;var i=at(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Fe(r,i,e,n),null==t||!nt(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var a=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=Ce(t,i);nt(t)||Array.isArray(t)||(t=[t]);var s="string"!==i?ee(t,i):Y(t,[],!0);return Ae.makeTensor(s,o,i)}function Le(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map((function(t,i){return De(t,e+"["+i+"]",n,r)}))}function _e(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ae.startScope(n);try{var i=r.apply(void 0,c(t));return pt(i)&&console.error("Cannot return a Promise inside of tidy."),Ae.endScope(i),i}catch(t){throw Ae.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}var Oe=_e({cast_:function(t,e){var n=De(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},i={dtype:e};return Ae.runKernel(d,r,i)}});var Re=_e({mul_:function(t,e){var n,r=De(t,"a","mul"),i=De(e,"b","mul"),a={a:r=(n=l(ke(r,i),2))[0],b:i=n[1]};return Ae.runKernel(T,a)}});var Me=_e({step_:function(t,e){void 0===e&&(e=0);var n={x:De(t,"x","step")},r={alpha:e};return Ae.runKernel(G,n,r)}}),Be={kernelName:"Abs",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(t,Me(Oe(n,"float32"),-1))}}}};var Pe=_e({floorDiv_:function(t,e){var n,r=De(t,"a","floorDiv"),i=De(e,"b","floorDiv"),a={a:r=(n=l(ke(r,i),2))[0],b:i=n[1]};return Ae.runKernel(S,a)}});var Ue=_e({div_:function(t,e){var n,r=De(t,"a","div"),i=De(e,"b","div");if(r=(n=l(ke(r,i),2))[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return Pe(r,i);var a={a:r,b:i};return Ae.runKernel(w,a,{})}});var je=_e({neg_:function(t){var e={x:De(t,"x","neg")};return Ae.runKernel("Neg",e)}});function We(t,e,n,r){if(null==r&&(r=at(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!nt(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){!function(t){t.forEach((function(e){J(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."}))}))}(e);var i=X(e),a=X(n);J(i===a,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==X(e.slice(o));J(n[o]===e[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "}))}}return nt(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?ee(t,r):Y(t,[],!0),Ae.makeTensor(t,e,r)}function Ve(t,e){if((nt(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&nt(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return We(t,[],[],e)}var qe=_e({sqrt_:function(t){var e={x:De(t,"x","sqrt","float32")};return Ae.runKernel(B,e)}});var Ke=_e({square_:function(t){var e=De(t,"x","square");return Ae.runKernel("Square",{x:e},{})}});var Ge=_e({sub_:function(t,e){var n,r=De(t,"a","sub"),i=De(e,"b","sub"),a={a:r=(n=l(ke(r,i),2))[0],b:i=n[1]};return Ae.runKernel("Sub",a)}}),He={kernelName:"Acos",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){var e=Ke(Oe(n,"float32")),r=qe(Ge(Ve(1),e));return je(Ue(t,r))}}}},Ze={kernelName:"Acosh",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){var e=qe(Ge(Ke(Oe(n,"float32")),1));return Ue(t,e)}}}};function Je(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],a=e.length-r-1,o=e[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function Ye(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var a=t[t.length-i-1];null==a&&(a=1);var o=e[e.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(a)}}return n}var Xe=_e({reshape_:function(t,e){var n={x:De(t,"x","reshape","string_or_numeric")},r={shape:e};return Ae.runKernel(F,n,r)}});var $e=_e({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=De(t,"x","sum");"bool"===r.dtype&&(r=Oe(r,"int32"));var i={x:r},a={axis:e,keepDims:n};return Ae.runKernel("Sum",i,a)}}),Qe={kernelName:h,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ye(r.shape,i.shape);return{a:function(){var e=t,n=Je(r.shape,a);return n.length>0&&(e=$e(e,n)),Xe(e,r.shape)},b:function(){var e=t,n=Je(i.shape,a);return n.length>0&&(e=$e(e,n)),Xe(e,i.shape)}}}},tn={kernelName:"AddN",saveAllInputs:!0,gradFunc:function(t,e){var n={};return e.forEach((function(e,r){n[r]=function(){return t.clone()}})),n}};var en=_e({zerosLike_:function(t){var e={x:De(t,"x","zerosLike")};return Ae.runKernel(K,e)}}),nn={kernelName:"ArgMax",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return en(n)}}}},rn={kernelName:"ArgMin",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return en(n)}}}},an={kernelName:"Asin",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,qe(Ge(Ve(1),Ke(Oe(n,"float32")))))}}}};var on=_e({add_:function(t,e){var n,r=De(t,"a","add"),i=De(e,"b","add"),a={a:r=(n=l(ke(r,i),2))[0],b:i=n[1]};return Ae.runKernel(h,a)}}),sn={kernelName:"Asinh",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){var e=qe(on(Ve(1),Ke(Oe(n,"float32"))));return Ue(t,e)}}}},un={kernelName:"Atan2",inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ye(r.shape,i.shape);return{a:function(){var e=on(Ke(r),Ke(i)),n=Re(t,Ue(i,e)),o=Je(r.shape,a);return o.length>0&&(n=$e(n,o)),Xe(n,r.shape)},b:function(){var e=on(Ke(r),Ke(i)),n=je(Re(t,Ue(r,e))),o=Je(i.shape,a);return o.length>0&&(n=$e(n,o)),Xe(n,i.shape)}}}},ln={kernelName:"Atan",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,on(Ke(Oe(n,"float32")),1))}}}},cn={kernelName:"Atanh",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,Ge(Ve(1),Ke(Oe(n,"float32"))))}}}};function hn(t){var e=l(function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t),3),n=e[0],r=e[1],i=e[2];return 1===n&&1===r&&1===i}function pn(t,e){return hn(t)||hn(e)}function fn(t,e,n){if(null!=n){if("string"==typeof e)throw Error("Error in "+t+": pad must be an integer when using dimRoundingMode "+n+" but got pad "+e+".");if("number"==typeof e)J(Q(e),(function(){return"Error in "+t+": pad must be an integer when using dimRoundingMode "+n+" but got pad "+e+"."}));else{if("object"!=typeof e)throw Error("Error in "+t+": Unknown padding parameter: "+e);e.forEach((function(e){e.forEach((function(e){J(Q(e),(function(){return"Error in "+t+": pad must be an integer when using dimRoundingMode "+n+" but got pad "+e+"."}))}))}))}}}var dn=_e({avgPool3dGrad_:function(t,e,n,r,i,a){var o=De(t,"dy","avgPool3dGrad"),s=De(e,"input","avgPool3dGrad"),u=o,l=s,c=!1;4===s.rank&&(c=!0,u=Xe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=Xe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),J(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+u.rank+"."})),J(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+l.rank+"."})),fn("avgPool3dGrad",i,a);var h={dy:u,input:l},p={filterSize:n,strides:r,pad:i,dimRoundingMode:a},f=Ae.runKernel("AvgPool3DGrad",h,p);return c?Xe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),gn={kernelName:"AvgPool3D",inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.filterSize,a=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return dn(t,r,i,a,o,s)}}}};var yn=_e({avgPoolGrad_:function(t,e,n,r,i){var a=De(t,"dy","avgPoolGrad"),o=De(e,"input","avgPoolGrad");J(o.rank===a.rank,(function(){return"Rank of input ("+o.rank+") does not match rank of dy ("+a.rank+")"}));var s=o,u=a,l=!1;3===o.rank&&(l=!0,s=Xe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Xe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),J(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+u.rank+"."})),J(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+s.rank+"."}));var c={dy:u,input:s},h={filterSize:n,strides:r,pad:i},p=Ae.runKernel("AvgPoolGrad",c,h);return l?Xe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),vn={kernelName:"AvgPool",inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.filterSize,a=n.strides,o=n.pad;return{x:function(){return yn(t,r,i,a,o)}}}};var mn=_e({matMul_:function(t,e,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=De(t,"a","matMul"),o=De(e,"b","matMul"),s={a:a=(i=l(ke(a,o),2))[0],b:o=i[1]},u={transposeA:n,transposeB:r};return Ae.runKernel(p,s,u)}}),bn={kernelName:p,inputsToSave:["a","b"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return mn(t,a,!1,!1)},b:function(){return mn(t,i,!0,!1)}}:o&&!s?{a:function(){return mn(a,t,!1,!0)},b:function(){return mn(i,t,!1,!1)}}:{a:function(){return mn(a,t,!0,!0)},b:function(){return mn(t,i,!0,!0)}}:{a:function(){return mn(t,a,!1,!0)},b:function(){return mn(i,t,!0,!1)}}}};var wn=_e({spaceToBatchND_:function(t,e,n){var r=De(t,"x","spaceToBatchND");J(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),J(n.length===e.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length})),J(r.shape.reduce((function(t,r,i){return i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}));var i={x:r},a={blockShape:e,paddings:n};return Ae.runKernel(P,i,a)}}),kn={kernelName:f,gradFunc:function(t,e,n){var r=n.blockShape,i=n.crops;return{x:function(){return wn(t,r,i)}}}},xn={kernelName:"BroadcastTo",gradFunc:function(t,e,n){for(var r=n,i=r.inputShape,a=r.shape,o=Array.from(a),s=i.length-1;s>=0;s--)if(i[s]===a[s])o[s]=1;else if(1!==i[s])throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return $e(t,u,!0)}}}},Sn={kernelName:d,gradFunc:function(t){return{x:function(){return t.clone()}}}},Nn={kernelName:"Ceil",gradFunc:function(t){return{x:function(){return en(t)}}}};var zn=_e({greaterEqual_:function(t,e){var n,r=De(t,"a","greaterEqual","string_or_numeric"),i=De(e,"b","greaterEqual","string_or_numeric");r=(n=l(ke(r,i),2))[0],i=n[1],Ye(r.shape,i.shape);var a={a:r,b:i};return Ae.runKernel(z,a)}});var In=_e({lessEqual_:function(t,e){var n,r=De(t,"a","lessEqual","string_or_numeric"),i=De(e,"b","lessEqual","string_or_numeric");r=(n=l(ke(r,i),2))[0],i=n[1],Ye(r.shape,i.shape);var a={a:r,b:i};return Ae.runKernel("LessEqual",a)}});var An=_e({logicalAnd_:function(t,e){var n=De(t,"a","logicalAnd","bool"),r=De(e,"b","logicalAnd","bool");Ye(n.shape,r.shape);var i={a:n,b:r};return Ae.runKernel("LogicalAnd",i)}});var Tn=_e({clone_:function(t){var e={x:De(t,"x","clone","string_or_numeric")};return Ae.runKernel(I,e)}});var Cn=_e({broadcastTo_:function(t,e){var n=De(t,"broadcastTo","x"),r=n.shape;if(e.some((function(t){return!(t>0)||t%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var i=n.shape.slice();i.length<e.length;)i.unshift(1);n=Xe(n,i)}for(var a=n.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(a[s]===e[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");if(0===o.map((function(t,e){return t>1?e:-1})).filter((function(t){return t>=0})).length)return Tn(n);var u={x:n},l={reps:o};return Ae.runKernel(j,u,l)}});var En=_e({where_:function(t,e,n){var r=De(e,"a","where"),i=De(n,"b","where"),a=De(t,"condition","where","bool"),o=Ye(Ye(a.shape,r.shape),i.shape),s={condition:Cn(a,o),t:Cn(r,o),e:Cn(i,o)};return Ae.runKernel(_,s)}}),Fn={kernelName:"ClipByValue",inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.clipValueMin,a=n.clipValueMax;return{x:function(){return En(An(zn(r,i),In(r,a)),t,en(t))}}}},Dn={kernelName:"ComplexAbs",inputsToSave:["x"],gradFunc:Be.gradFunc};var Ln=_e({split_:function(t,e,n){void 0===n&&(n=0);var r={x:De(t,"x","split")},i={numOrSizeSplits:e,axis:n};return Ae.runKernel(U,r,i)}}),_n={kernelName:g,saveAllInputs:!0,gradFunc:function(t,e,n){var r=e.map((function(t){return t.shape})),i=et(n.axis,e[0].shape)[0],a=r.map((function(t){return t[i]}));return Ln(t,a,i).map((function(t){return function(){return t}}))}};var On=_e({conv2DBackpropFilter_:function(t,e,n,r,i,a,o){void 0===a&&(a="NHWC");var s=t;3===t.rank&&(s=Xe(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var u=e;3===u.rank&&(u=Xe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),J(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),J(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),J(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];J(l===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."})),J(c===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."})),fn("conv2dDerFilter",i,o);var h={x:s,dy:u},p={strides:r,pad:i,dataFormat:a,dimRoundingMode:o,filterShape:n};return Ae.runKernel("Conv2DBackpropFilter",h,p)}});var Rn=_e({conv2DBackpropInput_:function(t,e,n,r,i,a,o){void 0===a&&(a="NHWC"),J(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var s=t,u=e,l=!1;3===e.rank&&(l=!0,u=Xe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,t[0],t[1],t[2]]),J(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),J(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),J(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var c="NHWC"===a?s[3]:s[1],h="NHWC"===a?u.shape[3]:u.shape[1];J(c===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."})),J(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."})),fn("conv2dDerInput",i,o);var p={dy:u,filter:n},f={strides:r,pad:i,dataFormat:a,dimRoundingMode:o,inputShape:s},d=Ae.runKernel(v,p,f);return l?Xe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Mn={kernelName:y,inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return J(hn(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return Rn(i.shape,t,a,s,u,c)},filter:function(){return On(i,t,a.shape,s,u,c)}}}};var Bn=_e({conv2d_:function(t,e,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=De(t,"x","conv2d","float32"),u=De(e,"filter","conv2d","float32"),l=s,c=!1;3===s.rank&&(c=!0,l=Xe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),J(4===l.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."})),J(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),fn("conv2d",r,o);var h="NHWC"===i?l.shape[3]:l.shape[1];J(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),J(pn(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var p={x:l,filter:u},f={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o},d=Ae.runKernel(y,p,f);return c?Xe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Pn={kernelName:v,inputsToSave:["dy","filter"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return Bn(t,a,o,s,u,1,c)},filter:function(){return On(t,i,a.shape,o,s,u,c)}}}};var Un=_e({conv3DBackpropFilter_:function(t,e,n,r,i){var a=t;4===t.rank&&(a=Xe(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));var o=e;4===o.rank&&(o=Xe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),J(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),J(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),J(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),J(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),J(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s={x:a,dy:o},u={strides:r,pad:i,filterShape:n};return Ae.runKernel("Conv3DBackpropFilterV2",s,u)}});var jn=_e({conv3DBackpropInput_:function(t,e,n,r,i){J(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var a=t,o=e,s=!1;4===e.rank&&(s=!0,o=Xe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),a=[1,t[0],t[1],t[2],t[3]]);var u=a[4],l=o.shape[4];J(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),J(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),J(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),J(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),J(l===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."}));var c={dy:o,filter:n},h={pad:i,strides:r,inputShape:a},p=Ae.runKernel("Conv3DBackpropInputV2",c,h);return s?Xe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),Wn={kernelName:"Conv3D",inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=n.dilations,i=n.strides,a=n.pad;J(hn(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+r+"'"}));var o=l(e,2),s=o[0],u=o[1];return{x:function(){return jn(s.shape,t,u,i,a)},filter:function(){return Un(s,t,u.shape,i,a)}}}};var Vn=_e({sin_:function(t){var e={x:De(t,"x","sin","float32")};return Ae.runKernel("Sin",e)}}),qn={kernelName:"Cos",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(je(Vn(Oe(n,"float32"))),t)}}}};var Kn=_e({sinh_:function(t){var e={x:De(t,"x","sinh")};return Ae.runKernel(R,e)}}),Gn={kernelName:m,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(Kn(Oe(n,"float32")),t)}}}};function Hn(t,e){return function(t,e,n){for(var r=t.length+e.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(t[a++]):i.push(e[o++]);return i}(t,e.map((function(t){return 1})),e)}function Zn(t){return t.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]-e[1]})).map((function(t){return t[0]}))}var Jn=_e({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i={x:De(t,"x","cumsum")},a={axis:e,exclusive:n,reverse:r};return Ae.runKernel(b,i,a)}});var Yn=_e({transpose_:function(t,e){var n=De(t,"x","transpose");if(null==e&&(e=n.shape.map((function(t,e){return e})).reverse()),J(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."})),e.forEach((function(t){J(t>=0&&t<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e}))})),n.rank<=1)return n.clone();var r={x:n},i={perm:e};return Ae.runKernel(W,r,i)}}),Xn={kernelName:b,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.axis,a=n.exclusive,o=n.reverse;return{x:function(){var e=function(t,e){if(function(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((function(t){return n.push(t)})),n}([i],r.rank),n=Jn(t,i,a,!o);return null!=e&&(n=Yn(n,e)),n}}}};var $n=_e({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,i,a,o){void 0===a&&(a=[1,1]);var s=t;3===t.rank&&(s=Xe(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var u=e;3===u.rank&&(u=Xe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:r,pad:i,dimRoundingMode:o,dilations:a,filterShape:n};return Ae.runKernel("DepthwiseConv2dNativeBackpropFilter",l,c)}});var Qn=_e({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,i,a,o){void 0===a&&(a=[1,1]);var s=e,u=!1;3===e.rank&&(u=!0,s=Xe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:n},c={strides:r,pad:i,dimRoundingMode:o,dilations:a,inputShape:t},h=Ae.runKernel("DepthwiseConv2dNativeBackpropInput",l,c);return u?Xe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),tr={kernelName:"DepthwiseConv2dNative",inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=n.dilations,i=n.strides,a=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;J(hn(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"}));var u=l(e,2),c=u[0],h=u[1];return J(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank "+c.rank+"."})),J(4===h.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank "+h.rank+"."})),J(c.shape[3]===h.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+h.shape[2]+"."})),J(pn(i,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides "+i+" and dilations '"+s+"'."})),fn("depthwiseConv2d",a,o),{x:function(){return Qn(c.shape,t,h,i,a,s,o)},filter:function(){return $n(c,t,h.shape,i,a,s,o)}}}},er={kernelName:"Dilation2D",inputsToSave:["x","filter"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o={x:i,filter:a,dy:t},s={x:i,filter:a,dy:t};return{x:function(){return Ae.runKernel("Dilation2DBackpropInput",o,n)},filter:function(){return Ae.runKernel("Dilation2DBackpropFilter",s,n)}}}},nr={kernelName:"Elu",outputsToSave:[!0],gradFunc:function(t,e){var n={dy:t,y:l(e,1)[0]};return{x:function(){return Ae.runKernel("EluGrad",n)}}}};var rr=_e({exp_:function(t){var e={x:De(t,"x","exp")};return Ae.runKernel("Exp",e)}}),ir={kernelName:"Erf",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0],r=Re(rr(je(Ke(n))),2/Math.sqrt(Math.PI));return{x:function(){return Re(t,r)}}}},ar={kernelName:"Exp",outputsToSave:[!0],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(t,n)}}}},or={kernelName:k,inputsToSave:["input"],gradFunc:function(t,e){var n=l(e,1)[0];return{input:function(){return Xe(t,n.shape)}}}},sr={kernelName:"Expm1",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(t,rr(n))}}}},ur={kernelName:x,gradFunc:function(t){return{x:function(){return en(t)}}}},lr={kernelName:S,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ye(r.shape,i.shape);return{a:function(){var e=Ue(t,Oe(i,"float32")),n=Je(r.shape,a);return n.length>0?Xe($e(e,n),r.shape):e},b:function(){var e=Re(t,Oe(r,"float32")),n=Je(i.shape,a);n.length>0&&(e=Xe($e(e,n),i.shape));var o=Ke(i);return je(Ue(e,Oe(o,"float32")))}}}};var cr=_e({rsqrt_:function(t){var e={x:De(t,"x","rsqrt","float32")};return Ae.runKernel(L,e)}});var hr=_e({tile_:function(t,e){var n=De(t,"x","tile","string_or_numeric");J(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."}));var r={x:n},i={reps:e};return Ae.runKernel(j,r,i)}}),pr={kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(t,e,n){var r=n.varianceEpsilon,i=l(e,4),a=i[0],o=i[1],s=i[2],u=i[3],c=null==u?Ve(1):u,h=Je(o.shape,a.shape),p=[];if(1===o.rank){for(var f=0;f<a.shape.length-1;++f)p.push(a.shape[f]);p.push(1)}var d=Ge(a,o),g=Re(t,c),y=cr(on(s,Ve(r))),v=Re(Re(Re(y,y),y),Ve(-.5));return{x:function(){return 1===o.rank?Xe(Re(Re(t,hr(Xe(y,[1,1,1,o.shape[0]]),p)),c),a.shape):Xe(Re(Re(t,y),c),a.shape)},mean:function(){var t=Re(Re(y,Ve(-1)),g);return 1===o.rank&&(t=$e(t,h)),Xe(t,o.shape)},variance:function(){var t=Re(Re(v,d),g);return 1===o.rank&&(t=$e(t,h)),Xe(t,o.shape)},scale:function(){var e=Re(d,y),n=Re(t,e);return 1===o.rank&&(n=$e(n,h)),Xe(n,o.shape)},offset:function(){var e=t;return 1===o.rank&&(e=$e(e,h)),Xe(e,o.shape)}}}};var fr=_e({unsortedSegmentSum_:function(t,e,n){var r=De(t,"x","unsortedSegmentSum"),i=De(e,"segmentIds","unsortedSegmentSum","int32");J(Q(n),(function(){return"numSegments must be of dtype int"}));var a={x:r,segmentIds:i},o={numSegments:n};return Ae.runKernel(q,a,o)}}),dr={kernelName:N,inputsToSave:["x","indices"],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.axis,s=et(o,i.shape)[0];return{x:function(){var e=i.shape,n=a.size,r=e.slice(0,s),u=r.length,l=e.slice(o,e.length).slice(1),c=l.length,h=gr(0,u),p=gr(u+1,u+1+c),f=yr([r,[n],l]),d=Xe(t,f),g=Xe(a,[n]),y=yr([[u],h,p]),v=Yn(d,y),m=fr(v,g,i.shape[s]),b=Zn(y);return m=Yn(m,b)},indices:function(){return a}}}};function gr(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function yr(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var vr={kernelName:z,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1];return{a:function(){return en(r)},b:function(){return en(i)}}}},mr={kernelName:I,gradFunc:function(t){return{x:function(){return Oe(t,"float32")}}}},br={kernelName:"IsFinite",gradFunc:function(t){return{x:function(){return en(t)}}}},wr={kernelName:"IsInf",gradFunc:function(t){return{x:function(){return en(t)}}}},kr={kernelName:"IsNan",gradFunc:function(t){return{x:function(){return en(t)}}}};var xr=_e({greater_:function(t,e){var n,r=De(t,"a","greater","string_or_numeric"),i=De(e,"b","greater","string_or_numeric");r=(n=l(ke(r,i),2))[0],i=n[1],Ye(r.shape,i.shape);var a={a:r,b:i};return Ae.runKernel("Greater",a)}}),Sr={kernelName:"LeakyRelu",inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.alpha,a=xr(r,0);return{x:function(){return En(a,t,Re(t,i))}}}},Nr={kernelName:"Log1p",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,on(n,1))}}}},zr={kernelName:"Log",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,Oe(n,"float32"))}}}},Ir={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.axis;return{logits:function(){var e=rr(r);return Ge(t,Re($e(t,i,!0),e))}}}};var Ar=_e({localResponseNormalizationBackprop_:function(t,e,n,r,i,a,o){void 0===r&&(r=5),void 0===i&&(i=1),void 0===a&&(a=1),void 0===o&&(o=.5);var s={x:t,y:e,dy:n},u={depthRadius:r,bias:i,alpha:a,beta:o};return Ae.runKernel("LRNGrad",s,u)}}),Tr={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return Ar(i,a,t,o,s,u,c)}}}};var Cr=_e({equal_:function(t,e){var n,r=De(t,"a","equal","string_or_numeric"),i=De(e,"b","equal","string_or_numeric");r=(n=l(ke(r,i),2))[0],i=n[1],Ye(r.shape,i.shape);var a={a:r,b:i};return Ae.runKernel("Equal",a)}});function Er(t,e,n,r){return e.rank<n.rank&&(e=Xe(e,Hn(e.shape,r))),t.rank<n.rank&&(t=Xe(t,Hn(t.shape,r))),{x:function(){return Re(t,Oe(Cr(n,e),t.dtype))}}}var Fr={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=n.reductionIndices,i=e[0],a=Er(t,e[1],i,et(r,i.shape));return{x:function(){return a.x()}}}};var Dr=_e({less_:function(t,e){var n,r=De(t,"a","less","string_or_numeric"),i=De(e,"b","less","string_or_numeric");r=(n=l(ke(r,i),2))[0],i=n[1],Ye(r.shape,i.shape);var a={a:r,b:i};return Ae.runKernel("Less",a)}}),Lr={kernelName:A,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1];return{a:function(){return Re(t,Oe(zn(r,i),"float32"))},b:function(){return Re(t,Oe(Dr(r,i),"float32"))}}}};var _r=_e({maxPool3dGrad_:function(t,e,n,r,i,a,o){var s=De(t,"dy","maxPool3dGrad"),u=De(e,"input","maxPool3dGrad"),l=De(n,"output","maxPool3dGrad"),c=s,h=u,p=l,f=!1;4===u.rank&&(f=!0,c=Xe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=Xe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=Xe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),J(5===c.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+c.rank+"."})),J(5===h.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+h.rank+"."})),J(5===p.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+p.rank+"."})),fn("maxPool3dGrad",a,o);var d={dy:c,input:h,output:p},g={filterSize:r,strides:i,pad:a,dimRoundingMode:o},y=Ae.runKernel("MaxPool3DGrad",d,g);return f?Xe(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}}),Or={kernelName:"MaxPool3D",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return _r(t,i,a,o,s,u,c)}}}};var Rr=_e({maxPoolGrad_:function(t,e,n,r,i,a,o){var s=De(t,"dy","maxPoolGrad"),u=De(e,"input","maxPoolGrad"),l=De(n,"output","maxPoolGrad");J(u.rank===s.rank,(function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+s.rank+")"})),J(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+s.rank+"."})),J(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+u.rank+"."})),fn("maxPoolGrad",a,o);var c={dy:s,input:u,output:l},h={filterSize:r,strides:i,pad:a,dimRoundingMode:o};return Ae.runKernel("MaxPoolGrad",c,h)}}),Mr={kernelName:"MaxPool",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,2),i=r[0],a=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Rr(t,i,a,o,s,u)}}}};var Br=_e({complex_:function(t,e){var n,r,i,a=De(t,"real","complex"),o=De(e,"imag","complex");n=a.shape,r=o.shape,void 0===(i="real and imag shapes, "+a.shape+" and "+o.shape+", must match in call to tf.complex().")&&(i=""),J($(n,r),(function(){return i+" Shapes "+n+" and "+r+" must match"}));var s={real:a,imag:o};return Ae.runKernel("Complex",s)}});function Pr(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Pr(t,"float32"),r=Pr(t,"float32");return Br(n,r)}var i=ht(X(t),e);return Ae.makeTensor(i,t,e)}function Ur(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Ur(t,"float32"),r=Pr(t,"float32");return Br(n,r)}var i=ct(X(t),e);return Ae.makeTensor(i,t,e)}var jr={kernelName:"Mean",inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=et(n.axis,r.shape),a=X(function(t,e){for(var n=[],r=t.length,i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((function(e){return t[e]}))]}(r.shape,i)[1]);return{x:function(){var e=r.shape.slice();i.forEach((function(t){e[t]=1}));var n=Xe(t,e);return Ue(Re(n,Ur(r.shape,"float32")),a)}}}},Wr={kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(t,e,n){var r=n.axis,i=l(e,2),a=i[0],o=Er(t,i[1],a,et(r,a.shape));return{x:function(){return o.x()}}}},Vr={kernelName:"Minimum",inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1];return{a:function(){return Re(t,Oe(In(r,i),"float32"))},b:function(){return Re(t,Oe(xr(r,i),"float32"))}}}};var qr=_e({slice_:function(t,e,n){var r=De(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var i={x:r},a={begin:e,size:n};return Ae.runKernel(O,i,a)}}),Kr={kernelName:"MirrorPad",inputsToSave:["x"],gradFunc:function(t,e,n){var r=e[0],i=n.paddings.map((function(t){return t[0]}));return{x:function(){return qr(t,i,r.shape)}}}};var Gr=_e({floor_:function(t){var e={x:De(t,"x","floor","float32")};return Ae.runKernel(x,e)}}),Hr={kernelName:"Mod",inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ye(r.shape,i.shape);return{a:function(){var e=Je(r.shape,a);return e.length>0?Xe($e(t,e),r.shape):t},b:function(){var e=Re(t,je(Gr(Ue(r,i)))),n=Je(i.shape,a);return n.length>0?Xe($e(e,n),i.shape):e}}}},Zr={kernelName:T,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ye(r.shape,i.shape);return{a:function(){var e=Re(t,Oe(i,"float32")),n=Je(r.shape,a);return n.length>0?Xe($e(e,n),r.shape):e},b:function(){var e=Re(t,Oe(r,"float32")),n=Je(i.shape,a);return n.length>0?Xe($e(e,n),i.shape):e}}}},Jr={kernelName:"Neg",gradFunc:function(t){return{x:function(){return je(t)}}}},Yr={kernelName:"OneHot",inputsToSave:["indices"],gradFunc:function(t,e){var n=e[0];return{indices:function(){return Pr(n.shape,"float32")}}}},Xr={kernelName:"OnesLike",gradFunc:function(t){return{x:function(){return en(t)}}}};var $r=_e({unstack_:function(t,e){void 0===e&&(e=0);var n=De(t,"x","unstack","string_or_numeric");J(e>=-n.shape.length&&e<n.shape.length,(function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}));var r={value:n},i={axis:e};return Ae.runKernel(V,r,i)}}),Qr={kernelName:C,saveAllInputs:!0,gradFunc:function(t,e,n){var r=n.axis;return $r(t,r).map((function(t){return function(){return t}}))}},ti={kernelName:E,inputsToSave:["x"],gradFunc:function(t,e,n){var r=e[0],i=n.paddings.map((function(t){return t[0]}));return{x:function(){return qr(t,i,r.shape)}}}};var ei=_e({log_:function(t){var e={x:De(t,"x","log","float32")};return Ae.runKernel("Log",e)}});var ni=_e({pow_:function(t,e){var n,r=De(t,"base","pow"),i=De(e,"exp","pow"),a={a:r=(n=l(ke(r,i),2))[0],b:i=n[1]};return Ae.runKernel("Pow",a)}}),ri={kernelName:"Pow",inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(t,e){var n=l(e,3),r=n[0],i=n[1],a=n[2],o=r,s=i,u=Ye(o.shape,s.shape);return{a:function(){var e=Oe(s,"float32"),n=Re(t,Re(e,ni(o,Ge(e,Ve(1))))),r=Je(o.shape,u);return r.length>0&&(n=$e(n,r)),Xe(n,o.shape)},b:function(){var e=xr(o,0),n=En(e,ei(o),en(o)),r=Re(t,Re(a,n)),i=Je(s.shape,u);return i.length>0&&(r=$e(r,i)),Xe(r,s.shape)}}}},ii={kernelName:"Prelu",inputsToSave:["x","alpha"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=xr(r,0);return{x:function(){return En(a,t,Re(t,i))},alpha:function(){var e=En(a,en(t),Re(t,r)),n=Je(i.shape,t.shape);return n.length>0&&(e=$e(e,n)),Xe(e,i.shape)}}}},ai={kernelName:w,inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ye(r.shape,i.shape);return{a:function(){var e=Ue(t,Oe(i,"float32")),n=Je(r.shape,a);return n.length>0?Xe($e(e,n),r.shape):e},b:function(){var e=Re(t,Oe(r,"float32")),n=Je(i.shape,a);n.length>0&&(e=Xe($e(e,n),i.shape));var o=Ke(i);return je(Ue(e,Oe(o,"float32")))}}}},oi={kernelName:"Reciprocal",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,je(Ke(n)))}}}},si={kernelName:"Relu6",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0],r=Re(In(n,6),Me(n));return{x:function(){return Re(t,Oe(r,"float32"))}}}},ui={kernelName:"Relu",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(t,Oe(Me(n),"float32"))}}}},li={kernelName:F,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Xe(t,n.shape)}}}},ci={kernelName:"ResizeBilinear",inputsToSave:["images"],gradFunc:function(t,e,n){var r={dy:t,images:l(e,1)[0]};return{images:function(){return Ae.runKernel("ResizeBilinearGrad",r,n)}}}},hi={kernelName:"ResizeNearestNeighbor",inputsToSave:["images"],gradFunc:function(t,e,n){var r={dy:t,images:l(e,1)[0]};return{images:function(){return Ae.runKernel("ResizeNearestNeighborGrad",r,n)}}}};var pi=_e({reverse_:function(t,e){var n={x:De(t,"x","reverse")},r={dims:e};return Ae.runKernel(D,n,r)}}),fi={kernelName:D,gradFunc:function(t,e,n){var r=et(n.dims,t.shape);return{x:function(){return pi(t,r)}}}},di={kernelName:"Round",gradFunc:function(t){return{x:function(){return en(t)}}}},gi={kernelName:L,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return je(Ue(t,Re(ni(n,1.5),2)))}}}};var yi=_e({logicalNot_:function(t){var e={x:De(t,"x","logicalNot","bool")};return Ae.runKernel("LogicalNot",e)}}),vi={kernelName:_,inputsToSave:["condition"],gradFunc:function(t,e){var n=l(e,1)[0];return{condition:function(){return Oe(en(n),"float32")},t:function(){return Re(t,Oe(n,t.dtype))},e:function(){return Re(t,Oe(yi(n),t.dtype))}}}},mi={kernelName:"Selu",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){var e=xr(n,Ve(0)),r=Ve(1.7580993408473768),i=Ve(1.0507009873554805),a=Re(t,i),o=Re(Re(t,r),rr(Oe(n,"float32")));return En(e,a,o)}}}},bi={kernelName:M,outputsToSave:[!0],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(t,Re(n,Ge(Ve(1),n)))}}}},wi={kernelName:"Sign",gradFunc:function(t){return{x:function(){return en(t)}}}};var ki=_e({cos_:function(t){var e={x:De(t,"x","cos","float32")};return Ae.runKernel("Cos",e)}}),xi={kernelName:"Sin",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(ki(Oe(n,"float32")),t)}}}};var Si=_e({cosh_:function(t){var e={x:De(t,"x","cosh","float32")};return Ae.runKernel(m,e)}}),Ni={kernelName:R,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(Si(Oe(n,"float32")),t)}}}};var zi=_e({pad_:function(t,e,n){void 0===n&&(n=0);var r=De(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:n},a={x:r};return Ae.runKernel(E,a,i)}});var Ii={kernelName:O,inputsToSave:["x"],gradFunc:function(t,e,n){for(var r=l(e,1)[0],i=n.begin,a=n.size,o=r.shape,s=l(function(t,e,n){var r,i,a=t.shape.length;return(r="number"==typeof e?c([e],new Array(a-1).fill(0)):e.length<a?e.concat(new Array(a-e.length).fill(0)):e.slice()).forEach((function(t){J(-1!==t,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(a).fill(-1):"number"==typeof n?c([n],new Array(a-1).fill(-1)):n.length<a?n.concat(new Array(a-n.length).fill(-1)):n).map((function(e,n){return e>=0?e:(J(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+n+"."})),t.shape[n]-r[n])})),[r,i]}(r,i,a),2),u=s[0],h=s[1],p=[],f=0;f<t.rank;f++)p.push([u[f],o[f]-u[f]-h[f]]);return{x:function(){return zi(t,p)}}}},Ai={kernelName:"Softmax",outputsToSave:[!0],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.dim,a=Re(t,r);return{logits:function(){return Ge(a,Re($e(a,[i],true),r))}}}};var Ti=_e({sigmoid_:function(t){var e={x:De(t,"x","sigmoid","float32")};return Ae.runKernel(M,e)}}),Ci={kernelName:"Softplus",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(t,Ti(n))}}}};var Ei=_e({batchToSpaceND_:function(t,e,n){var r=De(t,"x","batchToSpaceND"),i=e.reduce((function(t,e){return t*e}));J(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),J(n.length===e.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length})),J(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}));var a={x:r},o={blockShape:e,crops:n};return Ae.runKernel(f,a,o)}}),Fi={kernelName:P,gradFunc:function(t,e,n){var r=n.blockShape,i=n.paddings;return{x:function(){return Ei(t,r,i)}}}};var Di=_e({concat_:function(t,e){void 0===e&&(e=0),J(t.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Le(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")})),1===n.length)return Tn(n[0]);var r=n,i={axis:e};return Ae.runKernel(g,r,i)}}),Li={kernelName:U,gradFunc:function(t,e,n){var r=n.axis;return{x:function(){return Di(t,r)}}}},_i={kernelName:B,inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,Re(qe(Oe(n,"float32")),2))}}}},Oi={kernelName:"Square",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(t,Re(Oe(n,"float32"),2))}}}},Ri={kernelName:"SquaredDifference",inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ve(2);return{a:function(){return Re(t,Re(a,Ge(r,i)))},b:function(){return Re(t,Re(a,Ge(i,r)))}}}},Mi={kernelName:G,gradFunc:function(t){return{x:function(){return en(t)}}}},Bi={kernelName:"Sub",inputsToSave:["a","b"],gradFunc:function(t,e){var n=l(e,2),r=n[0],i=n[1],a=Ye(r.shape,i.shape);return{a:function(){var e=t,n=Je(r.shape,a);return n.length>0&&(e=$e(e,n)),Xe(e,r.shape)},b:function(){var e=t,n=Je(i.shape,a);return n.length>0&&(e=$e(e,n)),Xe(je(e),i.shape)}}}},Pi={kernelName:"Sum",inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=r.shape.slice();et(n.axis,r.shape).forEach((function(t){i[t]=1}));var a=Xe(t,i),o=Re(a,Ur(r.shape,"float32"));return{x:function(){return o}}}},Ui={kernelName:"Tan",inputsToSave:["x"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Ue(t,Ke(ki(n)))}}}},ji={kernelName:"Tanh",outputsToSave:[!0],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return Re(Ge(Ve(1),Ke(n)),t)}}}},Wi={kernelName:j,inputsToSave:["x"],gradFunc:function(t,e,n){var r=l(e,1)[0],i=n.reps;return{x:function(){var e=en(r);if(1===r.rank)for(var n=0;n<i[0];++n)e=on(e,qr(t,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<i[0];++n)for(var a=0;a<i[1];++a)e=on(e,qr(t,[n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(var o=0;o<i[2];++o)e=on(e,qr(t,[n*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(o=0;o<i[2];++o)for(var s=0;s<i[3];++s)e=on(e,qr(t,[n*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return e}}}},Vi={kernelName:W,gradFunc:function(t,e,n){var r=Zn(n.perm);return{x:function(){return Yn(t,r)}}}};var qi=_e({stack_:function(t,e){void 0===e&&(e=0);var n=Le(t,"tensors","stack","string_or_numeric");J(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&J(e<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,i={axis:e};return Ae.runKernel(C,r,i)}}),Ki={kernelName:V,gradFunc:function(t,e,n){var r=n.axis;return{value:function(){return qi(t,r)}}}};var Gi=_e({expandDims_:function(t,e){void 0===e&&(e=0);var n=De(t,"x","expandDims","string_or_numeric");J(e<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},i={dim:e};return Ae.runKernel(k,r,i)}});var Hi=_e({gather_:function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i={x:De(t,"x","gather"),indices:De(e,"indices","gather","int32")},a={axis:n,batchDims:r};return Ae.runKernel(N,i,a)}});var Zi=_e({maximum_:function(t,e){var n,r=De(t,"a","maximum"),i=De(e,"b","maximum");r=(n=l(ke(r,i),2))[0],i=n[1],"bool"===r.dtype&&(r=Oe(r,"int32"),i=Oe(i,"int32")),Ye(r.shape,i.shape);var a={a:r,b:i};return Ae.runKernel(A,a)}});var Ji,Yi,Xi,$i,Qi,ta=[Be,He,Ze,Qe,tn,nn,rn,an,sn,un,ln,cn,gn,vn,bn,kn,xn,Sn,Nn,Fn,Dn,_n,Pn,Mn,Wn,qn,Gn,Xn,tr,er,ai,nr,ir,ar,or,sr,lr,ur,pr,dr,vr,mr,br,wr,kr,Sr,Nr,zr,Ir,Tr,Fr,Fr,Lr,Or,Mr,jr,Wr,Vr,Kr,Hr,Zr,Jr,Yr,Xr,Qr,ti,ti,ri,ii,oi,si,ui,li,ci,hi,fi,di,gi,vi,mi,bi,wi,xi,Ni,Ii,Ai,Ci,Fi,Fi,Li,Li,_i,Ri,Oi,Mi,Bi,Pi,Ui,ji,Wi,Vi,Ki,{kernelName:q,inputsToSave:["segmentIds"],gradFunc:function(t,e){var n=l(e,1)[0];return{x:function(){return function(t,e){for(var n=Zi(e,en(e)),r=Hi(t,n),i=zn(e,Ve(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=Gi(i,o+1);i=An(i,Ur(r.shape,"bool"));var s=en(r);return En(i,r,s)}(t,n)}}}},{kernelName:K,gradFunc:function(t){return{x:function(){return en(t)}}}}];try{for(var ea=u(ta),na=ea.next();!na.done;na=ea.next()){var ra=na.value;$i=void 0,$i=(Xi=ra).kernelName,Nt.has($i)&&vt().getBool("DEBUG")&&xt("Overriding the gradient for '"+$i+"'"),Nt.set($i,Xi)}}catch(t){Ji={error:t}}finally{try{na&&!na.done&&(Yi=ea.return)&&Yi.call(ea)}finally{if(Ji)throw Ji.error}}function ia(){return null==Qi&&(Qi=e.backend().epsilon()),Qi}var aa=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),oa=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),sa=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),ua=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),la=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error);function ca(t,e){if(Array.isArray(t)){for(var n=[],r=0;r<e;r++)n=n.concat(t);return n}return(n=new Array(e)).fill(t),n}function ha(t,e){if(!t)throw new la(e)}function pa(t,e){var n,r,i=0;try{for(var a=u(t),o=a.next();!o.done;o=a.next()){o.value===e&&i++}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}function fa(t){return 1===t.length?t[0]:t}function da(t){return Array.isArray(t)?t:[t]}function ga(t){var e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function ya(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,(function(t,e){return e.toUpperCase()}))}!function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}a(e,t)}(Error);var va={};function ma(t){if(null==t)return null;var e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function ba(t){var e,n;if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((function(t){return ba(t)}));else{var r=Object.keys(t);try{for(var i=u(r),a=i.next();!a.done;a=i.next()){var o=a.value,s=t[o];null!=s&&"object"==typeof s&&(Array.isArray(s)||"ndarray"!==s.type||"number"!=typeof s.value?ba(s):t[o]=s.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}}function wa(t,e,n,r,i){var a,o,s,c,h,p,f,d,g,y,v;if(void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r="object"),void 0===i&&(i=!1),"string"==typeof t){var m=t,b=void 0;if(m in n)b=n[m];else if(m in va)b=va[m];else if(null==(b=e[m]))throw new sa("Unknown "+r+": "+t+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return b}var w=t;if(null==w.className||null==w.config)throw new sa(r+": Improper config format: "+JSON.stringify(w)+".\n'className' and 'config' must set.");var k=w.className,x=void 0,S=void 0;if(k in n?(x=(a=l(n[k],2))[0],S=a[1]):k in va?(x=(o=l(va.className,2))[0],S=o[1]):k in e&&(x=(s=l(e[k],2))[0],S=s[1]),null==x)throw new sa("Unknown "+r+": "+k+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=S){var N={};try{for(var z=u(Object.keys(va)),I=z.next();!I.done;I=z.next()){N[D=I.value]=va[D]}}catch(t){c={error:t}}finally{try{I&&!I.done&&(h=z.return)&&h.call(z)}finally{if(c)throw c.error}}try{for(var A=u(Object.keys(n)),T=A.next();!T.done;T=A.next()){N[D=T.value]=n[D]}}catch(t){p={error:t}}finally{try{T&&!T.done&&(f=A.return)&&f.call(A)}finally{if(p)throw p.error}}w.config.customObjects=N;var C=Object.assign({},va);try{for(var E=u(Object.keys(n)),F=E.next();!F.done;F=E.next()){var D=F.value;va[D]=n[D]}}catch(t){d={error:t}}finally{try{F&&!F.done&&(g=E.return)&&g.call(E)}finally{if(d)throw d.error}}ba(w.config);var L=S(x,w.config,n,i);return va=Object.assign({},C),L}C=Object.assign({},va);try{for(var _=u(Object.keys(n)),O=_.next();!O.done;O=_.next()){D=O.value;va[D]=n[D]}}catch(t){y={error:t}}finally{try{O&&!O.done&&(v=_.return)&&v.call(_)}finally{if(y)throw y.error}}L=new x(w.config);return va=Object.assign({},C),L}function ka(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function xa(t){var e,n;if(null==t)return t;var r=[];try{for(var i=u(t),a=i.next();!a.done;a=i.next()){var o=a.value;-1===r.indexOf(o)&&r.push(o)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Sa(t){if(null==t)throw new sa("Invalid value in obj: "+JSON.stringify(t));for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function Na(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new sa(n+" is not a valid "+e+".  Valid values are "+t+" or null/undefined.")}function za(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),ha(n>=0),ha(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every((function(t){return typeof t===e}))}function Ia(t,n){Array.isArray(t)?(e.util.assert(t.length>0,(function(){return n+" is unexpectedly an empty array."})),t.forEach((function(t,e){return Ia(t,"element "+(e+1)+" of "+n)}))):e.util.assert(Number.isInteger(t)&&t>0,(function(){return"Expected "+n+" to be a positive integer, but got "+Aa(t)+"."}))}function Aa(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return Aa(t)})).join(",")+"]":"string"==typeof t?'"'+t+'"':""+t}function Ta(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}function Ca(t,n){return e.tidy((function(){return r.sqrt(r.sum(r.mul(t,t),n,!0))}))}var Ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getConfig=function(){return{}},e}(e.serialization.Serializable),Fa=function(t){function n(e){var n=t.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return a(n,t),n.prototype.apply=function(t){var n=this;return e.tidy((function(){var e=Ca(t,n.axis),i=r.clipByValue(e,0,n.maxValue);return r.mul(t,r.div(i,r.add(ia(),e)))}))},n.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},n}(Ea);Fa.className="MaxNorm",e.serialization.registerClass(Fa);var Da=function(t){function n(e){var n=t.call(this)||this;return n.defaultAxis=0,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return a(n,t),n.prototype.apply=function(t){var n=this;return e.tidy((function(){return r.div(t,r.add(ia(),Ca(t,n.axis)))}))},n.prototype.getConfig=function(){return{axis:this.axis}},n}(Ea);Da.className="UnitNorm",e.serialization.registerClass(Da);var La=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return r.relu(t)},e}(Ea);La.className="NonNeg",e.serialization.registerClass(La);var _a=function(t){function n(e){var n=t.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=e.minValue?e.minValue:n.defaultMinValue,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.rate=null!=e.rate?e.rate:n.defaultRate,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return a(n,t),n.prototype.apply=function(t){var n=this;return e.tidy((function(){var e=Ca(t,n.axis),i=r.add(r.mul(n.rate,r.clipByValue(e,n.minValue,n.maxValue)),r.mul(1-n.rate,e));return r.mul(t,r.div(i,r.add(ia(),e)))}))},n.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},n}(Ea);_a.className="MinMaxNorm",e.serialization.registerClass(_a);var Oa={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ra(t){return ma(t)}function Ma(t,n){return void 0===n&&(n={}),wa(t,e.serialization.SerializationMap.getMap().classNameMap,n,"constraint")}function Ba(t){return null==t?null:"string"==typeof t?Ma({className:t in Oa?Oa[t]:t,config:{}}):t instanceof Ea?t:Ma(t)}var Pa={__proto__:null,maxNorm:function(t){return new Fa(t)},unitNorm:function(t){return new Da(t)},nonNeg:function(){return new La},minMaxNorm:function(t){return new _a(t)}},Ua=["channelsFirst","channelsLast"],ja=["nearest","bilinear"],Wa=["valid","same","causal"],Va=["max","avg"],qa=["sum","mul","concat","ave"],Ka=new Map;function Ga(t){Na(Ua,"DataFormat",t)}function Ha(t){Na(Wa,"PaddingMode",t)}function Za(t){Na(Va,"PoolMode",t)}var Ja=[];function Ya(t,e){Ja.push(t);try{var n=e();return Ja.pop(),n}catch(t){throw Ja.pop(),t}}function Xa(t){if(!to(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===Ja.length?"":Ja.join("/")+"/")+t}function $a(t){if(!to(t))throw new Error("Not a valid tensor name: '"+t+"'");Ka.has(t)||Ka.set(t,0);var e=Ka.get(t);if(Ka.set(t,Ka.get(t)+1),e>0){var n=t+"_"+e;return Ka.set(n,1),n}return t}var Qa=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function to(t){return!!t.match(Qa)}function eo(t,e,n){null==e&&(e=0),null==n&&(n=t.length);for(var r=1,i=e;i<n;++i)r*=t[i];return r}function no(t){if(0===t.length)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,n=0;n<t.length;n++){var r=t[n];r<e&&(e=r)}return e}function ro(t){if(0===t.length)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,n=0;n<t.length;n++){var r=t[n];r>e&&(e=r)}return e}function io(t,e){if(e<t)throw new sa("end ("+e+") < begin ("+t+") is forbidden.");for(var n=[],r=t;r<e;++r)n.push(r);return n}function ao(t,e){return r.cast(t,e)}function oo(t,e){void 0===e&&(e=-1);var n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),r.reshape(t,n)}function so(t,n,i){return e.tidy((function(){switch(t.rank){case 1:return r.slice1d(t,n,i);case 2:return r.slice2d(t,[n,0],[i,t.shape[1]]);case 3:return r.slice3d(t,[n,0,0],[i,t.shape[1],t.shape[2]]);case 4:return r.slice4d(t,[n,0,0,0],[i,t.shape[1],t.shape[2],t.shape[3]]);case 5:return r.slice(t,[n,0,0,0,0],[i,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return r.slice(t,[n,0,0,0,0,0],[i,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new sa("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}))}function uo(t,n,i){return e.tidy((function(){switch(t.rank){case 1:return r.slice1d(t,n,i);case 2:return r.slice2d(t,[0,n],[t.shape[0],i]);case 3:return r.slice3d(t,[0,0,n],[t.shape[0],t.shape[1],i]);case 4:return r.slice4d(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],i]);default:throw new sa("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}}))}function lo(t,n,i,a){return e.tidy((function(){switch(t.rank){case 1:return r.slice1d(t,n,i);case 2:switch(a){case 1:return so(t,n,i);case 2:return uo(t,n,i);default:throw new sa("The axis is not within the rank of the tensor "+a)}case 3:switch(a){case 1:return so(t,n,i);case 2:return r.slice3d(t,[0,n,0],[t.shape[0],i,t.shape[2]]);case 3:return uo(t,n,i);default:throw new sa("The axis is not within the rank of the tensor "+a)}case 4:switch(a){case 1:return so(t,n,i);case 2:return r.slice4d(t,[0,n,0,0],[t.shape[0],i,t.shape[2],t.shape[3]]);case 3:return r.slice4d(t,[0,0,n,0],[t.shape[0],t.shape[1],i,t.shape[3]]);case 4:return uo(t,n,i);default:throw new sa("The axis is not within the rank of the tensor "+a)}default:throw new sa("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}}))}function co(t,e){var n;return void 0===e&&(e=-1),e<0&&(e=0!==(n=t[0].rank)?n:0),e===t[0].rank&&(e=-1),r.concat(t,e)}function ho(t,e){switch(t.rank){case 1:return r.concat1d([t,e]);case 2:return r.concat2d([t,e],0);case 3:return r.concat3d([t,e],0);case 4:return r.concat4d([t,e],0);default:throw new sa("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function po(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new sa("The length of input n ("+e.length+") does not match the number of dimensions in input x ("+t.rank+")");return r.tile(t,e)}function fo(t,e,n,i,a){return void 0===e&&(e=0),void 0===n&&(n=1),r.randomNormal(t,e,n,i,a)}function go(t,e,n,i){if(t.rank<2||e.rank<2)throw new ua("dot requires both inputs to be rank >= 2 but got x shape = "+t.shape+" and y shape = "+e.shape);if(e.rank>=3&&t.shape.slice(-1)[0]!==(p=e.shape.slice(-2)[0]))throw new ua("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+t.shape+" and  y shape = "+e.shape);if(2===t.rank&&2===e.rank){var a=!1,o=!1;return r.fused.matMul({a:t,b:e,transposeA:a,transposeB:o,bias:i?mo(t.rank,i,"channelsLast"):null,activation:n})}var s=t.shape.slice(),u=s.pop();t=r.reshape(t,[-1,u]);var l=e.shape.slice(),h=l.pop(),p=l.pop(),f=c(l,[h]),d=Array.from({length:e.rank},(function(t,n){return 0===n?e.rank-2:n<=e.rank-2?n-1:n}));e=r.reshape(r.transpose(e,d),[p,-1]);var g=c(s,f);a=!1,o=!1;return r.reshape(r.fused.matMul({a:t,b:e,transposeA:a,transposeB:o,bias:i?mo(t.rank,i,"channelsLast"):null,activation:n}),g)}function yo(t,n,i){return e.tidy((function(){return n=Array.isArray(n)?e.tensor1d(n,"int32"):r.cast(n,"int32"),r.gather(t,n,i)}))}function vo(t){return r.mul(t,t)}function mo(t,e,n){var i=e.shape;if(1!==e.rank&&e.rank!==t)throw new sa("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t);if(5===t){if("channelsFirst"===n)return 1===i.length?r.reshape(e,[1,i[0],1,1,1]):r.reshape(e,[1,i[3],i[0],i[1],i[2]]);if("channelsLast"===n)return 1===i.length?r.reshape(e,[1,1,1,1,i[0]]):r.reshape(e,[1].concat(i))}else if(4===t){if("channelsFirst"===n)return 1===i.length?r.reshape(e,[1,i[0],1,1]):r.reshape(e,[1,i[2],i[0],i[1]]);if("channelsLast"===n)return 1===i.length?r.reshape(e,[1,1,1,i[0]]):r.reshape(e,[1].concat(i))}else if(3===t){if("channelsFirst"===n)return 1===i.length?r.reshape(e,[1,i[0],1]):r.reshape(e,[1,i[1],i[0]]);if("channelsLast"===n)return 1===i.length?r.reshape(e,[1,1,i[0]]):r.reshape(e,[1].concat(i))}else if(t<3)return e;throw new sa("Unsupported input rank by biasAdd: "+e.rank)}function bo(t,n,i){return e.tidy((function(){return null==i&&(i="channelsLast"),Ga(i),r.add(t,mo(t.rank,n,i))}))}function wo(t,n,i,a){return e.tidy((function(){return r.dropout(t,n,i,a)}))}function ko(t,e,n){return void 0===n&&(n=!1),n?t():e()}var xo=["fanIn","fanOut","fanAvg"],So=["normal","uniform","truncatedNormal"];var No=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(e.serialization.Serializable),zo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t,n){return e.zeros(t,n)},n}(No);zo.className="Zeros",e.serialization.registerClass(zo);var Io=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t,n){return e.ones(t,n)},n}(No);Io.className="Ones",e.serialization.registerClass(Io);var Ao=function(t){function n(e){var n=t.call(this)||this;if("object"!=typeof e)throw new sa("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new sa("config must have value set but got "+e);return n.value=e.value,n}return a(n,t),n.prototype.apply=function(t,n){var r=this;return e.tidy((function(){return e.mul(e.scalar(r.value),e.ones(t,n))}))},n.prototype.getConfig=function(){return{value:this.value}},n}(No);Ao.className="Constant",e.serialization.registerClass(Ao);var To=function(t){function n(e){var n=t.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=e.minval||n.DEFAULT_MINVAL,n.maxval=e.maxval||n.DEFAULT_MAXVAL,n.seed=e.seed,n}return a(n,t),n.prototype.apply=function(t,n){return e.randomUniform(t,this.minval,this.maxval,n)},n.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},n}(No);To.className="RandomUniform",e.serialization.registerClass(To);var Co=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return a(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new ua("randomNormal does not support dType "+e+".");return fo(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(No);Co.className="RandomNormal",e.serialization.registerClass(Co);var Eo=function(t){function n(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return a(n,t),n.prototype.apply=function(t,n){if("float32"!==(n=n||"float32")&&"int32"!==n)throw new ua("truncatedNormal does not support dType "+n+".");return e.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},n.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},n}(No);Eo.className="TruncatedNormal",e.serialization.registerClass(Eo);var Fo=function(t){function n(e){var n=t.call(this)||this;return n.gain=null!=e.gain?e.gain:1,n}return a(n,t),n.prototype.apply=function(t,n){var r=this;return e.tidy((function(){if(2!==t.length||t[0]!==t[1])throw new sa("Identity matrix initializer can only be used for 2D square matrices.");return e.mul(r.gain,e.eye(t[0]))}))},n.prototype.getConfig=function(){return{gain:this.gain}},n}(No);Fo.className="Identity",e.serialization.registerClass(Fo);var Do=function(t){function n(e){var n,r=t.call(this)||this;if(e.scale<0)throw new sa("scale must be a positive float. Got: "+e.scale);return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,n=r.mode,Na(xo,"FanMode",n),r.distribution=null==e.distribution?"normal":e.distribution,function(t){Na(So,"Distribution",t)}(r.distribution),r.seed=e.seed,r}return a(n,t),n.prototype.apply=function(t,n){var r=function(t,e){var n,r;if(void 0===e&&(e="channelsLast"),Ga(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length))if("channelsFirst"===e){var i=eo(t,2);n=t[1]*i,r=t[0]*i}else"channelsLast"===e&&(i=eo(t,0,t.length-2),n=t[t.length-2]*i,r=t[t.length-1]*i);else{var a=eo(t);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}(t),i=r[0],a=r[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,i):"fanOut"===this.mode?o/=Math.max(1,a):o/=Math.max(1,(i+a)/2),"normal"===this.distribution){var s=Math.sqrt(o);if("float32"!==(n=n||"float32")&&"int32"!==n)throw new ua(this.getClassName()+" does not support dType "+n+".");return e.truncatedNormal(t,0,s,n,this.seed)}var u=Math.sqrt(3*o);return e.randomUniform(t,-u,u,n)},n.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},n}(No);Do.className="VarianceScaling",e.serialization.registerClass(Do);var Lo=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Do.className},e}(Do);Lo.className="GlorotUniform",e.serialization.registerClass(Lo);var _o=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Do.className},e}(Do);_o.className="GlorotNormal",e.serialization.registerClass(_o);var Oo=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Do.className},e}(Do);Oo.className="HeNormal",e.serialization.registerClass(Oo);var Ro=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Do.className},e}(Do);Ro.className="HeUniform",e.serialization.registerClass(Ro);var Mo=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Do.className},e}(Do);Mo.className="LeCunNormal",e.serialization.registerClass(Mo);var Bo=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return a(e,t),e.prototype.getClassName=function(){return Do.className},e}(Do);Bo.className="LeCunNormal",e.serialization.registerClass(Bo);var Po=function(t){function n(e){var n=t.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==e.gain?n.DEFAULT_GAIN:e.gain,n.seed=e.seed,null!=n.seed)throw new ua("Random seed is not implemented for Orthogonal Initializer yet.");return n}return a(n,t),n.prototype.apply=function(t,n){var r=this;return e.tidy((function(){if(t.length<2)throw new ua("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+t[0]*t[1]+") elements: Slowness may result.");var n=fo(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),i=e.linalg.gramSchmidt(n);return t[0]>t[1]&&(i=e.transpose(i)),e.mul(r.gain,i)}))},n.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},n}(No);Po.className="Orthogonal",e.serialization.registerClass(Po);var Uo={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function jo(t,n){return void 0===n&&(n={}),wa(t,e.serialization.SerializationMap.getMap().classNameMap,n,"initializer")}function Wo(t){return ma(t)}function Vo(t){if("string"==typeof t){var e=t in Uo?Uo[t]:t;if("GlorotNormal"===e)return new _o;if("GlorotUniform"===e)return new Lo;if("HeNormal"===e)return new Oo;if("HeUniform"===e)return new Ro;if("LeCunNormal"===e)return new Mo;if("LeCunUniform"===e)return new Bo;var n={};return n.className=e,n.config={},jo(n)}return t instanceof No?t:jo(t)}var qo={__proto__:null,zeros:function(){return new zo},ones:function(){return new Io},constant:function(t){return new Ao(t)},randomUniform:function(t){return new To(t)},randomNormal:function(t){return new Co(t)},truncatedNormal:function(t){return new Eo(t)},identity:function(t){return new Fo(t)},varianceScaling:function(t){return new Do(t)},glorotUniform:function(t){return new Lo(t)},glorotNormal:function(t){return new _o(t)},heNormal:function(t){return new Oo(t)},heUniform:function(t){return new Ro(t)},leCunNormal:function(t){return new Mo(t)},leCunUniform:function(t){return new Bo(t)},orthogonal:function(t){return new Po(t)}},Ko=0;function Go(){return Ko++}var Ho={};function Zo(t){return void 0===t&&(t=""),t in Ho||(Ho[t]=0),Ho[t]+=1,t+Ho[t].toString()}function Jo(t){return Array.isArray(t)&&Array.isArray(t[0])}function Yo(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function Xo(t){var e;if(Array.isArray(t)){if(1!==t.length)throw new sa("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function $o(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new sa("Expected exactly 1 Shape; got "+t.length)}return t}function Qo(t){var e,n,r=0;try{for(var i=u(t),a=i.next();!a.done;a=i.next()){var o=a.value;0===o.shape.length?r+=1:r+=o.shape.reduce((function(t,e){return t*e}))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}var ts="Variable",es=function(){function t(t,e,n,i,a){void 0===e&&(e="float32"),void 0===n&&(n=ts),void 0===i&&(i=!0),void 0===a&&(a=null),this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=Go(),n=null==n?ts:n,this.originalName=Xa(n),this.name=$a(this.originalName),this.trainable_=i,this.constraint=a,this.val=r.variable(t,this.trainable_,this.name,this.dtype)}return t.prototype.read=function(){return this.assertNotDisposed(),this.val},t.prototype.write=function(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},t.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},t.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.trainable_=t,this.val.trainable=t},enumerable:!0,configurable:!0}),t}();function ns(t){return t.map((function(t){return t.read()}))}function rs(t){t.forEach((function(t){t[0].write(t[1])}))}var is=function(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},as=function(t,e,n,r,i,a,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=Go(),null!=a&&(this.originalName=Xa(a),this.name=$a(this.originalName)),this.rank=e.length},os=0,ss=function(){function t(t,e){var n,r;this.callArgs=e,this.id=os++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;try{for(var i=u(t.inboundLayers),a=i.next();!a.done;a=i.next()){var o=a.value;null!=o&&o.outboundNodes.push(this)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.outboundLayer.inboundNodes.push(this)}return t.prototype.getConfig=function(){var t,e,n=[];try{for(var r=u(this.inboundLayers),i=r.next();!i.done;i=r.next()){var a=i.value;null!=a?n.push(a.name):n.push(null)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},t}(),us=0,ls=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=us++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=e.name;if(!r){var i=n.getClassName();r=ga(i)+"_"+Zo(i)}if(n.name=r,n.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){var a=void 0;if(null!=e.batchInputShape)a=e.batchInputShape;else if(null!=e.inputShape){var o=null;null!=e.batchSize&&(o=e.batchSize),a=[o].concat(e.inputShape)}n.batchInputShape=a;var s=e.dtype;null==s&&(s=e.inputDType),null==s&&(s="float32"),n.dtype=s}return null!=e.weights?n.initialWeights=e.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return a(n,t),n.nodeKey=function(t,e){return t.name+"_ib-"+e.toString()},n.prototype.getNodeAtIndex=function(t,e){if(0===this.inboundNodes.length)throw new oa("The layer has never been called and thus has no defined "+e+".");if(this.inboundNodes.length<=t)throw new sa("Asked to get "+e+" at node "+t+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[t]},n.prototype.getInputAt=function(t){return fa(this.getNodeAtIndex(t,"input").inputTensors)},n.prototype.getOutputAt=function(t){return fa(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(n.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new aa("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new aa("Layer "+this.name+" is not connected, no input to return.");return fa(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new aa("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new aa("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return fa(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),n.prototype.calculateLosses=function(){return this.losses.map((function(t){return t()}))},Object.defineProperty(n.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach((function(e){return e.trainable=t})),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter((function(t){return t.trainable})):[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter((function(t){return!t.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),n.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},n.prototype.assertInputCompatibility=function(t){if(t=da(t),null!=this.inputSpec&&0!==this.inputSpec.length){var e=da(this.inputSpec);if(t.length!==e.length)throw new sa("Layer "+this.name+" expects "+e.length+" inputs, but it received "+t.length+" input tensors. Input received: "+t);for(var n=0;n<t.length;n++){var r=t[n],i=e[n];if(null!=i){var a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new sa("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+a);if(null!=i.maxNDim&&a>i.maxNDim)throw new sa("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+a);if(null!=i.minNDim&&a<i.minNDim)throw new sa("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+a+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new sa("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var o=r.shape;for(var s in i.axes){var u=Number(s),l=i.axes[s],c=u>=0?o[u]:o[o.length+u];if(null!=l&&-1===[l,null].indexOf(c))throw new sa("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+o+".")}}if(null!=i.shape)for(var h=0;h<i.shape.length;++h){var p=i.shape[h],f=r.shape[h];if(null!=p&&null!=f&&p!==f)throw new sa("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape="+r.shape+".")}}}}},n.prototype.call=function(t,e){return t},n.prototype.invokeCallHook=function(t,e){null!=this._callHook&&this._callHook(t,e)},n.prototype.setCallHook=function(t){this._callHook=t},n.prototype.clearCallHook=function(){this._callHook=null},n.prototype.apply=function(t,e){var n,r,i,a,o=this;e=e||{},this.assertNotDisposed();var s=da(t),l=!0;try{for(var c=u(s),h=c.next();!h.done;h=c.next()){if(!(h.value instanceof as)){l=!1;break}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}var p=!0;try{for(var f=u(s),d=f.next();!d.done;d=f.next()){if(d.value instanceof as){p=!1;break}}}catch(t){i={error:t}}finally{try{d&&!d.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}if(l===p)throw new sa("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ya(this.name,(function(){var n,r,i,a;if(!o.built){o.assertInputCompatibility(t);var l=[];try{for(var c=u(da(t)),h=c.next();!h.done;h=c.next()){var f=h.value;l.push(f.shape)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}o.build(fa(l)),o.built=!0,o.initialWeights&&o.setWeights(o.initialWeights),null===o._refCount&&p&&(o._refCount=1)}if(o.assertInputCompatibility(t),p){var d=da(k=o.call(t,e)),g=[];try{for(var y=u(d),v=y.next();!v.done;v=y.next()){var m=v.value;-1!==s.indexOf(m)&&(m=m.clone()),g.push(m)}}catch(t){i={error:t}}finally{try{v&&!v.done&&(a=y.return)&&a.call(y)}finally{if(i)throw i.error}}if(k=fa(g),null!=o.activityRegularizer)throw new ua("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return k}var b=function(t){var e,n;t=da(t);var r=[];try{for(var i=u(t),a=i.next();!a.done;a=i.next()){var o=a.value;r.push(o.shape)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return fa(r)}(t),w=o.computeOutputShape(b),k=void 0,x="float32";if(o.warnOnIncompatibleInputShape(Array.isArray(t)?b[0]:b),k=null!=w&&w.length>0&&Array.isArray(w[0])?w.map((function(n,r){return new as(x,n,o,da(t),e,o.name,r)})):new as(x,w,o,da(t),e,o.name),o.addInboundNode(t,k,null,null,b,w,e),o._refCount++,null!=o.activityRegularizer)throw new ua("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return k}))},n.prototype.warnOnIncompatibleInputShape=function(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(t)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var e=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)})),e&&console.warn("The shape of the input tensor ("+JSON.stringify(t)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(n.prototype,"outputShape",{get:function(){var t,e;if(null==this.inboundNodes||0===this.inboundNodes.length)throw new aa("The layer "+this.name+" has never been called and thus has no defined output shape.");var n=[];try{for(var r=u(this.inboundNodes),i=r.next();!i.done;i=r.next()){var a=i.value,o=JSON.stringify(a.outputShapes);-1===n.indexOf(o)&&n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}if(1===n.length){var s=this.inboundNodes[0].outputShapes;return Array.isArray(s)&&Array.isArray(s[0])&&1===s.length?s[0]:s}throw new aa("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),n.prototype.countParams=function(){if(!this.built)throw new oa("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return Qo(this.weights)},n.prototype.build=function(t){this.built=!0},n.prototype.getWeights=function(t){return void 0===t&&(t=!1),ns(t?this.trainableWeights:this.weights)},n.prototype.setWeights=function(t){var n=this;e.tidy((function(){var r=n.weights;if(r.length!==t.length)throw new sa('You called setWeights(weights) on layer "'+n.name+'" with a weight list of length '+t.length+", but the layer was expecting "+r.length+" weights. Provided weights: "+t+"...");if(0!==r.length){for(var i=[],a=ns(r),o=0;o<a.length;++o){var s=a[o],u=r[o],l=t[o];if(!e.util.arraysEqual(s.shape,l.shape))throw new sa("Layer weight shape "+s.shape+" not compatible with provided weight shape "+l.shape);i.push([u,l])}rs(i)}}))},n.prototype.addWeight=function(t,e,n,r,i,a,o,s){if(-1!==this._addedWeightNames.indexOf(t))throw new sa("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Vo("zeros"));var u=r.apply(e,n),l=new es(u,n,t,a,o);return u.dispose(),null!=i&&this.addLoss((function(){return i.apply(l.read())})),null==a&&(a=!0),a?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l},n.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},n.prototype.addLoss=function(t){var e;null==t||Array.isArray(t)&&0===t.length||(t=da(t),void 0!==this._losses&&null!==this._losses&&(e=this.losses).push.apply(e,c(t)))},n.prototype.computeOutputShape=function(t){return t},n.prototype.computeMask=function(t,e){var n=this;if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");e.forEach((function(t){if(null!=t)throw new TypeError("Layer "+n.name+" does not support masking, but was passed an inputMask.")}))}return null}return e},n.prototype.addInboundNode=function(t,e,n,r,i,a,o){var s,l;void 0===o&&(o=null);var c=da(t);e=da(e),n=da(n),r=da(r),i=Yo(i),a=Yo(a);var h=[],p=[],f=[];try{for(var d=u(c),g=d.next();!g.done;g=d.next()){var y=g.value;h.push(y.sourceLayer),p.push(y.nodeIndex),f.push(y.tensorIndex)}}catch(t){s={error:t}}finally{try{g&&!g.done&&(l=d.return)&&l.call(d)}finally{if(s)throw s.error}}new ss({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:f,inputTensors:c,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},o);for(var v=0;v<e.length;v++)e[v].sourceLayer=this,e[v].nodeIndex=this.inboundNodes.length-1,e[v].tensorIndex=v},n.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t},n.prototype.disposeWeights=function(){return this.weights.forEach((function(t){return t.dispose()})),this.weights.length},n.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},n.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},n}(e.serialization.Serializable);function cs(t,e,n){var r,i;if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];var a=e.inboundNodes[n];if(0===a.inboundLayers.length)return a.inputTensors;for(var o=[],s=0;s<a.inboundLayers.length;s++){var l=cs(a.inputTensors[s],a.inboundLayers[s],a.nodeIndices[s]);try{for(var c=(r=void 0,u(l)),h=c.next();!h.done;h=c.next()){var p=h.value;-1===o.indexOf(p)&&o.push(p)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}return o}var hs,ps=function(t){function e(e){var n=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:Zo("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new sa("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=e.batchInputShape;if(null==r){if(null==e.inputShape)throw new sa("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new sa("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var a=new as(n.dtype,n.batchInputShape,n,[],{},n.name);return a.nodeIndex=0,a.tensorIndex=0,new ss({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return a(e,t),e.prototype.apply=function(t,e){throw new sa("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(ls);function fs(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new sa("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));var n=t.dtype;return null==n&&(n="float32"),new ps({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}function ds(t){return o(this,void 0,void 0,(function(){var n,r,i,a,o,u,l,c;return s(this,(function(s){switch(s.label){case 0:if(null==t)return[2];for(a in n=[],r=[],i=[],t)"number"!=typeof(o=t[a])&&(u=o,n.push(u.data()),r.push(a),i.push(u));return n.length>0?[4,Promise.all(n)]:[3,2];case 1:for(l=s.sent(),c=0;c<l.length;++c)t[r[c]]=l[c][0];e.dispose(i),s.label=2;case 2:return[2]}}))}))}function gs(t){if(null!=t)for(var e in t){var n=t[e];"number"!=typeof n&&n.dispose()}}ps.className="InputLayer",e.serialization.registerClass(ps),function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(hs||(hs={}));var ys=function(){function t(){this.validationData=null}return t.prototype.setParams=function(t){this.params=t},t.prototype.onEpochBegin=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2]}))}))},t.prototype.onEpochEnd=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2]}))}))},t.prototype.onBatchBegin=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2]}))}))},t.prototype.onBatchEnd=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2]}))}))},t.prototype.onTrainBegin=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2]}))}))},t.prototype.onTrainEnd=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2]}))}))},t.prototype.setModel=function(t){},t}(),vs=function(){function t(t,e){void 0===e&&(e=10),null==t&&(t=[]),this.callbacks=t,this.queueLength=e}return t.prototype.append=function(t){this.callbacks.push(t)},t.prototype.setParams=function(t){var e,n;try{for(var r=u(this.callbacks),i=r.next();!i.done;i=r.next()){i.value.setParams(t)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.setModel=function(t){var e,n;try{for(var r=u(this.callbacks),i=r.next();!i.done;i=r.next()){i.value.setModel(t)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.onEpochBegin=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:null==e&&(e={}),s.label=1;case 1:s.trys.push([1,6,7,8]),n=u(this.callbacks),r=n.next(),s.label=2;case 2:return r.done?[3,5]:[4,r.value.onEpochBegin(t,e)];case 3:s.sent(),s.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),a={error:i},[3,8];case 7:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},t.prototype.onEpochEnd=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:null==e&&(e={}),s.label=1;case 1:s.trys.push([1,6,7,8]),n=u(this.callbacks),r=n.next(),s.label=2;case 2:return r.done?[3,5]:[4,r.value.onEpochEnd(t,e)];case 3:s.sent(),s.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),a={error:i},[3,8];case 7:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},t.prototype.onBatchBegin=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:null==e&&(e={}),s.label=1;case 1:s.trys.push([1,6,7,8]),n=u(this.callbacks),r=n.next(),s.label=2;case 2:return r.done?[3,5]:[4,r.value.onBatchBegin(t,e)];case 3:s.sent(),s.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),a={error:i},[3,8];case 7:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},t.prototype.onBatchEnd=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:null==e&&(e={}),s.label=1;case 1:s.trys.push([1,6,7,8]),n=u(this.callbacks),r=n.next(),s.label=2;case 2:return r.done?[3,5]:[4,r.value.onBatchEnd(t,e)];case 3:s.sent(),s.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),a={error:i},[3,8];case 7:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},t.prototype.onTrainBegin=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,a;return s(this,(function(o){switch(o.label){case 0:null==t&&(t={}),o.label=1;case 1:o.trys.push([1,6,7,8]),e=u(this.callbacks),n=e.next(),o.label=2;case 2:return n.done?[3,5]:[4,n.value.onTrainBegin(t)];case 3:o.sent(),o.label=4;case 4:return n=e.next(),[3,2];case 5:return[3,8];case 6:return r=o.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},t.prototype.onTrainEnd=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,a;return s(this,(function(o){switch(o.label){case 0:null==t&&(t={}),o.label=1;case 1:o.trys.push([1,6,7,8]),e=u(this.callbacks),n=e.next(),o.label=2;case 2:return n.done?[3,5]:[4,n.value.onTrainEnd(t)];case 3:o.sent(),o.label=4;case 4:return n=e.next(),[3,2];case 5:return[3,8];case 6:return r=o.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},t}(),ms=function(t){function n(){return t.call(this)||this}return a(n,t),n.prototype.onEpochBegin=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(t){return this.seen=0,this.totals={},[2]}))}))},n.prototype.onBatchEnd=function(t,n){return o(this,void 0,void 0,(function(){var t,r,i,a,o=this;return s(this,(function(s){for(a in null==n&&(n={}),t=null==n.size?0:n.size,this.seen+=t,r=function(r){var a=n[r];if("number"==typeof a)i.totals.hasOwnProperty(r)||(i.totals[r]=0),i.totals[r]=i.totals[r]+a*t;else{var s=void 0;r in i.totals?s=i.totals[r]:i.totals[r]=0;var u=e.tidy((function(){return e.add(o.totals[r],e.mul(a,t))}));i.totals[r]=u,null!=s&&s.dispose()}},i=this,n)r(a);return[2]}))}))},n.prototype.onEpochEnd=function(t,n){return o(this,void 0,void 0,(function(){var t,r,i,a,o,l,c,h=this;return s(this,(function(s){if(null!=n){t=function(t){if(null==r.totals[t])return"continue";"number"==typeof r.totals[t]?n[t]=r.totals[t]/r.seen:e.tidy((function(){var r=e.mul(e.div(1,h.seen),h.totals[t]);n[t]=r,h.totals[t].dispose(),e.keep(n[t])}))},r=this;try{for(i=u(this.params.metrics),a=i.next();!a.done;a=i.next())o=a.value,t(o)}catch(t){l={error:t}}finally{try{a&&!a.done&&(c=i.return)&&c.call(i)}finally{if(l)throw l.error}}}return[2]}))}))},n}(ys),bs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.onTrainBegin=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(t){return this.epoch=[],this.history={},[2]}))}))},e.prototype.onEpochEnd=function(t,e){return o(this,void 0,void 0,(function(){var n;return s(this,(function(r){for(n in null==e&&(e={}),this.epoch.push(t),e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n]);return[2]}))}))},e.prototype.syncData=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i,a,o,u,l;return s(this,(function(s){switch(s.label){case 0:for(r in t=[],e=[],n=[],this.history)for(i=this.history[r],a=0;a<i.length;++a)"number"!=typeof i[a]&&(o=i[a],t.push(o.data()),e.push(r),n.push(a));return[4,Promise.all(t)];case 1:for(u=s.sent(),l=0;l<u.length;++l)this.history[e[l]][n[l]].dispose(),this.history[e[l]][n[l]]=u[l][0];return[2]}}))}))},e}(ys),ws=function(t){function n(n,r){var i,a,o,s,u,l=t.call(this)||this;if(l.currentEpoch=0,l.nowFunc=n.nowFunc,l.nextFrameFunc=n.nextFrameFunc||e.nextFrame,l.yieldEvery=r||"auto","auto"===l.yieldEvery&&(l.yieldEvery=125),"never"===l.yieldEvery&&null!=n.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return e.util.isNumber(l.yieldEvery)&&(l.maybeWait=(i=l.maybeWait.bind(l),a=l.yieldEvery,o=l.nowFunc,u=null!=o?o():e.util.now(),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=null!=o?o():e.util.now();return r-u<a?s:(u=r,s=i.apply(void 0,c(t)))})),l.trainBegin=n.onTrainBegin,l.trainEnd=n.onTrainEnd,l.epochBegin=n.onEpochBegin,l.epochEnd=n.onEpochEnd,l.batchBegin=n.onBatchBegin,l.batchEnd=n.onBatchEnd,l.yield=n.onYield,l}return a(n,t),n.prototype.maybeWait=function(t,e,n){return o(this,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return r=[],null==this.yield?[3,2]:[4,ds(n)];case 1:i.sent(),r.push(this.yield(t,e,n)),i.label=2;case 2:return r.push(this.nextFrameFunc()),[4,Promise.all(r)];case 3:return i.sent(),[2]}}))}))},n.prototype.onEpochBegin=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.currentEpoch=t,null==this.epochBegin?[3,3]:[4,ds(e)];case 1:return n.sent(),[4,this.epochBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},n.prototype.onEpochEnd=function(t,e){return o(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=[],null==this.epochEnd?[3,2]:[4,ds(e)];case 1:r.sent(),n.push(this.epochEnd(t,e)),r.label=2;case 2:return"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),[4,Promise.all(n)];case 3:return r.sent(),[2]}}))}))},n.prototype.onBatchBegin=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,ds(e)];case 1:return n.sent(),[4,this.batchBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},n.prototype.onBatchEnd=function(t,n){return o(this,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return r=[],null==this.batchEnd?[3,2]:[4,ds(n)];case 1:i.sent(),r.push(this.batchEnd(t,n)),i.label=2;case 2:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):e.util.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(r)];case 3:return i.sent(),[2]}}))}))},n.prototype.onTrainBegin=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,ds(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},n.prototype.onTrainEnd=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,ds(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},n}(ys);function ks(t,e){return null==t&&(t={}),t instanceof ys?[t]:Array.isArray(t)&&t[0]instanceof ys?t:da(t).map((function(t){return new ws(t,e)}))}var xs=function(){function t(){}return t.registerCallbackConstructor=function(n,r){e.util.assert(n>=0&&Number.isInteger(n),(function(){return"Verbosity level is expected to be an integer >= 0, but got "+n})),t.checkForDuplicate(r),null==t.constructors[n]&&(t.constructors[n]=[]),t.constructors[n].push(r)},t.checkForDuplicate=function(e){for(var n in t.constructors){t.constructors[+n].forEach((function(t){if(t===e)throw new sa("Duplicate callback constructor.")}))}},t.clear=function(){t.constructors={}},t.createCallbacks=function(e){var n=[];for(var r in t.constructors){var i=+r;e>=i&&n.push.apply(n,c(t.constructors[i]))}return n.map((function(t){return new t}))},t}();function Ss(t,e,n,r,i,a,o,s,u){var l=new bs,h=c([new ms],xs.createCallbacks(e));null!=t&&h.push.apply(h,c(t)),h.push(l);var p=new vs(h);return p.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:p,history:l}}function Ns(t,n,r){return void 0===n&&(n={}),void 0===r&&(r=!1),wa(t,e.serialization.SerializationMap.getMap().classNameMap,n,"layer",r)}function zs(t,n){return e.tidy((function(){"float32"!==t.dtype&&(t=r.cast(t,"float32"));var e=r.sum(vo(t),n,!0),i=r.fill(e.shape,ia()),a=r.sqrt(r.maximum(e,i));return r.div(t,a)}))}function Is(t,n){return e.tidy((function(){return r.mean(vo(r.sub(n,t)),-1)}))}function As(t,n){return e.tidy((function(){return r.mean(r.abs(r.sub(n,t)),-1)}))}function Ts(t,n){return e.tidy((function(){var e=r.sub(t,n),i=r.clipByValue(r.abs(t),ia(),Number.MAX_VALUE),a=r.abs(r.div(e,i));return r.mul(100,r.mean(a,-1))}))}function Cs(t,n,i){return void 0===i&&(i=!1),e.tidy((function(){if(i)n=r.softmax(n);else{var e=r.sum(n,n.shape.length-1,!0);n=r.div(n,e)}return n=r.clipByValue(n,ia(),1-ia()),r.neg(r.sum(r.mul(r.cast(t,"float32"),r.log(n)),n.shape.length-1))}))}function Es(t,n,i){return void 0===i&&(i=!1),e.tidy((function(){var e,a,o=r.cast(r.floor((a=[eo((e=t).shape)],r.reshape(e,a))),"int32"),s=(n=r.clipByValue(n,ia(),1-ia())).shape;return Cs(r.reshape(r.oneHot(o,s[s.length-1]),s),n,i)}))}function Fs(t,n){return e.tidy((function(){var i;return i=r.clipByValue(n,ia(),1-ia()),i=r.log(r.div(i,r.sub(1,i))),r.mean(function(t,n){if(!e.util.arraysEqual(t.shape,n.shape))throw new sa("logits and labels must have the same shape, but got shapes "+JSON.stringify(t.shape)+" and "+JSON.stringify(n.shape));return e.tidy((function(){var e=r.relu(n),i=r.neg(r.abs(n));return r.add(r.sub(e,r.mul(n,t)),r.log1p(r.exp(i)))}))}(t,i),-1)}))}function Ds(t,n){return e.tidy((function(){var e=zs(t,-1),i=zs(n,-1),a=r.mul(e,i);return r.neg(r.sum(a,-1))}))}xs.constructors={};var Ls={meanSquaredError:Is,meanAbsoluteError:As,meanAbsolutePercentageError:Ts,meanSquaredLogarithmicError:function(t,n){return e.tidy((function(){var e=r.clipByValue(n,ia(),Number.MAX_VALUE),i=r.log(r.add(1,e)),a=r.clipByValue(t,ia(),Number.MAX_VALUE),o=r.log(r.add(1,a));return r.mean(vo(r.sub(i,o)),-1)}))},squaredHinge:function(t,n){return e.tidy((function(){var e=r.maximum(0,r.sub(1,r.mul(t,n)));return r.mean(vo(e),-1)}))},hinge:function(t,n){return e.tidy((function(){var e=r.maximum(0,r.sub(1,r.mul(t,n)));return r.mean(e,-1)}))},categoricalHinge:function(t,n){return e.tidy((function(){var e=r.sum(r.mul(t,n),-1),i=r.max(r.mul(r.sub(1,t),n),-1);return r.maximum(0,r.add(1,r.sub(i,e)))}))},logcosh:function(t,n){return e.tidy((function(){var e=Math.log(2),i=r.sub(n,t),a=r.sub(r.add(i,r.softplus(r.mul(-2,i))),e);return r.mean(a,-1)}))},categoricalCrossentropy:Cs,sparseCategoricalCrossentropy:Es,binaryCrossentropy:Fs,kullbackLeiblerDivergence:function(t,n){return e.tidy((function(){var e=r.clipByValue(t,ia(),1),i=r.clipByValue(n,ia(),1);return r.sum(r.mul(t,r.log(r.div(e,i))),-1)}))},poisson:function(t,n){return e.tidy((function(){var e=r.log(r.add(ia(),n));return r.mean(r.sub(n,r.mul(t,e)),-1)}))},cosineProximity:Ds};function _s(t){if("string"==typeof t){if(t in Ls)return Ls[t];var e="Unknown loss "+t;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss "+t+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new sa(e)}return t}function Os(t,n){return e.tidy((function(){var e=r.mul(.5,r.onesLike(n)),i=ao(r.greater(n,e),t.dtype);return r.mean(r.equal(t,i),-1)}))}function Rs(t,n){return e.tidy((function(){return ao(r.equal(r.argMax(t,-1),r.argMax(n,-1)),"float32")}))}function Ms(t,n){return e.tidy((function(){return r.cast(r.sum(r.logicalAnd(r.equal(t,1),r.equal(n,1))),"float32")}))}function Bs(t,n){return e.tidy((function(){var i=Ms(t,n),a=function(t,n){return e.tidy((function(){return r.cast(r.sum(r.logicalAnd(r.equal(t,0),r.equal(n,1))),"float32")}))}(t,n),o=r.add(i,a);return r.cast(r.where(r.greater(o,0),r.div(i,o),0),"float32")}))}function Ps(t,n){return e.tidy((function(){var i=Ms(t,n),a=function(t,n){return e.tidy((function(){return r.cast(r.sum(r.logicalAnd(r.equal(t,1),r.equal(n,0))),"float32")}))}(t,n),o=r.add(i,a);return r.cast(r.where(r.greater(o,0),r.div(i,o),0),"float32")}))}function Us(t,e){return Fs(t,e)}function js(t,e){return t.rank===e.rank&&(t=r.squeeze(t,[t.rank-1])),(e=r.argMax(e,-1)).dtype!==t.dtype&&(e=r.cast(e,t.dtype)),r.cast(r.equal(t,e),"float32")}var Ws=Cs,Vs=Es,qs={binaryAccuracy:Os,categoricalAccuracy:Rs,precision:Bs,categoricalCrossentropy:Ws,sparseCategoricalCrossentropy:Vs,mse:Is,MSE:Is,mae:As,MAE:As,mape:Ts,MAPE:Ts,cosine:Ds};function Ks(t){var e,n,r,i;if(ha(null!==t,"Unknown LossOrMetricFn "+t),"string"==typeof t)return t;var a=void 0;try{for(var o=u(Object.keys(Ls)),s=o.next();!s.done;s=o.next()){var l=s.value;if(Ls[l]===t){a=l;break}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}if(void 0!==a)return a;try{for(var c=u(Object.keys(qs)),h=c.next();!h.done;h=c.next()){l=h.value;if(qs[l]===t){a=l;break}}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}return void 0!==a?a:t.name}var Gs=1048576;function Hs(t,e,n){if(void 0===n&&(n=!1),null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!Zs(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(t);r.length>Gs&&console.warn('User-defined metadata of model "'+e+'" is too large in size (length='+r.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.")}}function Zs(t){var e,n,r,i;if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){var a=Object.keys(t);try{for(var o=u(a),s=o.next();!s.done;s=o.next()){var l=s.value;if("string"!=typeof l)return!1;if(!Zs(t[l]))return!1}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return!0}if(Array.isArray(t)){try{for(var c=u(t),h=c.next();!h.done;h=c.next()){if(!Zs(h.value))return!1}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}return!0}return!1}var p=typeof t;return"string"===p||"number"===p||"boolean"===p}function Js(t,e,n,r){void 0===r&&(r=console.log);var i,a=function(t){var e,n,r,i,a,o,s=!0,l=[],h=[];for(var p in t.nodesByDepth)l.push(t.nodesByDepth[p]);try{for(var f=u(l),d=f.next();!d.done;d=f.next()){var g=d.value;if(g.length>1||1===g.length&&g[0].inboundLayers.length>1){s=!1;break}h.push.apply(h,c(g))}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(e)throw e.error}}if(s)try{for(var y=u(t.layers),v=y.next();!v.done;v=y.next()){var m=v.value,b=!1;try{for(var w=(a=void 0,u(m.inboundNodes)),k=w.next();!k.done;k=w.next()){var x=k.value;if(-1!==h.indexOf(x)){if(b){s=!1;break}b=!0}}}catch(t){a={error:t}}finally{try{k&&!k.done&&(o=w.return)&&o.call(w)}finally{if(a)throw a.error}}if(!s)break}}catch(t){r={error:t}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}return s}(t),o=["Layer (type)","Input Shape","Output shape","Param #"];if(a?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(t){return Math.floor(e*t)}))),!a)for(var s in o.push("Receives inputs"),i=[],t.nodesByDepth)i.push.apply(i,c(t.nodesByDepth[s]));r("_".repeat(e)),Ys(o,n,r),r("=".repeat(e));for(var l=t.layers,h=0;h<l.length;++h)a?Xs(l[h],n,r):$s(l[h],n,i,r),r((h===l.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();var p=function(t){var e;e=null!=t.collectedTrainableWeights?Qo(t.collectedTrainableWeights):Qo(t.trainableWeights);return e}(t),f=Qo(t.nonTrainableWeights);r("Total params: "+(p+f)),r("Trainable params: "+p),r("Non-trainable params: "+f),r("_".repeat(e))}function Ys(t,e,n){void 0===n&&(n=console.log);for(var r="",i=0;i<t.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=t[i]).slice(0,e[i]),r+=" ".repeat(e[i]-r.length);n(r)}function Xs(t,e,n){var r,i;try{i=t.inboundNodes.map((function(t){return JSON.stringify(t.inputShapes)})).join(",")}catch(t){i="multiple"}try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}Ys([t.name+" ("+t.getClassName()+")",i,r,t.countParams().toString()],e,n)}function $s(t,e,n,r){var i,a,o,s;try{s=t.inboundNodes.map((function(t){return JSON.stringify(t.inputShapes)})).join(",")}catch(t){s="multiple"}try{o=JSON.stringify(t.outputShape)}catch(t){o="multiple"}var l=[];try{for(var c=u(t.inboundNodes),h=c.next();!h.done;h=c.next()){var p=h.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(p)))for(var f=0;f<p.inboundLayers.length;++f){var d=p.inboundLayers[f].name,g=p.nodeIndices[f],y=p.tensorIndices[f];l.push(d+"["+g+"]["+y+"]")}}}catch(t){i={error:t}}finally{try{h&&!h.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}var v=t.name,m=t.getClassName(),b=0===l.length?"":l[0];Ys([v+" ("+m+")",s,o,t.countParams().toString(),b],e,r);for(f=1;f<l.length;++f)Ys(["","","","",l[f]],e,r)}function Qs(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function tu(t,e){var n,r;if(null===t)return null;if("string"==typeof t)return ya(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var i=[],a=t.length,o=0;o<a;++o){var s=t[o];Qs(e,o,s)?i.push(s):i.push(tu(s,e))}return i}var l={};try{for(var c=u(Object.keys(t)),h=c.next();!h.done;h=c.next()){var p=h.value,f=t[p];if("name"===p&&"string"==typeof f)l[p]=f;else{var d=ya(p);l[d]=tu(f,d)}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return l}function eu(t,e){var n,r;if(null==t)return null;if("string"==typeof t)return ga(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var i=[],a=t.length,o=0;o<a;++o){var s=t[o];Qs(e,o,s)?i.push(s):i.push(eu(s,e))}return i}var l={};try{for(var c=u(Object.keys(t)),h=c.next();!h.done;h=c.next()){var p=h.value,f=t[p],d=ga(p);l[d]="name"!==p&&"className"!==p||"string"!=typeof f?eu(f,p):f}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return l}var nu="3.15.0";var ru=function(){function t(e){var n,r;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof t)for(var i in e.id2Value)this.id2Value[i]=e.id2Value[i],i in e.id2Mask&&(this.id2Mask[i]=e.id2Mask[i]);else{if(null==e)return;try{for(var a=u(e),o=a.next();!o.done;o=a.next()){var s=o.value;this.add(s.key,s.value)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}return t.prototype.add=function(t,n,r){if(null!=this.id2Value[t.id])throw new sa("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=function(t,n){if(null==t.dtype||t.dtype===n.dtype)return n;try{return e.cast(n,t.dtype)}catch(e){throw new sa("The dtype of the feed ("+n.dtype+") can not be cast to the dtype of the key '"+t.name+"' ("+t.dtype+").")}}(t,n),this.name2Id[t.name]=t.id,null!=r&&(this.id2Mask[t.id]=r),this},t.prototype.addFeed=function(t){this.add(t.key,t.value)},t.prototype.hasKey=function(t){return null!=this.id2Value[t.id]},t.prototype.names=function(){return Object.keys(this.name2Id)},t.prototype.getValue=function(t){if(t instanceof as){if(null==this.id2Value[t.id])throw new sa("Nonexistent key: "+t.name);return this.id2Value[t.id]}var e=this.name2Id[t];if(null==e)throw new sa("Feed dict has no SymbolicTensor name: "+t);return this.id2Value[e]},t.prototype.getMask=function(t){if(t instanceof as){if(null==this.id2Value[t.id])throw new sa("Nonexistent key: "+t.name);return this.id2Mask[t.id]}var e=this.name2Id[t];if(null==e)throw new sa("Feed dict has no SymbolicTensor name: "+t);return this.id2Mask[e]},t.prototype.disposeMasks=function(){null!=this.id2Mask&&e.dispose(this.id2Mask)},t}(),iu={},au={};function ou(t,n,r,i){var a,o,s,l,c=null!=r&&r.training,h=Array.isArray(t),p=h?t:[t],f=p.map((function(t){return t.name})),d=[],g=n.names();try{for(var y=u(f),v=y.next();!v.done;v=y.next()){var m=v.value;-1!==g.indexOf(m)?d.push(n.getValue(m)):d.push(null)}}catch(t){a={error:t}}finally{try{v&&!v.done&&(o=y.return)&&o.call(y)}finally{if(a)throw a.error}}null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);var b,w,k=f.join(",")+"|"+n.names().join(",");if(null==iu[k]){var x=function(t,n){var r,i,a,o;e.util.assert(null!=t&&t.length>0,(function(){return"Expected at least one fetch, got none"}));var s=[],l={};if(1===t.length){var c=uu(t[0],n);s=c.sorted,l=c.recipientMap}else{var h=new Set;try{for(var p=u(t),f=p.next();!f.done;f=p.next()){var d=uu(f.value,n),g=d.sorted,y=d.recipientMap;try{for(var v=(a=void 0,u(g)),m=v.next();!m.done;m=v.next()){var b=m.value;h.has(b.name)||(s.push(b),h.add(b.name))}}catch(t){a={error:t}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}var w=function(t){null==l[t]&&(l[t]=new Set),y[t].forEach((function(e){return l[t].add(e)}))};for(var k in y)w(k)}}catch(t){r={error:t}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}return{sorted:s,recipientCounts:su(l)}}(p,n);b=x.sorted,w=x.recipientCounts,iu[k]=b,au[k]=w}b=iu[k],w={},c||Object.assign(w,au[k]);for(var S=new ru(n),N=0;N<b.length;++N){if(null!=i){var z=e.memory().numTensors;z>i.maxNumTensors&&(i.maxNumTensors=z),z<i.minNumTensors&&(i.minNumTensors=z)}var I=b[N],A=I.sourceLayer;if(!(A instanceof ps)){var T=[],C=[],E=[],F=!1;try{for(var D=(s=void 0,u(I.inputs)),L=D.next();!L.done;L=D.next()){var _=L.value,O=S.getValue(_),R=S.getMask(_);T.push(O),C.push(R),null!=R&&(F=!0),c||(w[_.name]--,0!==w[_.name]||n.hasKey(_)||-1!==f.indexOf(_.name)||O.isDisposed||!0===_.sourceLayer.stateful||E.push(O))}}catch(t){s={error:t}}finally{try{L&&!L.done&&(l=D.return)&&l.call(D)}finally{if(s)throw s.error}}F&&((r=r||{}).mask=C[0]);var M=da(A.apply(T,r)),B=null;A.supportsMasking&&(B=A.computeMask(T,C));for(var P=lu(I),U=Array.isArray(P)?P:[P],j=0;j<U.length;++j){S.hasKey(U[j])||S.add(U[j],M[j],Array.isArray(B)?B[0]:B);var W=f.indexOf(U[j].name);-1!==W&&(d[W]=M[j])}c||e.dispose(E)}}return S.disposeMasks(),h?d:d[0]}function su(t){var e={};for(var n in t)e[n]=t[n].size;return e}function uu(t,e){var n,r,i,a,o=new Set,s=[],l={};try{for(var c=u(e.names()),h=c.next();!h.done;h=c.next()){var p=h.value;o.add(p)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}var f=[],d=[];for(f.push(t);f.length>0;){var g=f[f.length-1];if(o.has(g.name))f.pop();else{var y=d[d.length-1]===f.length-1;if(0===g.inputs.length||y)f.pop(),s.push(g),o.add(g.name),y&&d.pop();else{d.push(f.length-1);try{for(var v=(i=void 0,u(g.inputs)),m=v.next();!m.done;m=v.next()){var b=m.value;null==l[b.name]&&(l[b.name]=new Set),l[b.name].add(g.name),o.has(b.name)||f.push(b)}}catch(t){i={error:t}}finally{try{m&&!m.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}}}}return{sorted:s,recipientMap:l}}function lu(t){var e,n,r;if(1===t.sourceLayer.inboundNodes.length)r=t.sourceLayer.output;else{for(var i=null,a=0;a<t.sourceLayer.inboundNodes.length;++a)try{for(var o=(e=void 0,u(t.sourceLayer.inboundNodes[a].outputTensors)),s=o.next();!s.done;s=o.next()){if(s.value.id===t.id){i=a;break}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}r=t.sourceLayer.getOutputAt(i)}return r}var cu=function(t){function n(e){var r,i,a,o,s,l,c,h,p,f,d,g,y,v,m,b,w,k,x,S,N,z,I,A,T=t.call(this,{})||this;if(T.containerNodes=new Set,T.name=e.name,null==T.name){var C=T.getClassName().toLowerCase();T.name=Zo(C)}if(T.supportsMasking=!1,T.trainable_=!0,Array.isArray(e.inputs)?T.inputs=e.inputs.slice():T.inputs=[e.inputs],Array.isArray(e.outputs)?T.outputs=e.outputs.slice():T.outputs=[e.outputs],xa(T.inputs).length!==T.inputs.length)throw new sa("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+T.inputs.map((function(t){return t.name})));xa(T.outputs).length!==T.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+T.outputs.map((function(t){return t.name}))),T.inputLayers=[],T.inputLayersNodeIndices=[],T.inputLayersTensorIndices=[],T.outputLayers=[],T.outputLayersNodeIndices=[],T.outputLayersTensorIndices=[],T.layers=[],T.internalContainerRefs=[];try{for(var E=u(T.outputs),F=E.next();!F.done;F=E.next()){var D=(X=F.value).sourceLayer,L=X.nodeIndex,_=X.tensorIndex;T.outputLayers.push(D),T.outputLayersNodeIndices.push(L),T.outputLayersTensorIndices.push(_)}}catch(t){r={error:t}}finally{try{F&&!F.done&&(i=E.return)&&i.call(E)}finally{if(r)throw r.error}}try{for(var O=u(T.inputs),R=O.next();!R.done;R=O.next()){D=(X=R.value).sourceLayer,L=X.nodeIndex,_=X.tensorIndex;ha(0===L,"input layer has >1 nodes"),ha(0===_,"input layer has >1 tensors"),T.inputLayers.push(D),T.inputLayersNodeIndices.push(L),T.inputLayersTensorIndices.push(_)}}catch(t){a={error:t}}finally{try{R&&!R.done&&(o=O.return)&&o.call(O)}finally{if(a)throw a.error}}T.inputNames=[],T.outputNames=[],T.feedInputShapes=[],T.feedInputNames=[],T.feedOutputNames=[];for(var M=0;M<T.inputLayers.length;M++){if(!((D=T.inputLayers[M])instanceof ps))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+e.inputs+". Input "+M+" (0-based) originates from layer type "+D.getClassName()+".");T.inputNames.push(D.name),T.feedInputShapes.push(D.batchInputShape),T.feedInputNames.push(D.name)}try{for(var B=u(T.outputLayers),P=B.next();!P.done;P=B.next()){D=P.value;T.outputNames.push(D.name)}}catch(t){s={error:t}}finally{try{P&&!P.done&&(l=B.return)&&l.call(B)}finally{if(s)throw s.error}}T.internalInputShapes=T.inputs.map((function(t){return t.shape})),T.internalOutputShapes=T.outputs.map((function(t){return t.shape}));var U={},j={},W={},V={},q={},K=[],G=function(t,e,r,i,a,o){null!=i&&null!=a&&null!=o||(i=t.sourceLayer,a=t.nodeIndex,o=t.tensorIndex);var s=i.inboundNodes[a];if(-1!==r.indexOf(s))throw new oa("The tensor "+t.name+' at layer "'+i.name+'" is part of a cycle.');if(-1===e.indexOf(s)){T.containerNodes.add(n.nodeKey(i,a)),i.id in q||(q[i.id]=Object.keys(q).length),-1===r.indexOf(s)&&r.push(s);for(var u=s.inboundLayers.length,l=0;l<u;l++){var c=s.inputTensors[l],h=s.inboundLayers[l],p=s.nodeIndices[l],f=s.tensorIndices[l];G(c,e,r,h,p,f)}for(e.push(s);r.indexOf(s)>=0;)r.splice(r.indexOf(s),1);K.push(s)}},H=[],Z=[];try{for(var J=u(T.outputs),Y=J.next();!Y.done;Y=J.next()){var X=Y.value;G(X,H,Z)}}catch(t){c={error:t}}finally{try{Y&&!Y.done&&(h=J.return)&&h.call(J)}finally{if(c)throw c.error}}var $=K.slice().reverse();try{for(var Q=u($),tt=Q.next();!tt.done;tt=Q.next()){j[(xt=tt.value).id]=xt,xt.id in U||(U[xt.id]=0);var et=U[xt.id],nt=null==W[xt.outboundLayer.id]?0:W[xt.outboundLayer.id];et=Math.max(et,nt),W[xt.outboundLayer.id]=et,V[xt.outboundLayer.id]=xt.outboundLayer,U[xt.id]=et;for(M=0;M<xt.inboundLayers.length;M++){var rt=xt.inboundLayers[M],it=(L=xt.nodeIndices[M],rt.inboundNodes[L]),at=null==U[it.id]?0:U[it.id];U[it.id]=Math.max(et+1,at),j[it.id]=it}}}catch(t){p={error:t}}finally{try{tt&&!tt.done&&(f=Q.return)&&f.call(Q)}finally{if(p)throw p.error}}var ot={};for(var st in U){(et=U[st])in ot||(ot[et]=[]),ot[et].push(j[st])}var ut={};for(var lt in W){(et=W[lt])in ut||(ut[et]=[]),ut[et].push(V[lt])}var ct=Object.keys(ut).map((function(t){return parseInt(t,10)})).sort(ka);T.layers=[];try{for(var ht=u(ct),pt=ht.next();!pt.done;pt=ht.next()){var ft=ut[et=pt.value];ft.sort((function(t,e){var n=q[t.id],r=q[e.id];return n<r?-1:n>r?1:0}));try{for(var dt=(y=void 0,u(ft)),gt=dt.next();!gt.done;gt=dt.next()){(D=gt.value)instanceof n&&T.internalContainerRefs.push(D),T.layers.push(D)}}catch(t){y={error:t}}finally{try{gt&&!gt.done&&(v=dt.return)&&v.call(dt)}finally{if(y)throw y.error}}}}catch(t){d={error:t}}finally{try{pt&&!pt.done&&(g=ht.return)&&g.call(ht)}finally{if(d)throw d.error}}T.layersByDepth=ut,ct=Object.keys(ot).map((function(t){return parseInt(t,10)})).sort(ka);var yt=T.inputs.slice(),vt=[];try{for(var mt=u(ct),bt=mt.next();!bt.done;bt=mt.next()){et=bt.value;try{for(var wt=(w=void 0,u(ot[et])),kt=wt.next();!kt.done;kt=wt.next()){var xt;if(null!=(D=(xt=kt.value).outboundLayer)){try{for(var St=(x=void 0,u(xt.inputTensors)),Nt=St.next();!Nt.done;Nt=St.next()){X=Nt.value;if(-1===yt.indexOf(X))throw new oa("Graph disconnected: cannot obtain value for tensor "+X+' at layer "'+D.name+'". The following previous layers were accessed without issue: '+vt)}}catch(t){x={error:t}}finally{try{Nt&&!Nt.done&&(S=St.return)&&S.call(St)}finally{if(x)throw x.error}}try{for(var zt=(N=void 0,u(xt.outputTensors)),It=zt.next();!It.done;It=zt.next()){X=It.value;yt.push(X)}}catch(t){N={error:t}}finally{try{It&&!It.done&&(z=zt.return)&&z.call(zt)}finally{if(N)throw N.error}}vt.push(D.name)}}}catch(t){w={error:t}}finally{try{kt&&!kt.done&&(k=wt.return)&&k.call(wt)}finally{if(w)throw w.error}}}}catch(t){m={error:t}}finally{try{bt&&!bt.done&&(b=mt.return)&&b.call(mt)}finally{if(m)throw m.error}}T.nodesByDepth=ot;var At=T.layers.map((function(t){return t.name})),Tt=function(t){var e=At.filter((function(e){return e===t})).length;if(1!==e)throw new oa('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(At))};try{for(var Ct=u(At),Et=Ct.next();!Et.done;Et=Ct.next()){Tt(Et.value)}}catch(t){I={error:t}}finally{try{Et&&!Et.done&&(A=Ct.return)&&A.call(Ct)}finally{if(I)throw I.error}}return T.outboundNodes=[],T.inboundNodes=[],new ss({outboundLayer:T,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:T.inputs,outputTensors:T.outputs,inputMasks:T.inputs.map((function(t){return null})),outputMasks:T.outputs.map((function(t){return null})),inputShapes:T.inputs.map((function(t){return t.shape})),outputShapes:T.outputs.map((function(t){return t.shape}))}),T.built=!0,T._refCount=1,T}return a(n,t),n.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},n.prototype.dispose=function(){var t,e,n,r;this.assertNotDisposed();var i={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){try{for(var a=u(this.layers),o=a.next();!o.done;o=a.next()){var s=o.value;i.numDisposedVariables+=s.dispose().numDisposedVariables}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}try{for(var l=u(this.internalContainerRefs),c=l.next();!c.done;c=l.next()){var h=c.value;i.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}return i.refCountAfterDispose=this._refCount,i},Object.defineProperty(n.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach((function(e){e._trainableWeights.forEach((function(e){return e.trainable=t}))})),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"trainableWeights",{get:function(){var t,e;if(this._trainableWeights.length>0)throw new sa("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var n=[];try{for(var r=u(this.layers),i=r.next();!i.done;i=r.next()){var a=i.value;n=n.concat(a.trainableWeights)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nonTrainableWeights",{get:function(){var t,e,n,r,i=[];try{for(var a=u(this.layers),o=a.next();!o.done;o=a.next()){var s=o.value;i.push.apply(i,c(s.nonTrainableWeights))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var h=u(this.layers),p=h.next();!p.done;p=h.next()){s=p.value;l.push.apply(l,c(s.trainableWeights))}}catch(t){n={error:t}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return l.concat(i)}return i},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),n.prototype.loadWeights=function(t,e){var n,r,i,a;void 0===e&&(e=!0);var o={},s=0;try{for(var l=u(this.layers),c=l.next();!c.done;c=l.next()){var h=c.value;try{for(var p=(i=void 0,u(h.weights)),f=p.next();!f.done;f=p.next()){var d=f.value;if(null!=o[d.originalName])throw new sa("Duplicate weight name: "+d.originalName);o[d.originalName]=d,s++}}catch(t){i={error:t}}finally{try{f&&!f.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}var g=[];for(var y in t){var v=y;if(null==o[y]){var m=y.split("/");v=m.slice(0,-2).concat([m[m.length-1]]).join("/")}if(null!=o[v])g.push([o[v],t[y]]);else if(e)throw new sa("Provided weight data has no target variable: "+y);delete o[v]}if(e){var b=[];for(var y in o)b.push(y);if(b.length>0)throw new sa(b.length+" of "+s+" weights are not set: "+b)}rs(g)},n.prototype.updatedConfig=function(){var t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 3.15.0",e.backend="TensorFlow.js",e},n.prototype.toJSON=function(t,e){void 0===e&&(e=!0);var n=eu(this.updatedConfig());return e?JSON.stringify(n):n},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){t=da(t);for(var e=new ru,i=0;i<r.inputs.length;++i)e.add(r.inputs[i],t[i]);return ou(r.outputs,e,n)}))},n.prototype.computeMask=function(t,n){var r=this;return e.tidy((function(){var e;return t=da(t),e=null==n?ca(null,t.length):da(n),r.runInternalGraph(t,e)[1]}))},n.prototype.computeOutputShape=function(t){var e,n,r,i,a=Yo(t);if(a.length!==this.inputLayers.length)throw new sa("Invalid inputShape argument "+t+": model has "+this.inputLayers.length+" tensor inputs.");for(var o={},s=0;s<a.length;s++){var l=this.inputLayers[s],c=a[s];o[C=l.name+"_0_0"]=c}var h=Object.keys(this.nodesByDepth).map((function(t){return parseInt(t,10)})).sort(ka);if(h.length>1)try{for(var p=u(h),f=p.next();!f.done;f=p.next()){var d=f.value,g=this.nodesByDepth[d];try{for(var y=(r=void 0,u(g)),v=y.next();!v.done;v=y.next()){var m=v.value;l=m.outboundLayer;if(-1===this.inputLayers.map((function(t){return t.id})).indexOf(l.id)){for(var b=[],w=0;w<m.inboundLayers.length;w++){var k=m.inboundLayers[w],x=m.nodeIndices[w],S=m.tensorIndices[w],N=o[C=k.name+"_"+x+"_"+S];b.push(N)}var z=Yo(l.computeOutputShape(fa(b))),I=l.inboundNodes.indexOf(m);for(w=0;w<z.length;w++){o[C=l.name+"_"+I+"_"+w]=z[w]}}}}catch(t){r={error:t}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}var A=[],T=[];for(s=0;s<this.outputLayers.length;s++){l=this.outputLayers[s],I=this.outputLayersNodeIndices[s],S=this.outputLayersTensorIndices[s];var C=l.name+"_"+I+"_"+S;T.push(C)}for(s=0;s<T.length;s++){var E=T[s];ha(E in o),A.push(o[E])}return fa(A)},n.prototype.runInternalGraph=function(t,e){var n,r,i,a,o,s,c,h;null==e&&(e=ca(null,t.length));for(var p={},f=0;f<this.inputs.length;++f){var d=this.inputs[f],g=t[f],y=e[f];p[d.id]=[g,y]}var v=Object.keys(this.nodesByDepth).map((function(t){return parseInt(t,10)})).sort(ka);try{for(var m=u(v),b=m.next();!b.done;b=m.next()){var w=b.value,k=this.nodesByDepth[w];try{for(var x=(i=void 0,u(k)),S=x.next();!S.done;S=x.next()){var N=S.value,z=N.outboundLayer,I=N.inputTensors,A=N.outputTensors,T=new Array;try{for(var C=(o=void 0,u(I)),E=C.next();!E.done;E=C.next()){(d=E.value).id in p&&T.push(p[d.id])}}catch(t){o={error:t}}finally{try{E&&!E.done&&(s=C.return)&&s.call(C)}finally{if(o)throw o.error}}if(T.length===I.length){var F={},D=void 0,L=void 0,_=void 0,O=void 0;if(null!=N.callArgs&&(F=N.callArgs),1===T.length){var R=l(T[0],2),M=R[0],B=R[1];null==F.mask&&(F.mask=B),_=da(z.call(M,F)),O=da(z.computeMask(M,B)),D=[M],L=[B]}else D=T.map((function(t){return t[0]})),L=T.map((function(t){return t[1]})),null==F.mask&&(F.mask=L),_=da(z.call(D,F)),O=da(z.computeMask(D,L));if(z.activityRegularizer)throw new ua("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(f=0;f<A.length;++f){d=A[f],g=_[f],y=O[f];p[d.id]=[g,y]}}}}catch(t){i={error:t}}finally{try{S&&!S.done&&(a=x.return)&&a.call(x)}finally{if(i)throw i.error}}}}catch(t){n={error:t}}finally{try{b&&!b.done&&(r=m.return)&&r.call(m)}finally{if(n)throw n.error}}var P=[],U=[],j=[];try{for(var W=u(this.outputs),V=W.next();!V.done;V=W.next()){ha((d=V.value).id in p,"Could not compute output "+d.name+" : "+d.id);var q=l(p[d.id],2),K=q[0];y=q[1];j.push(K.shape),P.push(K),U.push(y)}}catch(t){c={error:t}}finally{try{V&&!V.done&&(h=W.return)&&h.call(W)}finally{if(c)throw c.error}}return[P,U,j]},n.prototype.buildNodeConversionMap=function(t){var e,r,i,a={};try{for(var o=u(this.layers),s=o.next();!s.done;s=o.next()){var l=s.value;i=l instanceof n?1:0;for(var c=0;c<l.inboundNodes.length;c++){var h=n.nodeKey(l,c);this.containerNodes.has(h)&&(a[h]=i,i+=1)}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return a},n.prototype.getLayer=function(t,e){var n,r;if(null!=e){if(this.layers.length<=e)throw new sa("Was asked to retrieve layer at index "+e+", but model only has "+this.layers.length+" layer(s).");return this.layers[e]}if(null==t)throw new sa("Provide either a layer name or layer index");try{for(var i=u(this.layers),a=i.next();!a.done;a=i.next()){var o=a.value;if(o.name===t)return o}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}throw new sa("No such layer: "+t)},n.prototype.calculateLosses=function(){var t=this;return e.tidy((function(){var e,r,i=[];try{for(var a=u(t.layers),o=a.next();!o.done;o=a.next())for(var s=o.value,l=0;l<s.inboundNodes.length;++l){var h=n.nodeKey(s,l);t.containerNodes.has(h)&&i.push.apply(i,c(s.calculateLosses()))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return i}))},n.prototype.getConfig=function(){var t,e,r={name:this.name},i=this.buildNodeConversionMap(this.layers),a=[];try{for(var o=u(this.layers),s=o.next();!s.done;s=o.next()){for(var l=(S=s.value).getClassName(),c=S.getConfig(),h=[],p=0;p<S.inboundNodes.length;p++){var f=S.inboundNodes[p],d=n.nodeKey(S,p),g={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),g=f.callArgs}catch(t){console.warn("Layer "+S.name+" was passed non-serializable keyword arguments: "+f.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),g={}}if(f.inboundLayers.length>0){for(var y=[],v=0;v<f.inboundLayers.length;v++){var m=f.inboundLayers[v],b=f.nodeIndices[v],w=f.tensorIndices[v];null==(z=i[n.nodeKey(m,b)])&&(z=0),y.push([m.name,z,w,g])}h.push(y)}}}var k={};k.name=S.name,k.className=l,k.config=c,k.inboundNodes=h,a.push(k)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}r.layers=a;var x=[];for(v=0;v<this.inputLayers.length;v++){var S=this.inputLayers[v];b=this.inputLayersNodeIndices[v],d=n.nodeKey(S,b);if(this.containerNodes.has(d)){null==(z=i[d])&&(z=0);w=this.inputLayersTensorIndices[v];x.push([S.name,z,w])}}r.inputLayers=x;var N=[];for(v=0;v<this.outputLayers.length;v++){S=this.outputLayers[v],b=this.outputLayersNodeIndices[v],d=n.nodeKey(S,b);if(this.containerNodes.has(d)){var z;null==(z=i[d])&&(z=0);w=this.outputLayersTensorIndices[v];N.push([S.name,z,w])}}return r.outputLayers=N,r},n.fromConfig=function(t,e,n,r){var i,a,o,s,l,c,h,p,f,d;void 0===r&&(r=!1);var g={},y={};function v(t,e){t.name in y?y[t.name].push(e):y[t.name]=[e]}function m(t,e){var n,r,i,a=[];try{for(var o=u(e),s=o.next();!s.done;s=o.next()){var l=s.value,c=l[0],h=l[1],p=l[2];if(i=null==l[3]?{}:l[3],!(c in g))return void v(t,e);var f=g[c];if(f.inboundNodes.length<=h)return void v(t,e);var d=f.inboundNodes[h];a.push(d.outputTensors[p])}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}a.length>0&&t.apply(fa(a),i)}function b(t){var n=t.name,i=Ns(t,null!=e.customObjects?e.customObjects:{});i.setFastWeightInitDuringBuild(r),g[n]=i,t.inboundNodes.forEach((function(t){if(!(t instanceof Array))throw new sa("Corrupted configuration, expected array for nodeData: "+t);v(i,t)}))}var w=e.name,k=e.layers;try{for(var x=u(k),S=x.next();!S.done;S=x.next()){b(I=S.value)}}catch(t){i={error:t}}finally{try{S&&!S.done&&(a=x.return)&&a.call(x)}finally{if(i)throw i.error}}for(;!Sa(y);)try{for(var N=(o=void 0,u(k)),z=N.next();!z.done;z=N.next()){var I=z.value;if((W=g[I.name]).name in y){var A=y[W.name];delete y[W.name];try{for(var T=(l=void 0,u(A)),C=T.next();!C.done;C=T.next()){m(W,C.value)}}catch(t){l={error:t}}finally{try{C&&!C.done&&(c=T.return)&&c.call(T)}finally{if(l)throw l.error}}}}}catch(t){o={error:t}}finally{try{z&&!z.done&&(s=N.return)&&s.call(N)}finally{if(o)throw o.error}}var E=[],F=[],D=e.inputLayers;try{for(var L=u(D),_=L.next();!_.done;_=L.next()){var O=(I=_.value)[0],R=I[1],M=I[2];ha(O in g);var B=(W=g[O]).inboundNodes[R].outputTensors;E.push(B[M])}}catch(t){h={error:t}}finally{try{_&&!_.done&&(p=L.return)&&p.call(L)}finally{if(h)throw h.error}}var P=e.outputLayers;try{for(var U=u(P),j=U.next();!j.done;j=U.next()){O=(I=j.value)[0],R=I[1],M=I[2];ha(O in g);var W;B=(W=g[O]).inboundNodes[R].outputTensors;F.push(B[M])}}catch(t){f={error:t}}finally{try{j&&!j.done&&(d=U.return)&&d.call(U)}finally{if(f)throw f.error}}return new t({inputs:E,outputs:F,name:w})},Object.defineProperty(n.prototype,"stateful",{get:function(){var t,e;if(this._stateful)throw new sa("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var n=u(this.layers),r=n.next();!r.done;r=n.next()){if(r.value.stateful)return!0}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return!1},enumerable:!0,configurable:!0}),n.prototype.resetStates=function(){var t=this;e.tidy((function(){t.layers.forEach((function(t){t.stateful&&t.resetStates()}))}))},n}(ls);function hu(t,e){return function(t,e,n){var r=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((function(t){return null}));if(1===r)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error("Provided "+n+" is an array of "+t.length+" element(s), but the model has "+r+" outputs. Make sure a set of weights is provided for each model output.");return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){var i=[];return e.forEach((function(e){e in t?i.push(t[e]):i.push(null)})),i}throw new Error("The model has multiple ("+r+") outputs, so "+n+" must be either an array with "+r+" elements or an object with "+e+" keys. Provided "+n+" not understood: "+JSON.stringify(t))}(t,e,"classWeight")}function pu(t,n,r,i){return o(this,void 0,void 0,(function(){var a,o,u,l,c;return s(this,(function(s){switch(s.label){case 0:if(null!=n||null!=i)throw new Error("Support sampleWeight is not implemented yet");return null==r?[3,2]:(a=e.tidy((function(){if(1===t.shape.length)return e.clone(t);if(2===t.shape.length){if(t.shape[1]>1){return e.argMax(t,1)}if(1===t.shape[1])return e.reshape(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+t.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+t.rank+") during handling of class weights. The rank is expected to be 1 or 2.")})),l=(u=Array).from,[4,a.data()]);case 1:return o=l.apply(u,[s.sent()]),e.dispose(a),c=[],o.forEach((function(t){if(null==r[t])throw new Error("classWeight must contain all classes in the training data. The class "+t+" exists in the data but not in classWeight");c.push(r[t])})),[2,e.tensor1d(c,"float32")];case 2:return[2,null]}}))}))}function fu(t,n){return e.mul(t,n)}function du(t,e){var n,i,a=e;n=a.xs,i=a.ys,r.util.assert(null!=n&&null!=i,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+e}));var o=gu("input",t.inputNames,n),s=gu("output",t.outputNames,i),u=o[0].shape[0];r.util.assert(o.length===t.inputs.length,(function(){return"LayersModel has "+t.inputs.length+" inputs, but the dataset provides "+o.length+" inputs.  (Expected input keys: "+JSON.stringify(t.inputNames)+")"})),r.util.assert(s.length===t.outputs.length,(function(){return"LayersModel has "+t.outputs.length+" outputs, but the dataset provides "+s.length+" outputs.  (Expected output keys: "+JSON.stringify(t.outputNames)+")"}));for(var l=function(e){r.util.assert(o[e].shape[0]===u,(function(){return"Batch size mismatch: input "+t.inputNames[e]+" has "+o[e].shape[0]+"; expected  "+u+" based on input "+t.inputNames[0]+"."}))},c=0;c<o.length;c++)l(c);for(var h=function(e){r.util.assert(s[e].shape[0]===u,(function(){return"Batch size mismatch: output "+t.outputNames[e]+" has "+s[e].shape[0]+"; expected  "+u+" based on input "+t.inputNames[0]+"."}))},p=0;p<s.length;p++)h(p);return{xs:o,ys:s}}function gu(t,e,n){var i,a;if(n instanceof r.Tensor)return[n];if(Array.isArray(n))return r.util.assert(n.length===e.length,(function(){return"Received an array of "+n.length+" Tensors, but expected "+e.length+" to match the "+t+" keys "+e+"."})),n;var o=[];try{for(var s=u(e),l=s.next();!l.done;l=s.next()){var c=l.value;if(null==n[c])throw new sa("The feature data generated by the dataset lacks the required "+t+" key '"+c+"'.");o.push(n[c])}}catch(t){i={error:t}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}return o}function yu(t,e,n){return o(this,void 0,void 0,(function(){var i,a,o,u,l,c,h,p,f,d,g,y,v,m,b,w,k,x,S,N,z,I,A,T,C,E,F,D,L,_,O,R,M,B;return s(this,(function(s){switch(s.label){case 0:if(i=null!=n.batchesPerEpoch,r.util.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),r.util.assert(null!=n,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),r.util.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs})),r.util.assert(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch})),r.util.assert(null==n.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,s.label=1;case 1:return s.trys.push([1,,26,27]),a=null!=n.validationData,o=void 0,u=void 0,a&&(vu(n.validationData)?r.util.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches})):(l=function(t){if(3===t.length)throw new ua("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData),o=l.xs,u=l.ys)),c=t.makeTrainFunction(),h=t.getDedupedMetricsNames(),p=void 0,p=a?h.slice().concat(h.map((function(t){return"val_"+t}))):h.slice(),f=ks(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,g=Ss(f,d,n.epochs,null,null,function(t,e){var n=null;null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size);return n}(e,n),null,a,p),y=g.callbackList,v=g.history,y.setModel(t),t.history=v,[4,y.onTrainBegin()];case 2:return s.sent(),t.stopTraining_=!1,m=null==n.initialEpoch?0:n.initialEpoch,[4,e.iterator()];case 3:b=s.sent(),s.label=4;case 4:return m<n.epochs?(w={},[4,y.onEpochBegin(m)]):[3,23];case 5:return s.sent(),k=0,x=0,i?[3,7]:[4,e.iterator()];case 6:b=s.sent(),s.label=7;case 7:return!i||k<n.batchesPerEpoch?[4,b.next()]:[3,21];case 8:return S=s.sent(),i&&S.done?(console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+k+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):null==S.value?[3,15]:(N=du(t,S.value),z=N.xs,I=N.ys,(A={}).batch=x,A.size=z[0].shape[0],[4,y.onBatchBegin(x,A)]);case 9:if(s.sent(),T=[],null==n.classWeight)return[3,13];C=hu(n.classWeight,t.outputNames),B=0,s.label=10;case 10:return B<C.length?(F=(E=T).push,[4,pu(I[B],null,C[B])]):[3,13];case 11:F.apply(E,[s.sent()]),s.label=12;case 12:return++B,[3,10];case 13:for(D=z.concat(I).concat(T),L=c(D),r.dispose(D),B=0;B<h.length;++B)_=h[B],O=L[B],A[_]=O,r.keep(O);return[4,y.onBatchEnd(x,A)];case 14:s.sent(),gs(A),x++,k++,s.label=15;case 15:return(i?k>=n.batchesPerEpoch:S.done)?a?(R=void 0,vu(n.validationData)?(M=da,[4,t.evaluateDataset(n.validationData,{batches:n.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return R=M.apply(void 0,[s.sent()]),[3,18];case 17:R=da(t.evaluate(o,u,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0})),s.label=18;case 18:for(B=0;B<t.metricsNames.length;++B)w["val_"+t.metricsNames[B]]=R[B];s.label=19;case 19:return[3,21];case 20:return t.stopTraining_?[3,21]:[3,7];case 21:return[4,y.onEpochEnd(m,w)];case 22:return s.sent(),m++,t.stopTraining_?[3,23]:[3,4];case 23:return[4,y.onTrainEnd()];case 24:return s.sent(),[4,t.history.syncData()];case 25:return s.sent(),[2,t.history];case 26:return t.isTraining=!1,[7];case 27:return[2]}}))}))}function vu(t){return"function"==typeof t.iterator}function mu(t,n,i){return o(this,void 0,void 0,(function(){var a,o,u,l,c,h,p,f,d,g;return s(this,(function(y){switch(y.label){case 0:if(a=null!=(i=i||{}).batches,o=t.testFunction,u=[],i.verbose>0)throw new ua("Verbose mode is not implemented yet.");return r.util.assert(!a||i.batches>0&&Number.isInteger(i.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(i.batches)})),"function"!=typeof n.next?[3,1]:(c=n,[3,3]);case 1:return[4,n.iterator()];case 2:c=y.sent(),y.label=3;case 3:l=c,h=0,p=0,f=function(){var n;return s(this,(function(s){switch(s.label){case 0:return[4,l.next()];case 1:return n=s.sent(),u=r.tidy((function(){if(n.value){var i=du(t,n.value),a=i.xs,s=i.ys,l=a.concat(s),c=r.tidy((function(){return o(l)}));if(r.dispose(l),0===p)for(var f=0;f<c.length;++f)u.push(e.scalar(0));var d=l[0].shape[0],g=function(t){var e=c[t],n=u[t];u[t]=r.tidy((function(){return r.add(u[t],r.mul(d,e))})),p>0&&r.dispose(n)};for(f=0;f<c.length;++f)g(f);r.dispose(c),h+=d,++p}return u})),n.done?(a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+i.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}}))},y.label=4;case 4:return!a||p<i.batches?[5,f()]:[3,6];case 5:return"break"===y.sent()?[3,6]:[3,4];case 6:for(d=0;d<u.length;++d)g=u[d],u[d]=r.div(u[d],h),r.dispose(g);return[2,fa(u)]}}))}))}function bu(t){r.util.assert(t>0&&Number.isInteger(t),(function(){return"batchSize is required to be a positive integer, but got "+t}))}function wu(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((function(t){return so(t,e,n-e)})):so(t,e,n-e)}function ku(t,e){return r.tidy((function(){return null==t?null:Array.isArray(t)?t.map((function(t){return ku(t,e)})):yo(t,"int32"===e.dtype?e:r.cast(e,"int32"))}))}function xu(t,e){for(var n=[],r=0,i=null;r<t;)(i=r+e)>=t&&(i=t),n.push([r,i]),r=i;return n}function Su(t,n,i,a,u,l,c,h,p,f,d,g,y,v,m){return o(this,void 0,void 0,(function(){var o,b,w,k,x,S,N,z;return s(this,(function(I){switch(I.label){case 0:if(null==u&&(u=32),null==l&&(l=1),null==d&&(d=!0),null==y&&(y=0),o=!1,null!=p&&null!=f&&(o=!0),null!=m&&(o=!0,null==v))throw new sa("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return null!=(b=t.checkNumSamples(i,u,v,"steps_per_epoch"))&&(w=io(0,b)),null==c&&(c=1),k=Ss(h,c,l,y,b,v,u,o,g),x=k.callbackList,S=k.history,x.setModel(t),t.history=S,[4,x.onTrainBegin()];case 1:I.sent(),t.stopTraining_=!1,N=function(l){var c,h,g,y,m;return s(this,(function(k){switch(k.label){case 0:return[4,x.onEpochBegin(l)];case 1:if(k.sent(),c={},null==v)return[3,2];throw new ua("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===d)throw new ua("batch shuffling is not implemneted yet");d&&e.util.shuffle(w),h=e.tensor1d(w),g=xu(b,u),y=function(e){var l;return s(this,(function(s){switch(s.label){case 0:return l={},[4,x.onBatchBegin(e,l)];case 1:return s.sent(),r.tidy((function(){var s=g[e][0],d=g[e][1],y=so(h,s,d-s);l.batch=e,l.size=d-s;for(var v=ku(i,y),m=n(v),b=0;b<a.length;++b){var w=a[b],k=m[b];l[w]=k,r.keep(k)}if(e===g.length-1&&o){var x=t.testLoop(p,f,u);for(b=0;b<a.length;++b){w=a[b],k=x[b];r.keep(k),c["val_"+w]=k}}})),[4,x.onBatchEnd(e,l)];case 2:return s.sent(),gs(l),t.stopTraining_?[2,"break"]:[2]}}))},m=0,k.label=3;case 3:return m<g.length?[5,y(m)]:[3,6];case 4:if("break"===k.sent())return[3,6];k.label=5;case 5:return++m,[3,3];case 6:h.dispose(),k.label=7;case 7:return[4,x.onEpochEnd(l,c)];case 8:return k.sent(),t.stopTraining_?[2,"break"]:[2]}}))},z=y,I.label=2;case 2:return z<l?[5,N(z)]:[3,5];case 3:if("break"===I.sent())return[3,5];I.label=4;case 4:return++z,[3,2];case 5:return[4,x.onTrainEnd()];case 6:return I.sent(),[4,t.history.syncData()];case 7:return I.sent(),[2,t.history]}}))}))}function Nu(t,e,n,i){return void 0===i&&(i={}),o(this,void 0,void 0,(function(){var a,o,u,l,c,h,p,f,d,g,y,v,m,b,w,k,x,S,N,z,I,A;return s(this,(function(s){switch(s.label){case 0:if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,s.label=1;case 1:return s.trys.push([1,,7,8]),bu(g=null==i.batchSize?32:i.batchSize),!1,[4,t.standardizeUserData(e,n,i.sampleWeight,i.classWeight,false,g)];case 2:if(y=s.sent(),a=y[0],o=y[1],d=y[2],v=!1,m=void 0,!(null!=i.validationData&&i.validationData.length>0))return[3,4];if(v=!0,2!==i.validationData.length)throw 3===i.validationData.length?new ua("validationData including sample weights is not supported yet."):new sa("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+i.validationData+" is invalid.");return c=i.validationData[0],h=i.validationData[1],!0,[4,t.standardizeUserData(c,h,null,null,true,g)];case 3:return b=s.sent(),p=b[0],f=b[1],m=p.concat(f),[3,5];case 4:null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1?(v=!0,w=Math.floor(a[0].shape[0]*(1-i.validationSplit)),k=a[0].shape[0],p=wu(a,w,k),u=a,a=wu(a,0,w),f=wu(o,w,k),l=o,o=wu(o,0,w),m=p.concat(f)):null!=i.validationSteps&&(v=!0),s.label=5;case 5:return x=a.concat(o).concat(d),t.checkTrainableWeightsConsistency(),S=t.makeTrainFunction(),N=t.getDedupedMetricsNames(),z=void 0,I=void 0,v?(t.makeTestFunction(),z=t.testFunction,I=N.slice().concat(N.map((function(t){return"val_"+t})))):(z=null,m=[],I=N.slice()),A=ks(i.callbacks,i.yieldEvery),[4,Su(t,S,x,N,g,i.epochs,i.verbose,A,z,m,i.shuffle,I,i.initialEpoch,null,null)];case 6:return[2,s.sent()];case 7:return t.isTraining=!1,Iu(a,e),Iu(o,n),Iu(u,e),Iu(l,n),Iu(p,c),Iu(f,h),null!=d&&r.dispose(d),[7];case 8:return[2]}}))}))}function zu(t){var n=[];t instanceof e.Tensor&&(t=[t]);for(var r=0;r<t.length;++r){var i=t[r];if(1===i.rank)n.push(oo(i,1));else{if(0===i.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");n.push(i)}}return n}function Iu(t,n){if(null!=t){var r=[];if(n instanceof e.Tensor)r.push(n.id);else if(Array.isArray(n))n.forEach((function(t){return r.push(t.id)}));else if(null!=n)for(var i in n){var a=n[i];r.push(a.id)}var o=[];if(t instanceof e.Tensor)-1===r.indexOf(t.id)&&o.push(t);else if(Array.isArray(t))t.forEach((function(t){-1===r.indexOf(t.id)&&o.push(t)}));else if(null!=t)for(var i in t){var s=t[i];-1===r.indexOf(s.id)&&o.push(s)}o.forEach((function(t){t.isDisposed||t.dispose()}))}}function Au(t){return Array.isArray(t)}function Tu(t){return!function(t){return t instanceof e.Tensor}(t)&&!Au(t)}function Cu(t,e,n,r,i){var a,o,s;if(void 0===r&&(r=!0),void 0===i&&(i=""),null==e||0===e.length){if(null!=t){var l=!1;if(Au(t)&&t.length>0)l=!0;else if(Tu(t)){for(var c in t)if(t.hasOwnProperty(c)){l=!0;break}}else l=!0;if(l)throw new sa("Error when checking model "+i+" expected no data, but got "+t)}return[]}if(null==t)return e.map((function(t){return null}));if(Tu(t)){t=t,s=[];try{for(var h=u(e),p=h.next();!p.done;p=h.next()){var f=p.value;if(null==t[f])throw new sa('No data provided for "'+f+'". Need data for each key in: '+e);s.push(t[f])}}catch(t){a={error:t}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(a)throw a.error}}}else if(Au(t)){if((t=t).length!==e.length)throw new sa("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+e.length+" Tensor(s), but instead got the following list of Tensor(s): "+t);s=t}else{if(t=t,e.length>1)throw new sa("The model "+i+" expects "+e.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+t.shape);s=[t]}if(s=zu(s),null!=n)for(var d=0;d<e.length;++d)if(null!=n[d]){var g=s[d];if(g.shape.length!==n[d].length)throw new sa("Error when checking "+i+": expected "+e[d]+" to have "+n[d].length+" dimension(s). but got array with shape "+g.shape);for(var y=0;y<n[d].length;++y)if(0!==y||r){var v=g.shape[y],m=n[d][y];if(null!=m&&m>=0&&v!==m)throw new sa(i+" expected a batch of elements where each example has shape ["+n[d].slice(1,n[d].length)+"] (i.e.,tensor shape [*,"+n[d].slice(1,n[d].length)+"]) but the "+i+" received an input with "+g.shape[0]+" examples, each with shape ["+g.shape.slice(1,g.shape.length)+"] (tensor shape ["+g.shape+"])")}}return s}function Eu(t,e,n,r,i){var a;if(void 0===r&&(r=!0),void 0===i&&(i=""),Array.isArray(t)){if(t.length!==e.length)throw new sa("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+e.length+" Tensor(s), but instead got "+t.length+" Tensors(s).");a=t}else{if(e.length>1)throw new sa("The model expects "+e.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(t.shape)+".");a=[t]}if(null!=n)for(var o=0;o<e.length;++o)if(null!=n[o]){var s=a[o];if(s.shape.length!==n[o].length)throw new sa("Error when checking "+i+": expected "+e[o]+" to have "+n[o].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[o].length;++u)if(0!==u||r){var l=s.shape[u],c=n[o][u];if(null!=c&&c!==l)throw new sa("Error when checking "+i+": expected "+e[o]+" to have shape "+JSON.stringify(n[o])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}var Fu=function(t){function n(e){var n=t.call(this,e)||this;return n.isTraining=!1,n}return a(n,t),n.prototype.summary=function(t,e,n){if(void 0===n&&(n=console.log),!this.built)throw new sa("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Js(this,t,e,n)},n.prototype.compile=function(t){var n,r,i=this;if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){var n={Adagrad:function(){return e.train.adagrad(.01)},Adadelta:function(){return e.train.adadelta(1,.95,ia())},Adam:function(){return e.train.adam(.001,.9,.999,ia())},Adamax:function(){return e.train.adamax(.002,.9,.999,ia(),0)},RMSProp:function(){return e.train.rmsprop(.001,.9,0,ia())},SGD:function(){return e.train.sgd(.01)}};if(n.adagrad=n.Adagrad,n.adadelta=n.Adadelta,n.adam=n.Adam,n.adamax=n.Adamax,n.rmsprop=n.RMSProp,n.sgd=n.SGD,t in n)return n[t]();throw new sa("Unknown Optimizer "+t)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof e.Optimizer))throw new sa("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var a=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new sa("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+t.loss+".");var o=t.loss;a=o.map((function(t){return _s(t)}))}else{var s=_s(t.loss);this.outputs.forEach((function(t){a.push(s)}))}else{for(var l in t.loss=t.loss,t.loss)if(-1===this.outputNames.indexOf(l))throw new sa('Unknown entry in loss dictionary: "'+l+'". Only expected the following keys: '+this.outputNames);try{for(var c=u(this.outputNames),h=c.next();!h.done;h=c.next()){l=h.value;null==t.loss[l]&&console.warn('Output "'+l+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+l+" during training"),a.push(_s(t.loss[l]))}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}this.lossFunctions=a,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var p=0;p<this.outputs.length;++p){var f=this.internalOutputShapes[p];l=this.outputNames[p];this.feedOutputNames.push(l),this.feedOutputShapes.push(f),this.feedLossFns.push(this.lossFunctions[p])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ya("loss",(function(){for(var t=0;t<i.outputs.length;++t)if(-1===d.indexOf(t)){var e=i.lossFunctions[t];i.outputs.length>1&&(i.metricsTensors.push([e,t]),i.metricsNames.push(i.outputNames[t]+"_loss"))}}));var g=function(t,e){var n,r,i;if(null==t||Array.isArray(t)&&0===t.length)return e.map((function(t){return[]}));if("string"==typeof t||"function"==typeof t)i=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+t);i=t}if(Array.isArray(i))return e.map((function(t){return i}));var a=[];try{for(var o=u(e),s=o.next();!s.done;s=o.next()){var l=s.value,c=i.hasOwnProperty(l)?i[l]:[];Array.isArray(c)||(c=[c]),a.push(c)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a}(t.metrics,this.outputNames);Ya("metric",(function(){for(var t=function(t){if(-1!==d.indexOf(t))return"continue";!function(e){var n,r,a,o,s,l=function(e){if("string"==typeof e&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(e)){var n=i.internalOutputShapes[t];1===n[n.length-1]||i.lossFunctions[t]===Fs?-1!==["accuracy","acc"].indexOf(e)?o=Os:-1!==["crossentropy","ce"].indexOf(e)&&(o=Us):i.lossFunctions[t]===Es?-1!==["accuracy","acc"].indexOf(e)?o=js:-1!==["crossentropy","ce"].indexOf(e)&&(o=Vs):-1!==["accuracy","acc"].indexOf(e)?o=Rs:-1!==["crossentropy","ce"].indexOf(e)&&(o=Ws);var r=void 0;-1!==["accuracy","acc"].indexOf(e)?r="acc":-1!==["crossentropy","ce"].indexOf(e)&&(r="ce"),s=o,a=""+r}else{var u=function(t){if("string"==typeof t&&t in qs)return qs[t];if("string"!=typeof t&&null!=t)return t;throw new sa("Unknown metric "+t)}(e);s=u,a=""+Ks(e)}var l;Ya(a,(function(){l=s})),function(t,e,n){i.outputNames.length>1&&(e=i.outputNames[t]+"_"+e),i.metricsNames.push(e),i.metricsTensors.push([n,t])}(t,a,l)};try{for(var c=(n=void 0,u(e)),h=c.next();!h.done;h=c.next()){l(h.value)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}(g[t])},e=0;e<i.outputs.length;++e)t(e)})),this.collectedTrainableWeights=this.trainableWeights},n.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},n.prototype.evaluate=function(t,e,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;bu(r);var i=this.standardizeUserDataXY(t,e,!0,r);try{var a=i[0].concat(i[1]);this.makeTestFunction();var o=this.testFunction;return fa(this.testLoop(o,a,r,n.verbose,n.steps))}finally{Iu(i[0],t),Iu(i[1],e)}},n.prototype.evaluateDataset=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){return this.makeTestFunction(),[2,mu(this,t,e)]}))}))},n.prototype.checkNumSamples=function(t,e,n,r){var i;if(void 0===r&&(r="steps"),null!=n){if(i=null,null!=e)throw new sa("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+e)}else{if(null==t)throw new sa("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i},n.prototype.execute=function(t,n){var r,i;if(Array.isArray(n)&&0===n.length)throw new sa("`outputs` is an empty Array, which is not allowed.");var a=Array.isArray(n),o=a?n:[n],s=this.retrieveSymbolicTensors(o),l=new ru;if(t instanceof e.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new sa("The number of inputs provided ("+t.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var c=0;c<this.inputs.length;++c)l.add(this.inputs[c],t[c])}else try{for(var h=u(this.inputs),p=h.next();!p.done;p=h.next()){var f=p.value,d=t[f.name];if(null==d)throw new sa("No value is provided for the model's input "+f.name);l.add(f,d)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}var g=ou(s,l);return a?g:g[0]},n.prototype.retrieveSymbolicTensors=function(t){var e,n,r=ca(null,t.length),i=t.length;try{for(var a=u(this.layers),o=a.next();!o.done;o=a.next()){for(var s=o.value,l=Array.isArray(s.output)?s.output:[s.output],c=l.map((function(t){return t.name})),h=0;h<t.length;++h){var p=c.indexOf(t[h]);if(-1!==p&&(r[h]=l[p],i--),0===i)break}if(0===i)break}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}if(i>0){var f=[];throw r.forEach((function(e,n){null==e&&f.push(t[n])})),new sa("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(f))}return r},n.prototype.predictLoop=function(t,e,n){var i=this;return void 0===e&&(e=32),void 0===n&&(n=!1),r.tidy((function(){var a=i.checkNumSamples(t);if(n)throw new ua("Verbose predictLoop() is not implemented yet.");for(var o=xu(a,e),s=i.outputs.map((function(t){return[]})),u=function(e){r.tidy((function(){var n=o[e][0],r=o[e][1],a=wu(t,n,r),s=[];if(Array.isArray(a))for(var u=0;u<a.length;++u)s.push({key:i.inputs[u],value:a[u]});else s.push({key:i.inputs[0],value:a});var l=new ru(s);return ou(i.outputs,l)})).forEach((function(t,e){return s[e].push(t)}))},l=0;l<o.length;++l)u(l);return fa(s.map((function(t){return r.concat(t,0)})))}))},n.prototype.predict=function(t,e){void 0===e&&(e={});var n=zu(t);Eu(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==e.batchSize?32:e.batchSize;return bu(r),this.predictLoop(n,r)}finally{Iu(n,t)}},n.prototype.predictOnBatch=function(t){Eu(t,this.inputNames,this.feedInputShapes,!0);var e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)},n.prototype.standardizeUserDataXY=function(t,n,r,i){if(null==this.optimizer_)throw new oa("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var a=[],o=0;o<this.feedOutputShapes.length;++o){var s=this.feedOutputShapes[o];this.feedLossFns[o]===Es?a.push(s.slice(0,s.length-1).concat([1])):a.push(s)}if(function(t,n,r){var i=xa(t.map((function(t){return t.shape[0]})));i.sort();var a=xa(n.map((function(t){return t.shape[0]})));if(a.sort(),i.length>1)throw new sa("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map((function(t){return t.shape}))));if(a.length>1)throw new sa("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(n.map((function(t){return t.shape}))));if(i.length>0&&a.length>0&&!e.util.arraysEqual(i,a))throw new sa("Input Tensors should have the same number of samples as target Tensors. Found "+i[0]+" input sample(s) and "+a[0]+" target sample(s).")}(t=Cu(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=Cu(n,this.feedOutputNames,a,!1,"target")),function(t,e,n){for(var r=[Is,Fs,Cs],i=0;i<t.length;++i){var a=t[i],o=e[i],s=n[i];if(null!=o){if(o===Cs&&1===a.shape[a.shape.length-1])throw new sa("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=a.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var h=u[c],p=l[c];if(null!=p&&h!==p)throw new sa("A target Tensor with shape "+a.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&t[0].shape[0]%i!=0)throw new sa("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+i+". Found: "+t[0].shape[0]+" sample(s).");return[t,n]},n.prototype.standardizeUserData=function(t,e,n,r,i,a){return void 0===i&&(i=!0),o(this,void 0,void 0,(function(){var o,u,c,h,p,f,d,g;return s(this,(function(s){switch(s.label){case 0:if(o=l(this.standardizeUserDataXY(t,e,i,a),2),u=o[0],c=o[1],null!=n)throw new Error("sample weight is not supported yet.");if(h=null,null==r)return[3,4];p=hu(r,this.outputNames),h=[],f=0,s.label=1;case 1:return f<p.length?(g=(d=h).push,[4,pu(c[f],null,p[f])]):[3,4];case 2:g.apply(d,[s.sent()]),s.label=3;case 3:return++f,[3,1];case 4:return[2,[u,c,h]]}}))}))},n.prototype.testLoop=function(t,n,i,a,o){var s=this;return void 0===a&&(a=0),r.tidy((function(){var u=s.checkNumSamples(n,i,o,"steps"),l=[];if(a>0)throw new ua("Verbose mode is not implemented yet.");if(null!=o)throw new ua("steps mode in testLoop() is not implemented yet");for(var c=xu(u,i),h=e.tensor1d(io(0,u)),p=0;p<c.length;++p){var f=c[p][0],d=c[p][1],g=so(h,f,d-f),y=ku(n,g),v=t(y);if(0===p)for(var m=0;m<v.length;++m)l.push(e.scalar(0));for(m=0;m<v.length;++m){var b=v[m];l[m]=r.add(l[m],r.mul(d-f,b))}}for(m=0;m<l.length;++m)l[m]=r.div(l[m],u);return l}))},n.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,e=[],n=0;n<t.length;++n){var r=t[n],i=r;if(pa(t,r)>1)i+="_"+pa(t.slice(0,n),r);e.push(i)}return e},n.prototype.makeTrainFunction=function(){var t=this;return function(e){var n=[],i=e.slice(0,t.inputs.length),a=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),o=e.slice(t.inputs.length+t.outputs.length,t.inputs.length+2*t.outputs.length),s=[],u=t.collectedTrainableWeights.map((function(t){return t.read()}));return[t.optimizer_.minimize((function(){for(var e=[],u=0;u<t.inputs.length;++u)e.push({key:t.inputs[u],value:i[u]});var l,c=new ru(e),h=ou(t.outputs,c,{training:!0});for(u=0;u<t.lossFunctions.length;++u){var p=(0,t.lossFunctions[u])(a[u],h[u]);null!=o[u]&&(p=fu(p,o[u]));var f=r.mean(p);n.push(f),l=0===u?p:r.add(l,p)}for(u=0;u<t.metricsTensors.length;++u){var d=void 0;if(t.outputs.length>1&&u<t.outputs.length)d=n[u];else{var g=t.metricsTensors[u][0],y=t.metricsTensors[u][1];d=r.mean(g(a[y],h[y]))}r.keep(d),s.push(d)}return l=r.mean(l),t.calculateLosses().forEach((function(t){l=r.add(l,t)})),l}),!0,u)].concat(s)}},n.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(e){return r.tidy((function(){for(var n,i=[],a=e.slice(0,t.inputs.length),o=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=[],u=0;u<t.inputs.length;++u)s.push({key:t.inputs[u],value:a[u]});var l=new ru(s),c=ou(t.outputs,l);for(u=0;u<t.lossFunctions.length;++u){var h=t.lossFunctions[u],p=r.mean(h(o[u],c[u]));n=0===u?p:r.add(n,p),i.push(n)}for(u=0;u<t.metricsTensors.length;++u){var f=t.metricsTensors[u][0],d=t.metricsTensors[u][1],g=r.mean(f(o[d],c[d]));i.push(g)}return i}))}},n.prototype.fit=function(t,e,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){return s(this,(function(r){return[2,Nu(this,t,e,n)]}))}))},n.prototype.fitDataset=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){return[2,yu(this,t,e)]}))}))},n.prototype.trainOnBatch=function(t,e){return o(this,void 0,void 0,(function(){var n,i,a,o,l,c,h,p,f,d,g,y;return s(this,(function(s){switch(s.label){case 0:return[4,this.standardizeUserData(t,e)];case 1:n=s.sent(),i=n[0],a=n[1],o=this.makeTrainFunction(),l=o(i.concat(a)),c=[],s.label=2;case 2:s.trys.push([2,7,8,9]),h=u(l),p=h.next(),s.label=3;case 3:return p.done?[3,6]:[4,p.value.data()];case 4:f=s.sent(),c.push(f[0]),s.label=5;case 5:return p=h.next(),[3,3];case 6:return[3,9];case 7:return d=s.sent(),g={error:d},[3,9];case 8:try{p&&!p.done&&(y=h.return)&&y.call(h)}finally{if(g)throw g.error}return[7];case 9:return r.dispose(l),Iu(n[0],t),Iu(n[1],e),[2,fa(c)]}}))}))},n.prototype.getNamedWeights=function(t){for(var e=[],n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),a=0;a<r.length;++a)n&&!r[a].trainable||e.push({name:r[a].originalName,tensor:i[a]});return e},Object.defineProperty(n.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=t.prototype.dispose.call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var n=r.memory().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-r.memory().numTensors}return e},n.prototype.getLossIdentifiers=function(){var t,e,n,r,i;if("string"==typeof this.loss)i=ga(this.loss);else if(Array.isArray(this.loss)){try{for(var a=u(this.loss),o=a.next();!o.done;o=a.next()){if("string"!=typeof o.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}i=this.loss.map((function(t){return ga(t)}))}else{var s=Object.keys(this.loss);i={};var l=this.loss;try{for(var c=u(s),h=c.next();!h.done;h=c.next()){var p=h.value;if("string"!=typeof l[p])throw new Error("Serialization of non-string loss is not supported.");i[p]=ga(l[p])}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}return i},n.prototype.getMetricIdentifiers=function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[ga(Ks(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(t){return ga(Ks(t))}));var t={};for(var e in this.metrics)t[e]=ga(Ks(this.metrics[e]));return t},n.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},n.prototype.loadTrainingConfig=function(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var e,n,r=Ns(tu(t.optimizer_config));if("string"==typeof t.loss)e=ya(t.loss);else if(Array.isArray(t.loss))e=t.loss.map((function(t){return ya(t)}));else if(null!=t.loss)for(var i in e={},t.loss)e[i]=ya(t.loss[i]);if(Array.isArray(t.metrics))n=t.metrics.map((function(t){return ya(t)}));else if(null!=t.metrics)for(var i in n={},t.metrics)n[i]=ya(t.metrics[i]);this.compile({loss:e,metrics:n,optimizer:r})},n.prototype.save=function(t,n){return o(this,void 0,void 0,(function(){var r,i,a,o,u,l,h,p,f,d,g;return s(this,(function(s){switch(s.label){case 0:if("string"==typeof t){if(0===(r=e.io.getSaveHandlers(t)).length)throw new sa("Cannot find any save handlers for URL '"+t+"'");if(r.length>1)throw new sa("Found more than one ("+r.length+") save handlers for URL '"+t+"'");t=r[0]}if(null==t.save)throw new sa("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,e.io.encodeWeights(this.getNamedWeights(n))];case 1:return i=s.sent(),!1,null,a=this.toJSON(null,false),o={modelTopology:a,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.15.0",convertedBy:null},null!=n&&n.includeOptimizer&&null!=this.optimizer?(o.trainingConfig=this.getTrainingConfig(),u="optimizer",d=(f=e.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,d.apply(f,[s.sent(),u])];case 3:l=s.sent(),h=l.data,p=l.specs,(g=i.specs).push.apply(g,c(p)),i.data=e.io.concatenateArrayBuffers([i.data,h]),s.label=4;case 4:return null!=this.userDefinedMetadata&&(!0,Hs(this.userDefinedMetadata,this.name,true),o.userDefinedMetadata=this.userDefinedMetadata),o.weightData=i.data,o.weightSpecs=i.specs,[2,t.save(o)]}}))}))},n.prototype.setUserDefinedMetadata=function(t){Hs(t,this.name),this.userDefinedMetadata=t},n.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},n}(cu);Fu.className="Model",e.serialization.registerClass(Fu);var Du=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(Fu);function Lu(t,n,r){return o(this,void 0,void 0,(function(){var i,a,o,u,l,c,h,p,f;return s(this,(function(s){switch(s.label){case 0:if(null==r&&(r={}),null==t.load)throw new sa("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,t.load()];case 1:if(i=s.sent(),null!=(a=i.modelTopology).model_config&&(a=a.model_config),o=null==r.strict||r.strict,u=null!=i.weightData&&null!=i.weightSpecs&&o,l=Ns(tu(a),n,u),null!=(c=i.trainingConfig)&&l.loadTrainingConfig(c),null!=i.userDefinedMetadata&&l.setUserDefinedMetadata(i.userDefinedMetadata),null==i.weightData)return[3,4];if(null==i.weightSpecs)throw new sa("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return h=function(t,n){var r=e.io.decodeWeights(t,n),i={},a=[];return n.forEach((function(t){"optimizer"===t.group?a.push({name:t.name,tensor:r[t.name]}):i[t.name]=r[t.name]})),{modelWeights:i,optimizerWeights:a}}(i.weightData,i.weightSpecs),p=h.modelWeights,f=h.optimizerWeights,l.loadWeights(p,o),null!=l.optimizer&&f.length>0?[4,l.optimizer.setWeights(f)]:[3,3];case 2:s.sent(),s.label=3;case 3:e.dispose(p),e.dispose(f.map((function(t){return t.tensor}))),s.label=4;case 4:return[2,l]}}))}))}Du.className="Functional",e.serialization.registerClass(Du);var _u=function(t){function n(e){var n,r,i=t.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},i.trainable=!0,i.built=!1,i.name=null!=e.name?e.name:Zo("sequential_"),null!=e.layers)try{for(var a=u(e.layers),o=a.next();!o.done;o=a.next()){var s=o.value;i.add(s)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}return a(n,t),n.prototype.checkShape=function(t){if(t.inboundNodes[0].outputTensors[0].shape.some((function(t){return t<0})))throw new sa("Negative dimension size caused by adding layer "+t.name+" with input shape ["+t.inboundNodes[0].inputTensors[0].shape+"]")},n.prototype.add=function(t){var e,r=t instanceof n||t instanceof Fu;if(r){if(1!==(e=t).outputs.length)throw new sa("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==e.inputs.length)throw new sa("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new sa("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=fs({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(r)this.outputs=e.outputs,this.inputs=e.inputs;else{if(1!==t.inboundNodes.length)throw new sa("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+t.name+" which has "+t.inboundNodes.length+" pre-existing inbound connections.");if(1!==t.inboundNodes[0].outputTensors.length)throw new sa("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=cs(this.outputs[0])}this.inboundNodes=[],new ss({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ca(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(t){return t.shape})),outputShapes:this.outputs[0].shape})}else{var a=t.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},n.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},n.prototype.call=function(t,e){return null==this.model&&this.build(),this.model.call(t,e)},n.prototype.build=function(t){if($o(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Fu({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},n.prototype.countParams=function(){return this.built||this.build(),t.prototype.countParams.call(this)},n.prototype.summary=function(e,n,r){void 0===r&&(r=console.log),this.built||this.build(),t.prototype.summary.call(this,e,n,r)},n.prototype.setWeights=function(t){null==this.model&&this.build(),this.model.setWeights(t)},n.prototype.evaluate=function(t,e,n){if(void 0===n&&(n={}),!this.built)throw new oa("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)},n.prototype.evaluateDataset=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){if(!this.built)throw new oa("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,e)]}))}))},n.prototype.predict=function(t,e){return void 0===e&&(e={}),null==this.model&&this.build(),this.model.predict(t,e)},n.prototype.predictOnBatch=function(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)},n.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(n.prototype,"optimizer",{get:function(){return null==this.model?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!0,configurable:!0}),n.prototype.fit=function(t,e,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){return s(this,(function(r){if(!this.built)throw new oa("The model needs to be compiled before being used.");return[2,this.model.fit(t,e,n)]}))}))},n.prototype.fitDataset=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){if(!this.built)throw new oa("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,e)]}))}))},n.prototype.trainOnBatch=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){return[2,this.model.trainOnBatch(t,e)]}))}))},n.fromConfig=function(t,r,i,a){var o,s,l;void 0===a&&(a=!1);var c={};if(r instanceof Array){if(null==r[0].className||"Merge"===r[0].className)throw new sa("Legacy serialization format not supported yet.");l=r}else e.util.assert(null!=r.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),l=r.layers,delete r.layers,c=r;var h=new t(c);if(!(h instanceof n))throw new ua("Sequential.fromConfig called on non-Sequential input: "+h);try{for(var p=u(l),f=p.next();!f.done;f=p.next()){var d=f.value,g=Ns(d,undefined,a);a&&g.setFastWeightInitDuringBuild(!0),h.add(g)}}catch(t){o={error:t}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(o)throw o.error}}return h},Object.defineProperty(n.prototype,"stopTraining",{get:function(){if(null==this.model)throw new sa("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(null==this.model)throw new sa("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!0,configurable:!0}),n.prototype.getConfig=function(){var t,e,n=[];try{for(var r=u(this.layers),i=r.next();!i.done;i=r.next()){var a=i.value,o={};o.className=a.getClassName(),o.config=a.getConfig(),n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return{name:this.name,layers:n}},n}(Fu);function Ou(t){return fs(t)}_u.className="Sequential",e.serialization.registerClass(_u);var Ru=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getConfig=function(){return{}},e}(e.serialization.Serializable),Mu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=1),function(t,e){if(void 0===e&&(e=1),1!==e)throw new ua("Support for alpha values other than 1 ("+e+") is not implemented yet.");return r.elu(t)}(t,e)},e}(Ru);Mu.className="elu",e.serialization.registerClass(Mu);var Bu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return r.selu(t)},e}(Ru);Bu.className="selu",e.serialization.registerClass(Bu);var Pu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return r.relu(t)},e}(Ru);Pu.className="relu",e.serialization.registerClass(Pu);var Uu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t){return e.tidy((function(){return r.minimum(6,r.relu(t))}))},n}(Ru);Uu.className="relu6",e.serialization.registerClass(Uu);var ju=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return t},e}(Ru);ju.className="linear",e.serialization.registerClass(ju);var Wu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return r.sigmoid(t)},e}(Ru);Wu.className="sigmoid",e.serialization.registerClass(Wu);var Vu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t){return function(t){return e.tidy((function(){var e=r.add(.5,r.mul(.2,t));return r.clipByValue(e,0,1)}))}(t)},n}(Ru);Vu.className="hardSigmoid",e.serialization.registerClass(Vu);var qu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return r.softplus(t)},e}(Ru);qu.className="softplus",e.serialization.registerClass(qu);var Ku=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t){return function(t){return e.tidy((function(){return r.div(t,r.add(r.abs(t),1))}))}(t)},n}(Ru);Ku.className="softsign",e.serialization.registerClass(Ku);var Gu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return r.tanh(t)},e}(Ru);Gu.className="tanh",e.serialization.registerClass(Gu);var Hu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),r.softmax(t,e)},e}(Ru);Hu.className="softmax",e.serialization.registerClass(Hu);var Zu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),r.logSoftmax(t,e)},e}(Ru);Zu.className="logSoftmax",e.serialization.registerClass(Zu);var Ju=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t,n){return void 0===n&&(n=1),e.tidy((function(){return r.mul(r.sigmoid(r.mul(t,n)),t)}))},n}(Ru);Ju.className="swish",e.serialization.registerClass(Ju);var Yu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.apply=function(t){return e.tidy((function(){return r.mul(t,r.tanh(r.softplus(t)))}))},n}(Ru);function Xu(t){return t.getClassName()}function $u(t,n){return void 0===n&&(n={}),wa(t,e.serialization.SerializationMap.getMap().classNameMap,n,"activation")}function Qu(t){var e;return null==t?$u(e={className:"linear",config:{}}):"string"==typeof t?((e={}).className=t,e.config={},$u(e)):t instanceof Ru?t:$u(t)}function tl(t){if(null!=t&&"object"!=typeof t)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+t)}Yu.className="mish",e.serialization.registerClass(Yu);var el=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(e.serialization.Serializable),nl=function(t){function n(e){var n=t.call(this)||this;return tl(e),n.l1=null==e||null==e.l1?.01:e.l1,n.l2=null==e||null==e.l2?.01:e.l2,n.hasL1=0!==n.l1,n.hasL2=0!==n.l2,n}return a(n,t),n.prototype.apply=function(t){var n=this;return e.tidy((function(){var i=e.zeros([1]);return n.hasL1&&(i=e.add(i,e.sum(r.mul(n.l1,e.abs(t))))),n.hasL2&&(i=e.add(i,e.sum(r.mul(n.l2,vo(t))))),r.reshape(i,[])}))},n.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},n.fromConfig=function(t,e){return new t({l1:e.l1,l2:e.l2})},n}(el);nl.className="L1L2",e.serialization.registerClass(nl);var rl={l1l2:"L1L2"};function il(t){return ma(t)}function al(t,n){return void 0===n&&(n={}),wa(t,e.serialization.SerializationMap.getMap().classNameMap,n,"regularizer")}function ol(t){return null==t?null:"string"==typeof t?al({className:t in rl?rl[t]:t,config:{}}):t instanceof el?t:al(t)}var sl=function(t){function n(e){var n=t.call(this,null==e?{}:e)||this;return n.supportsMasking=!0,null!=e&&(n.maxValue=e.maxValue),n}return a(n,t),n.prototype.call=function(t,n){t=Xo(t);var r=e.relu(t);return null!=this.maxValue&&(r=e.clipByValue(r,0,this.maxValue)),r},n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e={maxValue:this.maxValue},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);sl.className="ReLU",e.serialization.registerClass(sl);var ul=function(t){function n(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_ALPHA=.3,null==e&&(e={}),n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return a(n,t),n.prototype.call=function(t,n){var r=Xo(t);return e.leakyRelu(r,this.alpha)},n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);ul.className="LeakyReLU",e.serialization.registerClass(ul);var ll=function(t){function n(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),n.supportsMasking=!0,n.alphaInitializer=Vo(e.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=ol(e.alphaRegularizer),n.alphaConstraint=Ba(e.alphaConstraint),null==e.sharedAxes)n.sharedAxes=null;else if(Array.isArray(e.sharedAxes))n.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new sa("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);n.sharedAxes=[e.sharedAxes]}return n}return a(n,t),n.prototype.build=function(t){var e,n,r=(t=$o(t)).slice(1);if(null!=this.sharedAxes)try{for(var i=u(this.sharedAxes),a=i.next();!a.done;a=i.next()){r[(s=a.value)-1]=1}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var o={};if(null!=this.sharedAxes)for(var s=1;s<t.length;++s)o[s]=t[s];this.inputSpec=[new is({ndim:t.length,axes:o})],this.built=!0},n.prototype.call=function(t,n){return t=Xo(t),e.prelu(t,this.alpha.read())},n.prototype.getConfig=function(){var e={alphaInitializer:Wo(this.alphaInitializer),alphaRegularizer:il(this.alphaRegularizer),alphaConstraint:Ra(this.alphaConstraint),sharedAxes:this.sharedAxes},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);ll.className="PReLU",e.serialization.registerClass(ll);var cl=function(t){function n(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==n.DEFAULT_ALPHA)throw new ua("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return a(n,t),n.prototype.call=function(t,n){var r=Xo(t);return e.elu(r)},n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);cl.className="ELU",e.serialization.registerClass(cl);var hl=function(t){function n(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_THETA=1,null==e&&(e={}),n.theta=null==e.theta?n.DEFAULT_THETA:e.theta,n}return a(n,t),n.prototype.call=function(t,n){var r=Xo(t);return e.mul(r,e.cast(e.greater(r,this.theta),"float32"))},n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e={theta:this.theta},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);hl.className="ThresholdedReLU",e.serialization.registerClass(hl);var pl=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_AXIS=1,null==e&&(e={}),n.softmax=(new Hu).apply,n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n}return a(e,t),e.prototype.call=function(t,e){var n=Xo(t);return this.softmax(n,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(ls);function fl(t,e,n){if("number"==typeof t)return ca(t,e);if(t.length!==e)throw new sa("The "+n+" argument must be an integer or tuple of "+e+" integers. Received: "+t.length+" elements.");for(var r=0;r<e;++r){var i=t[r];if((a=i)!==parseInt(a.toString(),10))throw new sa("The "+n+" argument must be an integer or tuple of "+e+" integers. Received: "+JSON.stringify(t)+" including a non-integer number "+i)}return t;var a}function dl(t,e,n,r,i){return void 0===i&&(i=1),null==t?t:(a="same"===n?t:t-(e+(e-1)*(i-1))+1,Math.floor((a+r-1)/r));var a}function gl(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+ro([n-e,0]);else{if("same"!==r)throw new sa("Unsupport padding mode: "+r+".");t*=e}return t}function yl(t,n){return e.tidy((function(){return Ga(n),"channelsFirst"===n?r.transpose(t,[0,2,3,1]):t}))}function vl(t,n){return e.tidy((function(){return Ga(n),"channelsFirst"===n?r.transpose(t,[0,2,3,4,1]):t}))}function ml(t,n,i,a,o,s,u,l){return void 0===a&&(a=[1,1]),void 0===o&&(o="valid"),void 0===l&&(l=null),e.tidy((function(){if(null==s&&(s="channelsLast"),Ga(s),3!==t.rank&&4!==t.rank)throw new sa("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+t.rank+".");if(3!==n.rank&&4!==n.rank)throw new sa("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+t.rank+".");var e=yl(t,s);if("causal"===o)throw new ua("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return e=r.fused.conv2d({x:e,filter:n,strides:a,pad:"same"===o?"same":"valid",dilations:u,dataFormat:"NHWC",bias:i,activation:l}),"channelsFirst"===s&&(e=r.transpose(e,[0,3,1,2])),e}))}pl.className="Softmax",e.serialization.registerClass(pl);var bl=function(t){function e(n,r){var i=t.call(this,r)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(r),i.rank=n,Ia(i.rank,"rank"),1!==i.rank&&2!==i.rank&&3!==i.rank)throw new ua("Convolution layer for rank other than 1, 2, or 3 ("+i.rank+") is not implemented yet.");if(i.kernelSize=fl(r.kernelSize,n,"kernelSize"),i.strides=fl(null==r.strides?1:r.strides,n,"strides"),i.padding=null==r.padding?"valid":r.padding,Ha(i.padding),i.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Ga(i.dataFormat),i.activation=Qu(r.activation),i.useBias=null==r.useBias||r.useBias,i.biasInitializer=Vo(r.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=Ba(r.biasConstraint),i.biasRegularizer=ol(r.biasRegularizer),i.activityRegularizer=ol(r.activityRegularizer),i.dilationRate=fl(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new sa("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank){if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new sa("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate))}else if(3===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate,i.dilationRate];else if(3!==i.dilationRate.length)throw new sa("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(i.dilationRate));return i}return a(e,t),e.verifyArgs=function(t){if(ha("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!za(t.kernelSize,"number",1,3))throw new sa("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(t.kernelSize)+".")},e.prototype.getConfig=function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Xu(this.activation),useBias:this.useBias,biasInitializer:Wo(this.biasInitializer),biasRegularizer:il(this.biasRegularizer),activityRegularizer:il(this.activityRegularizer),biasConstraint:Ra(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(ls),wl=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.kernel=null,n.verifyArgs(r),i.filters=r.filters,Ia(i.filters,"filters"),i.kernelInitializer=Vo(r.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=Ba(r.kernelConstraint),i.kernelRegularizer=ol(r.kernelRegularizer),i}return a(n,t),n.prototype.build=function(t){var e;t=$o(t);var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new sa("The channel dimension of the input should be defined. Found "+t[n]);var r=t[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(e={},e[n]=r,e)}],this.built=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var n;t=Xo(t);var a,o,s,u,l,c,h,p=null==i.bias?null:i.bias.read(),f=Ta(i.activation.getClassName());if(null!=f&&2===i.rank)n=ml(t,i.kernel.read(),p,i.strides,i.padding,i.dataFormat,i.dilationRate,f);else{if(1===i.rank)a=t,o=i.kernel.read(),s=p,u=i.strides[0],l=i.padding,c=i.dataFormat,h=i.dilationRate[0],void 0===u&&(u=1),void 0===l&&(l="valid"),void 0===h&&(h=1),n=e.tidy((function(){if(null==c&&(c="channelsLast"),Ga(c),3!==a.shape.length)throw new sa("The input of a conv1dWithBias operation should be 3, but is "+a.shape.length+" instead.");if(3!==o.shape.length)throw new sa("The kernel for a conv1dWithBias operation should be 3, but is "+o.shape.length+" instead");if(null!=s&&1!==s.shape.length)throw new sa("The bias for a conv1dWithBias operation should be 1, but is "+o.shape.length+" instead");if("channelsFirst"===c&&(a=r.transpose(a,[0,2,1])),"causal"===l)throw new ua("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var t=r.conv1d(a,o,u,"same"===l?"same":"valid","NWC",h);return null!=s&&(t=bo(t,s)),t}));else if(2===i.rank)n=ml(t,i.kernel.read(),p,i.strides,i.padding,i.dataFormat,i.dilationRate);else{if(3!==i.rank)throw new ua("convolutions greater than 3D are not implemented yet.");n=function(t,n,i,a,o,s,u){return void 0===a&&(a=[1,1,1]),void 0===o&&(o="valid"),e.tidy((function(){if(null==s&&(s="channelsLast"),Ga(s),4!==t.rank&&5!==t.rank)throw new sa("conv3dWithBias expects input to be of rank 4 or 5, but received "+t.rank+".");if(4!==n.rank&&5!==n.rank)throw new sa("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+t.rank+".");var e=vl(t,s);if("causal"===o)throw new ua("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return e=r.conv3d(e,n,a,"same"===o?"same":"valid","NDHWC",u),null!=i&&(e=bo(e,i)),"channelsFirst"===s&&(e=r.transpose(e,[0,4,1,2,3])),e}))}(t,i.kernel.read(),p,i.strides,i.padding,i.dataFormat,i.dilationRate)}null!=i.activation&&(n=i.activation.apply(n))}return n}))},n.prototype.computeOutputShape=function(t){t=$o(t);for(var e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2),r=0;r<n.length;++r){var i=dl(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);e.push(i)}var a=[t[0]];return"channelsLast"===this.dataFormat?(a=a.concat(e)).push(this.filters):(a.push(this.filters),a=a.concat(e)),a},n.prototype.getConfig=function(){var e={filters:this.filters,kernelInitializer:Wo(this.kernelInitializer),kernelRegularizer:il(this.kernelRegularizer),kernelConstraint:Ra(this.kernelConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n.verifyArgs=function(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new sa("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))},n}(bl),kl=function(t){function e(n){var r=t.call(this,2,n)||this;return e.verifyArgs(n),r}return a(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!za(t.kernelSize,"number",1,2))throw new sa("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e}(wl);kl.className="Conv2D",e.serialization.registerClass(kl);var xl=function(t){function e(n){var r=t.call(this,3,n)||this;return e.verifyArgs(n),r}return a(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new sa("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(t.kernelSize)+".")},e}(wl);xl.className="Conv3D",e.serialization.registerClass(xl);var Sl=function(t){function e(e){var n=t.call(this,e)||this;if(n.inputSpec=[new is({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new sa("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return a(e,t),e.prototype.build=function(t){var e;if(4!==(t=$o(t)).length)throw new sa("Input should have rank 4; Received input shape: "+JSON.stringify(t));var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new sa("The channel dimension of the inputs should be defined. Found `None`.");var r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new is({ndim:4,axes:(e={},e[n]=r,e)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return r.tidy((function(){var e=Xo(t);if(4!==e.shape.length)throw new sa("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var i,a,o=e.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,a=3):(i=1,a=2);var u=o[i],l=o[a],c=n.kernelSize[0],h=n.kernelSize[1],p=n.strides[0],f=n.strides[1],d=[s,gl(u,p,c,n.padding),gl(l,f,h,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(e=r.transpose(e,[0,2,3,1]));var g=r.conv2dTranspose(e,n.kernel.read(),d,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(g=r.transpose(g,[0,3,1,2])),null!=n.bias&&(g=bo(g,n.bias.read(),n.dataFormat)),null!=n.activation&&(g=n.activation.apply(g)),g}))},e.prototype.computeOutputShape=function(t){var e,n,r,i=(t=$o(t)).slice();"channelsFirst"===this.dataFormat?(e=1,n=2,r=3):(e=3,n=1,r=2);var a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[e]=this.filters,i[n]=gl(i[n],s,a,this.padding),i[r]=gl(i[r],u,o,this.padding),i},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.dilationRate,e},e}(kl);Sl.className="Conv2DTranspose",e.serialization.registerClass(Sl);var Nl=function(t){function e(e){var n=t.call(this,e)||this;if(n.inputSpec=[new is({ndim:5})],"same"!==n.padding&&"valid"!==n.padding)throw new sa("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return a(e,t),e.prototype.build=function(t){var e;if(5!==(t=$o(t)).length)throw new sa("Input should have rank 5; Received input shape: "+JSON.stringify(t));var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new sa("The channel dimension of the inputs should be defined. Found `None`.");var r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new is({ndim:5,axes:(e={},e[n]=r,e)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return r.tidy((function(){var e=Xo(t);if(5!==e.shape.length)throw new sa("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var i,a,o,s=e.shape,u=s[0];"channelsFirst"===n.dataFormat?(o=2,i=3,a=4):(o=1,i=2,a=3);var l=s[o],c=s[i],h=s[a],p=n.kernelSize[0],f=n.kernelSize[1],d=n.kernelSize[2],g=n.strides[0],y=n.strides[1],v=n.strides[2],m=[u,gl(l,g,p,n.padding),gl(c,y,f,n.padding),gl(h,v,d,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(e=r.transpose(e,[0,2,3,4,1]));var b=r.conv3dTranspose(e,n.kernel.read(),m,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(b=r.transpose(b,[0,4,1,2,3])),null!==n.bias&&(b=bo(b,n.bias.read(),n.dataFormat)),null!==n.activation&&(b=n.activation.apply(b)),b}))},e.prototype.computeOutputShape=function(t){var e,n,r,i,a=(t=$o(t)).slice();"channelsFirst"===this.dataFormat?(e=1,n=2,r=3,i=4):(e=4,n=1,r=2,i=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],l=this.strides[0],c=this.strides[1],h=this.strides[2];return a[e]=this.filters,a[n]=gl(a[n],l,o,this.padding),a[r]=gl(a[r],c,s,this.padding),a[i]=gl(a[i],h,u,this.padding),a},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.dilationRate,e},e}(xl);Nl.className="Conv3DTranspose",e.serialization.registerClass(Nl);var zl=function(t){function n(e,n){var r=t.call(this,e,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new sa("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new sa("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new sa("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=Vo(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=ol(n.depthwiseRegularizer),r.depthwiseConstraint=Ba(n.depthwiseConstraint),r.pointwiseInitializer=Vo(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=ol(n.pointwiseRegularizer),r.pointwiseConstraint=Ba(n.pointwiseConstraint),r}return a(n,t),n.prototype.build=function(t){var e;if((t=$o(t)).length<this.rank+2)throw new sa("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(t));var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n]||t[n]<0)throw new sa("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[n]));for(var r=t[n],i=this.kernelSize.concat([r,this.depthMultiplier]),a=[],o=0;o<this.rank;++o)a.push(1);a.push(r*this.depthMultiplier,this.filters);var s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new is({ndim:this.rank+2,axes:(e={},e[n]=r,e)})],this.built=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var e;if(t=Xo(t),1===i.rank)throw new ua("1D separable convolution is not implemented yet.");return 2===i.rank&&("channelsFirst"===i.dataFormat&&(t=r.transpose(t,[0,2,3,1])),e=r.separableConv2d(t,i.depthwiseKernel.read(),i.pointwiseKernel.read(),i.strides,i.padding,i.dilationRate,"NHWC")),i.useBias&&(e=bo(e,i.bias.read(),i.dataFormat)),null!=i.activation&&(e=i.activation.apply(e)),"channelsFirst"===i.dataFormat&&(e=r.transpose(e,[0,3,1,2])),e}))},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Wo(this.depthwiseInitializer),e.pointwiseInitializer=Wo(this.pointwiseInitializer),e.depthwiseRegularizer=il(this.depthwiseRegularizer),e.pointwiseRegularizer=il(this.pointwiseRegularizer),e.depthwiseConstraint=Ra(this.depthwiseConstraint),e.pointwiseConstraint=Ra(this.pointwiseConstraint),e},n}(wl);zl.className="SeparableConv";var Il=function(t){function e(e){return t.call(this,2,e)||this}return a(e,t),e}(zl);Il.className="SeparableConv2D",e.serialization.registerClass(Il);var Al=function(t){function e(n){var r=t.call(this,1,n)||this;return e.verifyArgs(n),r.inputSpec=[{ndim:3}],r}return a(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!za(t.kernelSize,"number",1,1))throw new sa("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(t.kernelSize)+".")},e}(wl);Al.className="Conv1D",e.serialization.registerClass(Al);var Tl=function(t){function n(e){var n=t.call(this,e)||this;return"number"==typeof e.cropping?n.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?n.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:n.cropping=e.cropping,n.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,n.inputSpec=[{ndim:4}],n}return a(n,t),n.prototype.computeOutputShape=function(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){if(t=Xo(t),"channelsLast"===r.dataFormat){var e=lo(t,r.cropping[0][0],t.shape[1]-r.cropping[0][0]-r.cropping[0][1],2);return lo(e,r.cropping[1][0],t.shape[2]-r.cropping[1][1]-r.cropping[1][0],3)}e=lo(t,r.cropping[0][0],t.shape[2]-r.cropping[0][0]-r.cropping[0][1],3);return lo(e,r.cropping[1][0],t.shape[3]-r.cropping[1][1]-r.cropping[1][0],4)}))},n.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);Tl.className="Cropping2D",e.serialization.registerClass(Tl);var Cl=function(t){function e(e){var n,r=t.call(this,e)||this;return r.DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ga(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,n=r.interpolation,Na(ja,"InterpolationFormat",n),r}return a(e,t),e.prototype.computeOutputShape=function(t){if("channelsFirst"===this.dataFormat){var e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]},e.prototype.call=function(t,e){var n=this;return r.tidy((function(){var e=Xo(t),i=e.shape;if("channelsFirst"===n.dataFormat){e=r.transpose(e,[0,2,3,1]);var a=n.size[0]*i[2],o=n.size[1]*i[3],s="nearest"===n.interpolation?r.image.resizeNearestNeighbor(e,[a,o]):r.image.resizeBilinear(e,[a,o]);return r.transpose(s,[0,3,1,2])}a=n.size[0]*i[1],o=n.size[1]*i[2];return"nearest"===n.interpolation?r.image.resizeNearestNeighbor(e,[a,o]):r.image.resizeBilinear(e,[a,o])}))},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(ls);Cl.className="UpSampling2D",e.serialization.registerClass(Cl);var El=function(t){function n(e){var n=t.call(this,2,e)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,n.depthwiseInitializer=Vo(e.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Ba(e.depthwiseConstraint),n.depthwiseRegularizer=ol(e.depthwiseRegularizer),n}return a(n,t),n.prototype.build=function(t){if((t=$o(t)).length<4)throw new sa("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(t)+".");var e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new sa("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+t[e]+").");var n=t[e],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){t=Xo(t);var n,a,o,s,u,l,c=(n=t,a=i.depthwiseKernel.read(),o=i.strides,s=i.padding,u=i.dataFormat,l=null,void 0===o&&(o=[1,1]),void 0===s&&(s="valid"),e.tidy((function(){null==u&&(u="channelsLast"),Ga(u);var t=yl(n,u);if(4!==n.rank)throw new sa("Input for depthwiseConv2d is required to be 4-D, but is instead "+n.rank+"-D");if(4!==a.rank)throw new sa("depthwiseKernel is required to be 4-D, but is instead "+a.rank+"-D");return t=r.depthwiseConv2d(t,a,o,"same"===s?"same":"valid","NHWC",l),"channelsFirst"===u&&(t=r.transpose(t,[0,3,1,2])),t})));return i.useBias&&(c=bo(c,i.bias.read(),i.dataFormat)),null!=i.activation&&(c=i.activation.apply(c)),c}))},n.prototype.computeOutputShape=function(t){t=$o(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=dl(e,this.kernelSize[0],this.padding,this.strides[0]),a=dl(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],r,i,a]:[t[0],i,a,r]},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Wo(this.depthwiseInitializer),e.depthwiseRegularizer=il(this.depthwiseRegularizer),e.depthwiseConstraint=Ra(this.depthwiseRegularizer),e},n}(bl);function Fl(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new sa("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=i(e),constants:n=i(n)}}function Dl(t,e,n,i,a,o,s,u){return void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===u&&(u=!1),r.tidy((function(){var l=e.shape.length;if(l<3)throw new sa("Input should be at least 3D, but is "+l+"D.");var c=[1,0].concat(io(2,l));if(e=r.transpose(e,c),null!=o)throw new ua("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=r.cast(r.cast(a,"bool"),"float32")).rank===l-1&&(a=r.expandDims(a,-1)),a=r.transpose(a,c)),i&&(e=r.reverse(e,0),null!=a&&(a=r.reverse(a,0)));var h,p,f=[],d=n,g=e.shape[0],y=r.unstack(e);null!=a&&(p=r.unstack(a));for(var v,m=function(e){var n=y[e],i=r.tidy((function(){return t(n,d)}));if(null==a)h=i[0],d=i[1];else{var o=r.tidy((function(){var t=p[e],n=r.sub(r.onesLike(t),t);return{output:r.add(r.mul(i[0],t),r.mul(d[0],n)),newStates:d.map((function(e,a){return r.add(r.mul(i[1][a],t),r.mul(e,n))}))}}));h=o.output,d=o.newStates}u&&f.push(h)},b=0;b<g;++b)m(b);if(u){v=r.stack(f,1)}return[h,v,d]}))}El.className="DepthwiseConv2D",e.serialization.registerClass(El);var Ll=function(t){function n(e){var n,r=t.call(this,e)||this;if(null==e.cell)throw new sa("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(e.cell)?new jl({cells:e.cell}):e.cell).stateSize)throw new sa("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new is({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return a(n,t),n.prototype.getStates=function(){return null==this.states_?io(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(t){return null})):this.states_},n.prototype.setStates=function(t){this.states_=t},n.prototype.computeOutputShape=function(t){var e,n;Jo(t)&&(t=t[0]),t=t;var r=this.cell.stateSize;Array.isArray(r)||(r=[r]);var i,a=r[0];if(i=this.returnSequences?[t[0],t[1],a]:[t[0],a],this.returnState){var o=[];try{for(var s=u(r),l=s.next();!l.done;l=s.next()){var c=l.value;o.push([t[0],c])}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return[i].concat(o)}return i},n.prototype.computeMask=function(t,e){var n=this;return r.tidy((function(){Array.isArray(e)&&(e=e[0]);var t=n.returnSequences?e:null;if(n.returnState){var r=n.states.map((function(t){return null}));return[t].concat(r)}return t}))},Object.defineProperty(n.prototype,"states",{get:function(){if(null==this.states_){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[],n=0;n<t;++n)e.push(null);return e}return this.states_},set:function(t){this.states_=t},enumerable:!0,configurable:!0}),n.prototype.build=function(t){if(null!=this.numConstants)throw new ua("Constants support is not implemented in RNN yet.");Jo(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new is({shape:c([n,null],r)});var i,a=[t[0]].concat(t.slice(2));if(this.cell.build(a),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!e.util.arraysEqual(this.stateSpec.map((function(t){return t.shape[t.shape.length-1]})),i))throw new sa("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=i.map((function(t){return new is({shape:[null,t]})}));this.stateful&&this.resetStates()},n.prototype.resetStates=function(t,n){var i=this;void 0===n&&(n=!1),e.tidy((function(){if(!i.stateful)throw new aa("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=i.inputSpec[0].shape[0];if(null==a)throw new sa("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==i.states_)Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map((function(t){return r.zeros([a,t])})):i.states_=[r.zeros([a,i.cell.stateSize])];else if(null==t)r.dispose(i.states_),null!=i.keptStates&&(r.dispose(i.keptStates),i.keptStates=[]),Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map((function(t){return r.zeros([a,t])})):i.states_[0]=r.zeros([a,i.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==i.states_.length)throw new sa("Layer "+i.name+" expects "+i.states_.length+" state(s), but it received "+t.length+" state value(s). Input received: "+t);!0===n?i.keptStates.push(i.states_.slice()):r.dispose(i.states_);for(var o=0;o<i.states_.length;++o){var s=t[o],u=Array.isArray(i.cell.stateSize)?i.cell.stateSize[o]:i.cell.stateSize,l=[a,u];if(!e.util.arraysEqual(s.shape,l))throw new sa("State "+o+" is incompatible with layer "+i.name+": expected shape="+l+", received shape="+s.shape);i.states_[o]=s}}i.states_=i.states_.map((function(t){return r.keep(t.clone())}))}))},n.prototype.apply=function(e,n){var r,i,a=null==n?null:n.initialState,o=null==n?null:n.constants;null==n&&(n={});var s=Fl(e,a,o,this.numConstants);e=s.inputs,a=s.initialState,o=s.constants;var l=[],c=[];if(null!=a){n.initialState=a,l=l.concat(a),this.stateSpec=[];try{for(var h=u(a),p=h.next();!p.done;p=h.next()){var f=p.value;this.stateSpec.push(new is({shape:f.shape}))}}catch(t){r={error:t}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}c=c.concat(this.stateSpec)}if(null!=o&&(n.constants=o,l=l.concat(o),this.numConstants=o.length),l[0]instanceof as){var d=[e].concat(l),g=this.inputSpec.concat(c),y=this.inputSpec;this.inputSpec=g;var v=t.prototype.apply.call(this,d,n);return this.inputSpec=y,v}return t.prototype.apply.call(this,e,n)},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){var e=null==n?null:n.mask,i=null==n?null:n.training,a=null==n?null:n.initialState;t=Xo(t),null==a&&(a=r.stateful?r.states_:r.getInitialState(t));var o=Array.isArray(r.cell.stateSize)?r.cell.stateSize.length:1;if(a.length!==o)throw new sa("RNN Layer has "+o+" state(s) but was passed "+a.length+" initial state(s).");r.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:i},u=Dl((function(t,e){var n=r.cell.call([t].concat(e),s);return[n[0],n.slice(1)]}),t,a,r.goBackwards,e,null,r.unroll,r.returnSequences),l=u[0],c=u[1],h=u[2];r.stateful&&r.resetStates(h,i);var p=r.returnSequences?c:l;return r.returnState?[p].concat(h):p}))},n.prototype.getInitialState=function(t){var n=this;return e.tidy((function(){var e=r.zeros(t.shape);return e=oo(e=r.sum(e,[1,2])),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map((function(t){return t>1?po(e,[1,t]):e})):n.cell.stateSize>1?[po(e,[1,n.cell.stateSize])]:[e]}))},Object.defineProperty(n.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),n.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(r.numConstants=this.numConstants);var i=this.cell.getConfig();return this.getClassName()===n.className&&(r.cell={className:this.cell.getClassName(),config:i}),Object.assign({},i,e,r)},n.fromConfig=function(t,e,n){void 0===n&&(n={});var r=Ns(e.cell,n);return new t(Object.assign(e,{cell:r}))},n}(ls);Ll.className="RNN",e.serialization.registerClass(Ll);var _l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(ls),Ol=function(t){function n(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,Ia(n.units,"units"),n.activation=Qu(null==e.activation?n.DEFAULT_ACTIVATION:e.activation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=Vo(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Vo(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Vo(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=ol(e.kernelRegularizer),n.recurrentRegularizer=ol(e.recurrentRegularizer),n.biasRegularizer=ol(e.biasRegularizer),n.kernelConstraint=Ba(e.kernelConstraint),n.recurrentConstraint=Ba(e.recurrentConstraint),n.biasConstraint=Ba(e.biasConstraint),n.dropout=no([1,ro([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=no([1,ro([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.dropoutFunc=e.dropoutFunc,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(n,t),n.prototype.build=function(t){t=$o(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){if(2!==(t=t).length)throw new sa("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var e=t[1];t=t[0];var a,o=null!=n.training&&n.training;0<i.dropout&&i.dropout<1&&null==i.dropoutMask&&(i.dropoutMask=Wl({ones:function(){return r.onesLike(t)},rate:i.dropout,training:o,dropoutFunc:i.dropoutFunc})),0<i.recurrentDropout&&i.recurrentDropout<1&&null==i.recurrentDropoutMask&&(i.recurrentDropoutMask=Wl({ones:function(){return r.onesLike(e)},rate:i.recurrentDropout,training:o,dropoutFunc:i.dropoutFunc}));var s=i.dropoutMask,u=i.recurrentDropoutMask;a=go(null!=s?r.mul(t,s):t,i.kernel.read()),null!=i.bias&&(a=bo(a,i.bias.read())),null!=u&&(e=r.mul(e,u));var l=r.add(a,go(e,i.recurrentKernel.read()));return null!=i.activation&&(l=i.activation.apply(l)),[l,l]}))},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={units:this.units,activation:Xu(this.activation),useBias:this.useBias,kernelInitializer:Wo(this.kernelInitializer),recurrentInitializer:Wo(this.recurrentInitializer),biasInitializer:Wo(this.biasInitializer),kernelRegularizer:il(this.kernelRegularizer),recurrentRegularizer:il(this.recurrentRegularizer),biasRegularizer:il(this.biasRegularizer),activityRegularizer:il(this.activityRegularizer),kernelConstraint:Ra(this.kernelConstraint),recurrentConstraint:Ra(this.recurrentConstraint),biasConstraint:Ra(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,n)},n}(_l);Ol.className="SimpleRNNCell",e.serialization.registerClass(Ol);var Rl=function(t){function n(e){return e.cell=new Ol(e),t.call(this,e)||this}return a(n,t),n.prototype.call=function(n,i){var a=this;return e.tidy((function(){null!=a.cell.dropoutMask&&(r.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),null!=a.cell.recurrentDropoutMask&&(r.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var e=null==i?null:i.mask,o=null==i?null:i.training,s=null==i?null:i.initialState;return t.prototype.call.call(a,n,{mask:e,training:o,initialState:s})}))},n.fromConfig=function(t,e){return new t(e)},n}(Ll);Rl.className="SimpleRNN",e.serialization.registerClass(Rl);var Ml=function(t){function n(e){var n=t.call(this,e)||this;if(n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new sa("GRUCell does not support reset_after parameter set to true.");return n.units=e.units,Ia(n.units,"units"),n.activation=Qu(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=Qu(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=Vo(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Vo(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Vo(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=ol(e.kernelRegularizer),n.recurrentRegularizer=ol(e.recurrentRegularizer),n.biasRegularizer=ol(e.biasRegularizer),n.kernelConstraint=Ba(e.kernelConstraint),n.recurrentConstraint=Ba(e.recurrentConstraint),n.biasConstraint=Ba(e.biasConstraint),n.dropout=no([1,ro([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=no([1,ro([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.dropoutFunc=e.dropoutFunc,n.implementation=e.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(n,t),n.prototype.build=function(t){var e=(t=$o(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){if(2!==(t=t).length)throw new sa("GRUCell expects 2 input Tensors (inputs, h, c), got "+t.length+".");var e=null!=n.training&&n.training,a=t[1];t=t[0],0<i.dropout&&i.dropout<1&&null==i.dropoutMask&&(i.dropoutMask=Wl({ones:function(){return r.onesLike(t)},rate:i.dropout,training:e,count:3,dropoutFunc:i.dropoutFunc})),0<i.recurrentDropout&&i.recurrentDropout<1&&null==i.recurrentDropoutMask&&(i.recurrentDropoutMask=Wl({ones:function(){return r.onesLike(a)},rate:i.recurrentDropout,training:e,count:3,dropoutFunc:i.dropoutFunc}));var o,s,u,c=i.dropoutMask,h=i.recurrentDropoutMask;0<i.dropout&&i.dropout<1&&(t=r.mul(t,c[0]));var p=go(t,i.kernel.read());i.useBias&&(p=bo(p,i.bias.read())),0<i.recurrentDropout&&i.recurrentDropout<1&&(a=r.mul(a,h[0]));var f=i.recurrentKernel.read(),d=l(r.split(f,[2*i.units,i.units],f.rank-1),2),g=d[0],y=d[1],v=go(a,g),m=l(r.split(p,3,p.rank-1),3),b=m[0],w=m[1],k=m[2],x=l(r.split(v,2,v.rank-1),2),S=x[0],N=x[1];o=i.recurrentActivation.apply(r.add(b,S)),s=i.recurrentActivation.apply(r.add(w,N));var z=go(r.mul(s,a),y);u=i.activation.apply(r.add(k,z));var I=r.add(r.mul(o,a),r.mul(r.add(1,r.neg(o)),u));return[I,I]}))},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={units:this.units,activation:Xu(this.activation),recurrentActivation:Xu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Wo(this.kernelInitializer),recurrentInitializer:Wo(this.recurrentInitializer),biasInitializer:Wo(this.biasInitializer),kernelRegularizer:il(this.kernelRegularizer),recurrentRegularizer:il(this.recurrentRegularizer),biasRegularizer:il(this.biasRegularizer),activityRegularizer:il(this.activityRegularizer),kernelConstraint:Ra(this.kernelConstraint),recurrentConstraint:Ra(this.recurrentConstraint),biasConstraint:Ra(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,n)},n}(_l);Ml.className="GRUCell",e.serialization.registerClass(Ml);var Bl=function(t){function n(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ml(e),t.call(this,e)||this}return a(n,t),n.prototype.call=function(n,i){var a=this;return e.tidy((function(){null!=a.cell.dropoutMask&&(r.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),null!=a.cell.recurrentDropoutMask&&(r.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var e=null==i?null:i.mask,o=null==i?null:i.training,s=null==i?null:i.initialState;return t.prototype.call.call(a,n,{mask:e,training:o,initialState:s})}))},n.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},n}(Ll);Bl.className="GRU",e.serialization.registerClass(Bl);var Pl=function(t){function n(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,Ia(n.units,"units"),n.activation=Qu(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=Qu(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=Vo(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Vo(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Vo(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=e.unitForgetBias,n.kernelRegularizer=ol(e.kernelRegularizer),n.recurrentRegularizer=ol(e.recurrentRegularizer),n.biasRegularizer=ol(e.biasRegularizer),n.kernelConstraint=Ba(e.kernelConstraint),n.recurrentConstraint=Ba(e.recurrentConstraint),n.biasConstraint=Ba(e.biasConstraint),n.dropout=no([1,ro([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=no([1,ro([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.dropoutFunc=e.dropoutFunc,n.implementation=e.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(n,t),n.prototype.build=function(t){var e,n,r=(t=$o(t))[t.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var i=this.biasInitializer,o=this.units;n=new((e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){var n=i.apply([o]),r=(new Io).apply([o]),a=i.apply([2*o]);return ho(ho(n,r),a)},e}(No)).className="CustomInit",e)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var e=null!=n.training&&n.training;if(3!==(t=t).length)throw new sa("LSTMCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");var a=t[1],o=t[2];t=t[0],0<i.dropout&&i.dropout<1&&null==i.dropoutMask&&(i.dropoutMask=Wl({ones:function(){return r.onesLike(t)},rate:i.dropout,training:e,count:4,dropoutFunc:i.dropoutFunc})),0<i.recurrentDropout&&i.recurrentDropout<1&&null==i.recurrentDropoutMask&&(i.recurrentDropoutMask=Wl({ones:function(){return r.onesLike(a)},rate:i.recurrentDropout,training:e,count:4,dropoutFunc:i.dropoutFunc}));var s,u,c,h,p=i.dropoutMask,f=i.recurrentDropoutMask;0<i.dropout&&i.dropout<1&&(t=r.mul(t,p[0]));var d=go(t,i.kernel.read());0<i.recurrentDropout&&i.recurrentDropout<1&&(a=r.mul(a,f[0])),d=r.add(d,go(a,i.recurrentKernel.read())),i.useBias&&(d=bo(d,i.bias.read()));var g=l(r.split(d,4,d.rank-1),4),y=g[0],v=g[1],m=g[2],b=g[3];s=i.recurrentActivation.apply(y),u=i.recurrentActivation.apply(v),c=r.add(r.mul(u,o),r.mul(s,i.activation.apply(m))),h=i.recurrentActivation.apply(b);var w=r.mul(h,i.activation.apply(c));return[w,w,c]}))},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={units:this.units,activation:Xu(this.activation),recurrentActivation:Xu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Wo(this.kernelInitializer),recurrentInitializer:Wo(this.recurrentInitializer),biasInitializer:Wo(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:il(this.kernelRegularizer),recurrentRegularizer:il(this.recurrentRegularizer),biasRegularizer:il(this.biasRegularizer),activityRegularizer:il(this.activityRegularizer),kernelConstraint:Ra(this.kernelConstraint),recurrentConstraint:Ra(this.recurrentConstraint),biasConstraint:Ra(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,n)},n}(_l);Pl.className="LSTMCell",e.serialization.registerClass(Pl);var Ul=function(t){function n(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Pl(e),t.call(this,e)||this}return a(n,t),n.prototype.call=function(n,i){var a=this;return e.tidy((function(){null!=a.cell.dropoutMask&&(r.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),null!=a.cell.recurrentDropoutMask&&(r.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var e=null==i?null:i.mask,o=null==i?null:i.training,s=null==i?null:i.initialState;return t.prototype.call.call(a,n,{mask:e,training:o,initialState:s})}))},n.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},n}(Ll);Ul.className="LSTM",e.serialization.registerClass(Ul);var jl=function(t){function n(e){var n=t.call(this,e)||this;return n.cells=e.cells,n}return a(n,t),Object.defineProperty(n.prototype,"stateSize",{get:function(){var t,e,n=[];try{for(var r=u(this.cells.slice().reverse()),i=r.next();!i.done;i=r.next()){var a=i.value;Array.isArray(a.stateSize)?n.push.apply(n,c(a.stateSize)):n.push(a.stateSize)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},enumerable:!0,configurable:!0}),n.prototype.call=function(t,n){var r=this;return e.tidy((function(){var e,i,a,o,s=(t=t).slice(1),l=[];try{for(var h=u(r.cells.slice().reverse()),p=h.next();!p.done;p=h.next()){var f=p.value;Array.isArray(f.stateSize)?l.push(s.splice(0,f.stateSize.length)):l.push(s.splice(0,1))}}catch(t){e={error:t}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(e)throw e.error}}l.reverse();for(var d,g=[],y=0;y<r.cells.length;++y){f=r.cells[y];s=l[y],d=0===y?[t[0]].concat(s):[d[0]].concat(s),d=f.call(d,n),g.push(d.slice(1))}s=[];try{for(var v=u(g.slice().reverse()),m=v.next();!m.done;m=v.next()){var b=m.value;s.push.apply(s,c(b))}}catch(t){a={error:t}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}return[d[0]].concat(s)}))},n.prototype.build=function(t){var e;Jo(t)&&(t=t[0]),t=t,this.cells.forEach((function(n,r){Ya("RNNCell_"+r,(function(){n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={cells:this.cells.map((function(t){return{className:t.getClassName(),config:t.getConfig()}}))};return Object.assign({},e,n)},n.fromConfig=function(t,e,n){var r,i;void 0===n&&(n={});var a=[];try{for(var o=u(e.cells),s=o.next();!s.done;s=o.next()){var l=s.value;a.push(Ns(l,n))}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return new t({cells:a})},Object.defineProperty(n.prototype,"trainableWeights",{get:function(){var t,e;if(!this.trainable)return[];var n=[];try{for(var r=u(this.cells),i=r.next();!i.done;i=r.next()){var a=i.value;n.push.apply(n,c(a.trainableWeights))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nonTrainableWeights",{get:function(){var t,e,n,r,i=[];try{for(var a=u(this.cells),o=a.next();!o.done;o=a.next()){var s=o.value;i.push.apply(i,c(s.nonTrainableWeights))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var h=u(this.cells),p=h.next();!p.done;p=h.next()){s=p.value;l.push.apply(l,c(s.trainableWeights))}}catch(t){n={error:t}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return l.concat(i)}return i},enumerable:!0,configurable:!0}),n.prototype.getWeights=function(){var t,e,n=[];try{for(var r=u(this.cells),i=r.next();!i.done;i=r.next()){var a=i.value;n.push.apply(n,c(a.weights))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return ns(n)},n.prototype.setWeights=function(t){var e,n,r=[];try{for(var i=u(this.cells),a=i.next();!a.done;a=i.next())for(var o=a.value,s=o.weights.length,l=t.splice(s),c=0;c<o.weights.length;++c)r.push([o.weights[c],l[c]])}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}rs(r)},n}(_l);function Wl(t){var e=t.ones,n=t.rate,i=t.training,a=void 0!==i&&i,o=t.count,s=void 0===o?1:o,u=t.dropoutFunc,l=function(){return null!=u?u(e(),n):wo(e(),n)},c=function(){return ko(l,e,a)};return!s||s<=1?r.keep(c().clone()):Array(s).fill(void 0).map(c).map((function(t){return r.keep(t.clone())}))}jl.className="StackedRNNCells",e.serialization.registerClass(jl);var Vl=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}a(e,t)}(_l);var ql=function(t){function n(e){var n=this;if(e.unroll)throw new ua("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ua("It is not possible at the moment to stack convolutional cells.");return(n=t.call(this,e)||this).inputSpec=[new is({ndim:5})],n}return a(n,t),n.prototype.call=function(e,n){var i=this;return r.tidy((function(){if(null!=i.cell.dropoutMask&&(r.dispose(i.cell.dropoutMask),i.cell.dropoutMask=null),null!=i.cell.recurrentDropoutMask&&(r.dispose(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null),n&&n.constants)throw new sa("ConvRNN2D cell does not support constants");var a=null==n?null:n.mask,o=null==n?null:n.training,s=null==n?null:n.initialState;return t.prototype.call.call(i,e,{mask:a,training:o,initialState:s})}))},n.prototype.computeOutputShape=function(t){var e=this.computeSingleOutputShape(t);return this.returnSequences||(e=c([e[0]],e.slice(2))),this.returnState&&(e=c([e],Array(2).fill(c([t[0]],e.slice(-3))))),e},n.prototype.getInitialState=function(t){var e=this;return r.tidy((function(){var n=e.cell.stateSize,i=t.shape,a=e.computeSingleOutputShape(i),o=c([a[0]],a.slice(2)),s=r.zeros(o);return Array.isArray(n)?Array(n.length).fill(s):[s]}))},n.prototype.resetStates=function(t,n){var i=this;void 0===n&&(n=!1),r.tidy((function(){if(!i.stateful)throw new aa("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=i.inputSpec[0].shape,o=i.computeSingleOutputShape(a),s=c([o[0]],o.slice(2));if(null==a[0])throw new sa("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==i.getStates())Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map((function(){return r.zeros(s)})):i.states_=[r.zeros(s)];else if(null==t)r.dispose(i.states_),null!=i.keptStates&&(r.dispose(i.keptStates),i.keptStates=[]),Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map((function(){return r.zeros(s)})):i.states_[0]=r.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==i.states_.length)throw new sa("Layer "+i.name+" expects "+i.states_.length+" state(s), but it received "+t.length+" state value(s). Input received: "+t);n?i.keptStates.push(i.states_.slice()):r.dispose(i.states_);for(var u=0;u<i.states_.length;++u){var l=t[u],h=s;if(!e.util.arraysEqual(l.shape,h))throw new sa("State "+u+" is incompatible with layer "+i.name+": expected shape="+h+", received shape="+l.shape);i.states_[u]=l}}i.states_=i.states_.map((function(t){return r.keep(t.clone())}))}))},n.prototype.computeSingleOutputShape=function(t){var e=this.cell,n=e.dataFormat,r=e.filters,i=e.kernelSize,a=e.padding,o=e.strides,s=e.dilationRate,u="channelsFirst"===n,l=t[u?3:2],h=t[u?4:3],p=dl(l,i[0],a,o[0],s[0]),f=dl(h,i[1],a,o[1],s[1]);return c(t.slice(0,2),u?[r,p,f]:[p,f,r])},n}(Ll);ql.className="ConvRNN2D";var Kl=function(t){function e(e){var n=this,r=e.filters,i=e.kernelSize,a=e.strides,o=e.padding,s=e.dataFormat,u=e.dilationRate;return(n=t.call(this,Object.assign({},e,{units:r}))||this).filters=r,Ia(n.filters,"filters"),n.kernelSize=fl(i,2,"kernelSize"),n.kernelSize.forEach((function(t){return Ia(t,"kernelSize")})),n.strides=fl(a||1,2,"strides"),n.strides.forEach((function(t){return Ia(t,"strides")})),n.padding=o||"valid",Ha(n.padding),n.dataFormat=s||"channelsLast",Ga(n.dataFormat),n.dilationRate=fl(u||1,2,"dilationRate"),n.dilationRate.forEach((function(t){return Ia(t,"dilationRate")})),n}return a(e,t),e.prototype.build=function(t){var e;t=$o(t);var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new sa("The channel dimension of the input should be defined. Found "+t[n]);var i=t[n],o=this.kernelSize.concat([i,4*this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var s=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var u=void 0;if(this.unitForgetBias){var l=this.biasInitializer,c=this.filters;u=new((e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){return co([l.apply([c]),r.ones([c]),l.apply([2*c])])},e}(No)).className="CustomInit",e)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,e){var n=this;return r.tidy((function(){if(3!==t.length)throw new sa("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");var i=e.training||!1,a=t[0],o=t[1],s=t[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Wl({ones:function(){return r.onesLike(a)},rate:n.dropout,training:i,count:4,dropoutFunc:n.dropoutFunc}));var u=n.dropoutMask,c=function(t,e,n){return e&&e[n]?r.mul(e[n],t):t},h=c(a,u,0),p=c(a,u,1),f=c(a,u,2),d=c(a,u,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Wl({ones:function(){return r.onesLike(o)},rate:n.recurrentDropout,training:i,count:4,dropoutFunc:n.dropoutFunc}));var g=n.recurrentDropoutMask,y=c(o,g,0),v=c(o,g,1),m=c(o,g,2),b=c(o,g,3),w=l(r.split(n.kernel.read(),4,3),4),k=w[0],x=w[1],S=w[2],N=w[3],z=l(n.useBias?r.split(n.bias.read(),4):[null,null,null,null],4),I=z[0],A=z[1],T=z[2],C=z[3];h=n.inputConv(h,k,I,n.padding),p=n.inputConv(p,x,A,n.padding),f=n.inputConv(f,S,T,n.padding),d=n.inputConv(d,N,C,n.padding);var E=l(r.split(n.recurrentKernel.read(),4,3),4),F=E[0],D=E[1],L=E[2],_=E[3];y=n.recurrentConv(y,F),v=n.recurrentConv(v,D),m=n.recurrentConv(m,L),b=n.recurrentConv(b,_);var O=n.recurrentActivation.apply(r.add(h,y)),R=n.recurrentActivation.apply(r.add(p,v)),M=r.add(r.mul(R,s),r.mul(O,n.activation.apply(r.add(f,m)))),B=r.mul(n.recurrentActivation.apply(r.add(d,b)),n.activation.apply(M));return[B,B,M]}))},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.units;var n=Vl(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,r)},e.prototype.inputConv=function(t,e,n,i){var a=r.conv2d(t,e,this.strides,i||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?bo(a,n,this.dataFormat):a},e.prototype.recurrentConv=function(t,e){return r.conv2d(t,e,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")},e}(Pl);Kl.className="ConvLSTM2DCell",r.serialization.registerClass(Kl);var Gl=function(t){function e(e){var n=new Kl(e);return t.call(this,Object.assign({},e,{cell:n}))||this}return a(e,t),e.fromConfig=function(t,e){return new t(e)},e}(ql);Gl.className="ConvLSTM2D",r.serialization.registerClass(Gl);var Hl=function(t){function n(e){var n=t.call(this,e)||this;return n.rate=Math.max(Math.min(e.rate,1),0),n.noiseShape=e.noiseShape,n.seed=e.seed,n.supportsMasking=!0,n}return a(n,t),n.prototype.getNoiseShape=function(t){if(null==this.noiseShape)return this.noiseShape;for(var e=t.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?e[r]:this.noiseShape[r]);return n},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var e=Xo(t);if(0<r.rate&&r.rate<1){var i=null!=n.training&&n.training,a=r.getNoiseShape(e);return ko((function(){return wo(e,r.rate,a,r.seed)}),(function(){return e}),i)}return t}))},n.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n.prototype.dispose=function(){return t.prototype.dispose.call(this)},n}(ls);Hl.className="Dropout",e.serialization.registerClass(Hl);var Zl=function(t){function e(e){var n=t.call(this,e)||this;return n.inputSpec=[{ndim:3}],n}return a(e,t),e.prototype.getNoiseShape=function(t){var e=t.shape;return[e[0],1,e[2]]},e}(Hl);Zl.className="SpatialDropout1D",e.serialization.registerClass(Zl);var Jl=function(t){function n(e){var n=t.call(this,e)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var r=null;null!=e.batchSize&&(r=e.batchSize),n.batchInputShape=[r,e.inputDim]}return n.units=e.units,Ia(n.units,"units"),n.activation=Qu(e.activation),null!=e.useBias&&(n.useBias=e.useBias),n.kernelInitializer=Vo(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Vo(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Ba(e.kernelConstraint),n.biasConstraint=Ba(e.biasConstraint),n.kernelRegularizer=ol(e.kernelRegularizer),n.biasRegularizer=ol(e.biasRegularizer),n.activityRegularizer=ol(e.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return a(n,t),n.prototype.build=function(t){var e,n=(t=$o(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(e={},e[-1]=n,e)}],this.built=!0},n.prototype.computeOutputShape=function(t){var e=(t=$o(t)).slice();return e[e.length-1]=this.units,e},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var e,i=Xo(t),a=Ta(r.activation.getClassName());return null!=a?e=go(i,r.kernel.read(),a,r.bias?r.bias.read():null):(e=go(i,r.kernel.read()),null!=r.bias&&(e=bo(e,r.bias.read())),null!=r.activation&&(e=r.activation.apply(e))),e}))},n.prototype.getConfig=function(){var e={units:this.units,activation:Xu(this.activation),useBias:this.useBias,kernelInitializer:Wo(this.kernelInitializer),biasInitializer:Wo(this.biasInitializer),kernelRegularizer:il(this.kernelRegularizer),biasRegularizer:il(this.biasRegularizer),activityRegularizer:il(this.activityRegularizer),kernelConstraint:Ra(this.kernelConstraint),biasConstraint:Ra(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);Jl.className="Dense",e.serialization.registerClass(Jl);var Yl=function(t){function n(e){var n=this;return e=e||{},(n=t.call(this,e)||this).inputSpec=[{minNDim:3}],n.dataFormat=e.dataFormat,n}return a(n,t),n.prototype.computeOutputShape=function(t){var e,n;t=$o(t);try{for(var r=u(t.slice(1)),i=r.next();!i.done;i=r.next()){if(null==i.value)throw new sa('The shape of the input to "Flatten" is not fully defined (got '+t.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return[t[0],eo(t,1)]},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){i.invokeCallHook(t,n);var a=Xo(t);if("channelsFirst"===i.dataFormat&&a.rank>1){for(var o=[0],s=2;s<a.rank;++s)o.push(s);o.push(1),a=e.transpose(a,o)}return function(t){if(t.rank<=1)throw new sa("batchFlatten requires a minimum rank of 2. Got rank: "+t.rank+".");var e=[t.shape[0],eo(t.shape,1)];return r.reshape(t,e)}(a)}))},n.prototype.getConfig=function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);Yl.className="Flatten",e.serialization.registerClass(Yl);var Xl=function(t){function n(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.activation=Qu(e.activation),n}return a(n,t),n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var e=Xo(t);return r.activation.apply(e)}))},n.prototype.getConfig=function(){var e={activation:Xu(this.activation)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);Xl.className="Activation",e.serialization.registerClass(Xl);var $l=function(t){function n(e){var n=t.call(this,e)||this;return n.n=e.n,n.inputSpec=[{ndim:2}],n}return a(n,t),n.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){return t=Xo(t),n=t,i=r.n,e.tidy((function(){if(2!==n.shape.length)throw new sa("repeat() expects a rank-2 tensor, but received a rank-"+n.shape.length+" tensor.");return po(oo(n,1),[1,i,1])}));var n,i}))},n.prototype.getConfig=function(){var e={n:this.n},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);$l.className="RepeatVector",e.serialization.registerClass($l);var Ql=function(t){function n(e){var n=t.call(this,e)||this;n.targetShape=e.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return a(n,t),n.prototype.isUnknown=function(t){return t<0||null==t},n.prototype.fixUnknownDimension=function(t,e){for(var n="Total size of new array must be unchanged.",r=e.slice(),i=1,a=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==a)throw new sa("Can only specifiy one unknown dimension.");a=o}else i*=s}var u=eo(t);if(null!==a){if(0===i||u%i!=0)throw new sa(n);r[a]=u/i}else if(u!==i)throw new sa(n);return r},n.prototype.computeOutputShape=function(t){for(var e=!1,n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var i=Xo(t),a=i.shape,o=a.slice(0,1).concat(r.fixUnknownDimension(a.slice(1),r.targetShape));return e.reshape(i,o)}))},n.prototype.getConfig=function(){var e={targetShape:this.targetShape},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);Ql.className="Reshape",e.serialization.registerClass(Ql);var tc=function(t){function n(n){var r=t.call(this,n)||this;if(null==n.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(n.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+n.dims+" instead.");var i=io(1,n.dims.length+1);if(!e.util.arraysEqual(n.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(n.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=n.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new is({ndim:r.dims.length+1})],r}return a(n,t),n.prototype.computeOutputShape=function(t){var e=(t=$o(t)).slice();return this.dims.forEach((function(n,r){e[r+1]=t[n]})),e},n.prototype.call=function(t,n){return e.transpose(Xo(t),this.dimsIncludingBatch)},n.prototype.getConfig=function(){var e={dims:this.dims},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);tc.className="Permute",e.serialization.registerClass(tc);var ec=function(t){function n(e){var n=t.call(this,null==e?{}:e)||this;return n.supportsMasking=!0,n.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,n}return a(n,t),n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,e),n},n.prototype.computeMask=function(t,n){var r=Xo(t);return e.any(e.notEqual(r,this.maskValue),-1)},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var i=Xo(t),a=e.any(e.notEqual(i,r.maskValue),-1,!0);return e.mul(i,e.cast(a,i.dtype))}))},n}(ls);ec.className="Masking",e.serialization.registerClass(ec);var nc=function(t){function n(e){var n=t.call(this,e)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var r=null;null!=e.batchSize&&(r=e.batchSize),null==e.inputLength?n.batchInputShape=[r,null]:n.batchInputShape=[r].concat(da(e.inputLength))}return n.inputDim=e.inputDim,Ia(n.inputDim,"inputDim"),n.outputDim=e.outputDim,Ia(n.outputDim,"outputDim"),n.embeddingsInitializer=Vo(e.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=ol(e.embeddingsRegularizer),n.activityRegularizer=ol(e.activityRegularizer),n.embeddingsConstraint=Ba(e.embeddingsConstraint),n.maskZero=e.maskZero,n.supportsMasking=e.maskZero,n.inputLength=e.inputLength,n}return a(n,t),n.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},n.prototype.warnOnIncompatibleInputShape=function(t){},n.prototype.computeMask=function(t,n){var r=this;return e.tidy((function(){return r.maskZero?(t=Xo(t),e.notEqual(t,e.zerosLike(t))):null}))},n.prototype.computeOutputShape=function(t){if(t=$o(t),null==this.inputLength)return c(t,[this.outputDim]);var e=da(this.inputLength);if(e.length!==t.length-1)throw new sa('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);for(var n=0,r=0;r<e.length;++r){var i=e[r],a=t[r+1];if(null!=i&&null!=a&&i!==a)throw new sa('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);null==i&&(e[n]=a),n++}return c([t[0]],e,[this.outputDim])},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var i=Xo(t);"int32"!==i.dtype&&(i=ao(i,"int32"));var a=yo(r.embeddings.read(),e.reshape(i,[i.size]));return e.reshape(a,$o(r.computeOutputShape(i.shape)))}))},n.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Wo(this.embeddingsInitializer),embeddingsRegularizer:il(this.embeddingsRegularizer),activityRegularizer:il(this.activityRegularizer),embeddingsConstraint:Ra(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);nc.className="Embedding",e.serialization.registerClass(nc);var rc=function(t){function n(e){var n=t.call(this,e||{})||this;return n.supportsMasking=!0,n}return a(n,t),n.prototype.mergeFunction=function(t){throw new ua},n.prototype.computeElementwiseOpOutputShape=function(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;for(var n=t.slice(0,t.length-e.length),r=0;r<e.length;++r){var i=t[t.length-e.length+r],a=e[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new sa("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n},n.prototype.build=function(t){var e,n;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[$o(t)]),(t=t).length<2)throw new sa("A merge layer should be called on an Array of at least 2 inputs. Got "+t.length+" input(s).");var r=[];try{for(var i=u(t),a=i.next();!a.done;a=i.next()){null!=(l=a.value)&&null!==l[0]&&r.push(l[0])}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}if((r=xa(r)).length>1)throw new sa("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(t)+".");for(var o=null==t[0]?null:t[0].slice(1),s=1;s<t.length;++s){var l=null==t[s]?null:t[s].slice(1);o=this.computeElementwiseOpOutputShape(o,l)}var c=t.map((function(t){return t.length}));-1===t.indexOf(null)&&1===xa(c).length?this.reshapeRequired=!1:this.reshapeRequired=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var e,n,a,o;if(t=t,i.reshapeRequired){var s=[],l=t.map((function(t){return t.rank}));if(-1===l.indexOf(null)){var c=ro(l);try{for(var h=u(t),p=h.next();!p.done;p=h.next()){for(var f=(m=p.value).rank,d=0;d<c-f;++d)m=oo(m,1);s.push(m)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}return i.mergeFunction(s)}var g=!1;try{for(var y=u(t),v=y.next();!v.done;v=y.next()){var m;if(null==(f=(m=v.value).rank)){var b=m.shape,w=b[0],k=b.slice(1).concat([w]),x=r.reshape(m,[w].concat(eo(b.slice(1))));x=r.transpose(x,[1,0]),x=r.reshape(x,k),s.push(x),g=!0}else if(f>1){var S=io(1,f).concat([0]);s.push(r.transpose(m,S)),g=!0}else s.push(m)}}catch(t){a={error:t}}finally{try{v&&!v.done&&(o=y.return)&&o.call(y)}finally{if(a)throw a.error}}var N=i.mergeFunction(s),z=N.rank;if(g)if(null==z){var I=N.shape;k=[w=I[I.length-1]].concat(I.slice(0,I.length-1));N=r.reshape(r.transpose(r.reshape(N,[-1,w]),[1,0]),k)}else if(z>1){S=[z-1].concat(io(0,z-1));N=r.transpose(N,S)}return N}return i.mergeFunction(t)}))},n.prototype.computeOutputShape=function(t){var e,n,r;r=null==(t=t)[0]?null:t[0].slice(1);for(var i=1;i<t.length;++i){var a=null==t[i]?null:t[i].slice(1);r=this.computeElementwiseOpOutputShape(r,a)}var o=[];try{for(var s=u(t),l=s.next();!l.done;l=s.next()){null!=(a=l.value)&&null!==a[0]&&o.push(a[0])}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return r=1===(o=xa(o)).length?o.concat(r):[null].concat(r)},n.prototype.computeMask=function(t,e){return r.tidy((function(){if(null==e)return null;if(!Array.isArray(e))throw new sa("`mask` should be an Array");if(!Array.isArray(t))throw new sa("`inputs` should be an Array");if(e.length!==t.length)throw new sa("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+t.length+" vs "+e.length+")");if(e.every((function(t){return null==t})))return null;for(var n=(e=e.map((function(t){return null==t?t:r.expandDims(t,0)})))[0],i=1;i<e.length-1;++i)n=r.logicalAnd(n,e[i]);return n}))},n}(ls),ic=function(t){function n(e){return t.call(this,e)||this}return a(n,t),n.prototype.mergeFunction=function(t){return e.tidy((function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=r.add(e,t[n]);return e}))},n}(rc);ic.className="Add",e.serialization.registerClass(ic);var ac=function(t){function n(e){return t.call(this,e)||this}return a(n,t),n.prototype.mergeFunction=function(t){return e.tidy((function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=r.mul(e,t[n]);return e}))},n}(rc);ac.className="Multiply",e.serialization.registerClass(ac);var oc=function(t){function n(e){return t.call(this,e)||this}return a(n,t),n.prototype.mergeFunction=function(t){return e.tidy((function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=r.add(e,t[n]);return r.mul(1/t.length,e)}))},n}(rc);oc.className="Average",e.serialization.registerClass(oc);var sc=function(t){function n(e){return t.call(this,e)||this}return a(n,t),n.prototype.mergeFunction=function(t){return e.tidy((function(){for(var e=t[0],n=1;n<t.length;++n)e=r.maximum(e,t[n]);return e}))},n}(rc);sc.className="Maximum",e.serialization.registerClass(sc);var uc=function(t){function n(e){return t.call(this,e)||this}return a(n,t),n.prototype.mergeFunction=function(t){return e.tidy((function(){for(var e=t[0],n=1;n<t.length;++n)e=r.minimum(e,t[n]);return e}))},n}(rc);uc.className="Minimum",e.serialization.registerClass(uc);var lc=function(t){function n(e){var n=t.call(this,e)||this;return n.DEFAULT_AXIS=-1,null==e&&(e={}),n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return a(n,t),n.prototype.build=function(t){var n,r,i,a;if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new sa("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var o=!0;try{for(var s=u(t),l=s.next();!l.done;l=s.next()){if(null!=(y=l.value)){o=!1;break}}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}if(!o){for(var c=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var f=!1;try{for(var d=(i=void 0,u(c)),g=d.next();!g.done;g=d.next()){var y=g.value;if(e.util.arraysEqual(y,p)){f=!0;break}}}catch(t){i={error:t}}finally{try{g&&!g.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}f||c.push(p)}if(c.length>1)throw new sa("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},n.prototype.mergeFunction=function(t){var n=this;return e.tidy((function(){return co(t,n.axis)}))},n.prototype.computeOutputShape=function(t){var e,n;if(!Array.isArray(t)||!Array.isArray(t[0]))throw new sa("A `Concatenate` layer should be called on a list of inputs.");var r=t,i=r[0].slice(),a=this.axis<0?i.length+this.axis:this.axis;try{for(var o=u(r.slice(1)),s=o.next();!s.done;s=o.next()){var l=s.value;if(null==i[a]||null==l[a]){i[a]=null;break}i[a]+=l[a]}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i},n.prototype.computeMask=function(t,e){var n=this;if(null==e)return null;if(!Array.isArray(e))throw new sa("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new sa("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new sa("Mismatch in the length of mask ("+e.length+") and the legnth of inputs ("+t.length+")");return r.tidy((function(){var i=!0;if(e.forEach((function(t){null==t||(i=!1)})),i)return null;for(var a=[],o=0;o<t.length;++o)null==e[o]?a.push(r.cast(r.onesLike(t[o]),"bool")):e[o].rank<t[o].rank?a.push(r.expandDims(e[o],-1)):a.push(e[o]);var s=r.concat(a,n.axis);return r.all(s,-1,!1)}))},n.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(rc);function cc(t,e){for(;t<0;)t+=e;return t}lc.className="Concatenate",e.serialization.registerClass(lc);var hc=function(t){function e(e){var n=t.call(this,e)||this;return n.axes=e.axes,n.normalize=null!=e.normalize&&e.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return a(e,t),e.prototype.build=function(t){r.util.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var e=t[0],n=t[1];if(e.length>3||n.length>3)throw new ua("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(e,n);if(e[i[0]]!==n[i[1]])throw new sa("Dimension incompatibility: "+e[i[0]]+" !== "+n[i[1]])},e.prototype.mergeFunction=function(t){if(2!==t.length)throw new sa("A `Dot` layer must be called on exactly 2 inputs, but received "+t.length+" input(s).");var e,n=t[0],i=t[1];return e=Array.isArray(this.axes)?this.axes.map((function(e,n){return cc(e,t[n].shape.length)})):[cc(this.axes,n.shape.length),cc(this.axes,i.shape.length)],this.normalize&&(n=zs(n,e[0]),i=zs(i,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new ua("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.util.assert(t.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got "+t.shape.length})),r.util.assert(t.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got "+e.shape.length})),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new ua("batchDot is not implemented for complex64-type Tensors yet.");var i=t.shape.length,a=e.shape.length;null==n&&(n=[i-1,a-2]);var o=n;return r.tidy((function(){var n,s;if(i>a){n=i-a;for(var u=[],l=0;l<n;++l)u.push(1);e=r.reshape(e,e.shape.concat(u))}else if(a>i){for(n=a-i,u=[],l=0;l<n;++l)u.push(1);t=r.reshape(t,t.shape.concat(u))}else n=0;if(2===t.shape.length&&2===e.shape.length)s=o[0]===o[1]?r.sum(r.mul(t,e),o[0]):r.sum(r.mul(r.transpose(t,[1,0]),e),o[1]);else{var c=o[0]!==t.shape.length-1,h=o[1]===e.shape.length-1;s=r.matMul(t,e,c,h)}if(n>0){var p=void 0,f=[];for(l=p=i>a?i+a-3:i-1;l<p+n;++l)f.push(l);s=r.squeeze(s,f)}return 1===s.shape.length&&(s=r.expandDims(s,1)),s}))}(n,i,e)},e.prototype.interpretAxes=function(t,e){return Array.isArray(this.axes)?this.axes:[cc(this.axes,t.length),cc(this.axes,e.length)]},e.prototype.computeOutputShape=function(t){r.util.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new ua("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(e,n);e.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);var a=e.concat(n);return 1===a.length&&a.push(1),a},e.prototype.computeMask=function(t,e){return null},e.prototype.getConfig=function(){var e={axes:this.axes,normalize:this.normalize},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(rc);hc.className="Dot",e.serialization.registerClass(hc);var pc=function(t){function n(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.stddev=e.stddev,n}return a(n,t),n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,e),n},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var i=Xo(t);return ko((function(){return e.add(fo(i.shape,0,r.stddev),i)}),(function(){return i}),n.training||!1)}))},n}(ls);pc.className="GaussianNoise",e.serialization.registerClass(pc);var fc=function(t){function n(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.rate=e.rate,n}return a(n,t),n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,e),n},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){r.invokeCallHook(t,n);var i=Xo(t);if(r.rate>0&&r.rate<1){return ko((function(){var t=Math.sqrt(r.rate/(1-r.rate));return e.mul(i,fo(i.shape,1,t))}),(function(){return i}),n.training||!1)}return i}))},n}(ls);fc.className="GaussianDropout",e.serialization.registerClass(fc);var dc=function(t){function n(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.rate=e.rate,n.noiseShape=e.noiseShape,n}return a(n,t),n.prototype._getNoiseShape=function(t){return this.noiseShape||Xo(t).shape},n.prototype.computeOutputShape=function(t){return t},n.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,e),n},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){if(r.rate<1&&r.rate>0){var i=r._getNoiseShape(t);return ko((function(){var n=Xo(t),a=-1.7580993408473766,o=e.greaterEqual(e.randomUniform(i),r.rate);o=ao(o,"float32");var s=Math.pow((1-r.rate)*(1+r.rate*Math.pow(a,2)),-.5),u=-s*a*r.rate,l=e.add(e.mul(n,o),e.mul(e.add(o,-1),a));return e.add(e.mul(l,s),u)}),(function(){return Xo(t)}),n.training||!1)}return t}))},n}(ls);function gc(t,e,n,i,a,o){var s;if(void 0===o&&(o=.001),2===t.rank)s=r.batchNorm2d(t,e,n,i,a,o);else if(3===t.rank)s=r.batchNorm3d(t,e,n,i,a,o);else{if(4!==t.rank)throw new ua("batchNormalization is not implemented for array of rank "+t.rank+" yet");s=r.batchNorm4d(t,e,n,i,a,o)}return s}function yc(t,n,i,a,o){return void 0===o&&(o=.001),e.util.arraysEqual(a.slice().sort(),io(0,t.rank-1))?function(t,n,i,a,o){return void 0===o&&(o=.001),e.tidy((function(){var e=r.moments(t,a),s=e.mean,u=e.variance;return[gc(t,s,u,i,n,o),s,u]}))}(t,n,i,a,o):function(t,n,i,a,o){return void 0===o&&(o=.001),e.tidy((function(){var s,l,c=r.moments(t,a),h=c.mean,p=c.variance,f=[];try{for(var d=u(io(0,t.rank)),g=d.next();!g.done;g=d.next()){var y=g.value;-1!==a.indexOf(y)?f.push(1):f.push(t.shape[y])}}catch(t){s={error:t}}finally{try{g&&!g.done&&(l=d.return)&&l.call(d)}finally{if(s)throw s.error}}var v=e.reshape(h,f),m=e.reshape(p,f),b=null==n?null:e.reshape(n,f),w=null==i?null:e.reshape(i,f);return[gc(t,v,m,w,b,o),h,p]}))}(t,n,i,a,o)}dc.className="AlphaDropout",e.serialization.registerClass(dc);var vc=function(t){function n(e){var n=this;return null==e&&(e={}),(n=t.call(this,e)||this).supportsMasking=!0,n.axis=null==e.axis?-1:e.axis,n.momentum=null==e.momentum?.99:e.momentum,n.epsilon=null==e.epsilon?.001:e.epsilon,n.center=null==e.center||e.center,n.scale=null==e.scale||e.scale,n.betaInitializer=Vo(e.betaInitializer||"zeros"),n.gammaInitializer=Vo(e.gammaInitializer||"ones"),n.movingMeanInitializer=Vo(e.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Vo(e.movingVarianceInitializer||"ones"),n.betaConstraint=Ba(e.betaConstraint),n.gammaConstraint=Ba(e.gammaConstraint),n.betaRegularizer=ol(e.betaRegularizer),n.gammaRegularizer=ol(e.gammaRegularizer),n}return a(n,t),n.prototype.build=function(t){var e;t=$o(t);var n=this.axis>=0?this.axis:this.axis+t.length,r=t[n];if(null==r)throw new sa("Axis "+n+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(t)+".");this.inputSpec=[new is({ndim:t.length,axes:(e={},e[n]=r,e)})];var i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var a=null!=n.training&&n.training,o=Xo(t),s=o.shape,u=s.length,c=io(0,u),h=i.axis>=0?i.axis:i.axis+u;c.splice(h,1);var p=ca(1,u);p[h]=s[h];var f=c.slice();f.sort();var d=!e.util.arraysEqual(f,io(0,u).slice(0,u-1));if(!a)return function(){if(d){var t=e.reshape(i.movingMean.read(),p),n=e.reshape(i.movingVariance.read(),p),r=i.center?e.reshape(i.beta.read(),p):null,a=i.scale?e.reshape(i.gamma.read(),p):null;return gc(o,t,n,r,a,i.epsilon)}return gc(o,i.movingMean.read(),i.movingVariance.read(),null==i.beta?null:i.beta.read(),null==i.gamma?null:i.gamma.read(),i.epsilon)}();var g=l(yc(o,i.gamma.read(),i.beta.read(),c,i.epsilon),3),y=g[0],v=g[1],m=g[2],b=function(t,e,n){r.tidy((function(){var i=1-n,a=t.read(),o=r.mul(r.sub(a,e),i);t.write(r.sub(a,o))}))};return b(i.movingMean,v,i.momentum),b(i.movingVariance,m,i.momentum),y}))},n.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Wo(this.betaInitializer),gammaInitializer:Wo(this.gammaInitializer),movingMeanInitializer:Wo(this.movingMeanInitializer),movingVarianceInitializer:Wo(this.movingVarianceInitializer),betaRegularizer:il(this.betaRegularizer),gammaRegularizer:il(this.gammaRegularizer),betaConstraint:Ra(this.betaConstraint),gammaConstraint:Ra(this.gammaConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);vc.className="BatchNormalization",e.serialization.registerClass(vc);var mc=function(t){function n(e){var n,r,i=this;if(null==e&&(e={}),(i=t.call(this,e)||this).axis=null==e.axis?-1:e.axis,"number"==typeof i.axis){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received "+i.axis)}else{if(!Array.isArray(i.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(i.axis));try{for(var a=u(i.axis),o=a.next();!o.done;o=a.next()){var s=o.value;if(!Number.isInteger(s))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(i.axis))}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}return i.epsilon=null==e.epsilon?.001:e.epsilon,i.center=null==e.center||e.center,i.scale=null==e.scale||e.scale,i.betaInitializer=Vo(e.betaInitializer||"zeros"),i.gammaInitializer=Vo(e.gammaInitializer||"ones"),i.betaRegularizer=ol(e.betaRegularizer),i.gammaRegularizer=ol(e.gammaRegularizer),i.supportsMasking=!0,i}return a(n,t),n.prototype.build=function(t){var e,n,r=(t=$o(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=r);try{for(var a=u(this.axis),o=a.next();!o.done;o=a.next()){var s=o.value;if(s<0||s>=r)throw new Error("Invalid axis: "+s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}if(this.axis.length!==xa(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var l=this.axis.map((function(e){return t[e]}));this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0},n.prototype.call=function(t,n){var i=this,a=Xo(t),o=a.shape,s=o.length;return e.tidy((function(){var t,n,l=e.moments(a,i.axis,!0),c=l.mean,h=l.variance,p=ca(1,s);try{for(var f=u(i.axis),d=f.next();!d.done;d=f.next()){var g=d.value;p[g]=o[g]}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}for(var y=function(t){return null!=t&&t.shape.length!==s?r.reshape(t,p):t},v=y(i.gamma.read()),m=y(i.beta.read()),b=[],w=[],k=0;k<s;++k)-1!==i.axis.indexOf(k)?(b.push(o[k]),w.push(1)):(b.push(1),w.push(o[k]));return c=r.tile(c,b),h=r.tile(h,b),v=r.tile(v,w),m=r.tile(m,w),gc(a,c,h,m,v,i.epsilon)}))},n.prototype.getConfig=function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Wo(this.betaInitializer),gammaInitializer:Wo(this.gammaInitializer),betaRegularizer:il(this.betaRegularizer),gammaRegularizer:il(this.gammaRegularizer)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);mc.className="LayerNormalization",e.serialization.registerClass(mc);var bc=function(t){function n(e){var n=this;if(null==e&&(e={}),(n=t.call(this,e)||this).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)n.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new sa("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var r=void 0,i=void 0;if("number"==typeof e.padding[0])r=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new sa("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(r=e.padding[0],2!==e.padding[1].length)throw new sa("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");i=e.padding[1]}n.padding=[r,i]}return n.inputSpec=[new is({ndim:4})],n}return a(n,t),n.prototype.computeOutputShape=function(t){var e,n;return t=$o(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){return n=Xo(t),a=i.padding,o=i.dataFormat,e.tidy((function(){if(4!==n.rank)throw new sa("temporalPadding expects input tensor to be 4-D, but received a "+n.rank+"-D tensor.");if(null==a&&(a=[[1,1],[1,1]]),2!==a.length||2!==a[0].length||2!==a[1].length)throw new sa("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==o&&(o="channelsLast"),"channelsLast"!==o&&"channelsFirst"!==o)throw new sa("Unknown data format: "+o+". Supported data formats are 'channelsLast' and 'channelsFirst.");var t;return t="channelsFirst"===o?[[0,0],[0,0],a[0],a[1]]:[[0,0],a[0],a[1],[0,0]],r.pad(n,t)}));var n,a,o}))},n.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls);function wc(t,n,i,a,o,s){return e.tidy((function(){var e;Ga(o),Za(s),Ha(a),null==i&&(i=[1,1]),null==a&&(a="valid"),null==o&&(o="channelsLast"),null==s&&(s="max"),t=yl(t,o);var u="same"===a?"same":"valid";return e="max"===s?r.maxPool(t,n,i,u):r.avgPool(t,n,i,u),"channelsFirst"===o&&(e=r.transpose(e,[0,3,1,2])),e}))}function kc(t,n,i,a,o,s){return e.tidy((function(){var e;Ga(o),Za(s),Ha(a),null==i&&(i=[1,1,1]),null==a&&(a="valid"),null==o&&(o="channelsLast"),null==s&&(s="max"),t=vl(t,o);var u="same"===a?"same":"valid";return e="max"===s?r.maxPool3d(t,n,i,u):r.avgPool3d(t,n,i,u),"channelsFirst"===o&&(e=r.transpose(e,[0,4,1,2,3])),e}))}bc.className="ZeroPadding2D",e.serialization.registerClass(bc);var xc=function(t){function n(e){var n=this;if(null==e.poolSize&&(e.poolSize=2),n=t.call(this,e)||this,"number"==typeof e.poolSize)n.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new sa("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));n.poolSize=e.poolSize}if(Ia(n.poolSize,"poolSize"),null==e.strides)n.strides=n.poolSize;else if("number"==typeof e.strides)n.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new sa("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));n.strides=e.strides}return Ia(n.strides,"strides"),n.padding=null==e.padding?"valid":e.padding,Ha(n.padding),n.inputSpec=[new is({ndim:3})],n}return a(n,t),n.prototype.computeOutputShape=function(t){var e=dl((t=$o(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){i.invokeCallHook(t,n),t=oo(Xo(t),2);var e=i.poolingFunction(Xo(t),[i.poolSize[0],1],[i.strides[0],1],i.padding,"channelsLast");return r.squeeze(e,[2])}))},n.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls),Sc=function(t){function e(e){return t.call(this,e)||this}return a(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Ga(i),Ha(r),wc(t,e,n,r,i,"max")},e}(xc);Sc.className="MaxPooling1D",e.serialization.registerClass(Sc);var Nc=function(t){function e(e){return t.call(this,e)||this}return a(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Ga(i),Ha(r),wc(t,e,n,r,i,"avg")},e}(xc);Nc.className="AveragePooling1D",e.serialization.registerClass(Nc);var zc=function(t){function n(e){var n=this;if(null==e.poolSize&&(e.poolSize=[2,2]),(n=t.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new sa("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");n.strides=e.strides}else n.strides=[e.strides,e.strides];return Ia(n.poolSize,"poolSize"),Ia(n.strides,"strides"),n.padding=null==e.padding?"valid":e.padding,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ga(n.dataFormat),Ha(n.padding),n.inputSpec=[new is({ndim:4})],n}return a(n,t),n.prototype.computeOutputShape=function(t){t=$o(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=dl(e,this.poolSize[0],this.padding,this.strides[0]),n=dl(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){return r.invokeCallHook(t,n),r.poolingFunction(Xo(t),r.poolSize,r.strides,r.padding,r.dataFormat)}))},n.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls),Ic=function(t){function e(e){return t.call(this,e)||this}return a(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Ga(i),Ha(r),wc(t,e,n,r,i,"max")},e}(zc);Ic.className="MaxPooling2D",e.serialization.registerClass(Ic);var Ac=function(t){function e(e){return t.call(this,e)||this}return a(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Ga(i),Ha(r),wc(t,e,n,r,i,"avg")},e}(zc);Ac.className="AveragePooling2D",e.serialization.registerClass(Ac);var Tc=function(t){function n(e){var n=this;if(null==e.poolSize&&(e.poolSize=[2,2,2]),(n=t.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new sa("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+e.strides.length+".");n.strides=e.strides}else n.strides=[e.strides,e.strides,e.strides];return Ia(n.poolSize,"poolSize"),Ia(n.strides,"strides"),n.padding=null==e.padding?"valid":e.padding,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ga(n.dataFormat),Ha(n.padding),n.inputSpec=[new is({ndim:5})],n}return a(n,t),n.prototype.computeOutputShape=function(t){t=$o(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[4]:t[3];return e=dl(e,this.poolSize[0],this.padding,this.strides[0]),n=dl(n,this.poolSize[1],this.padding,this.strides[1]),r=dl(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,r]:[t[0],e,n,r,t[4]]},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){return r.invokeCallHook(t,n),r.poolingFunction(Xo(t),r.poolSize,r.strides,r.padding,r.dataFormat)}))},n.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n}(ls),Cc=function(t){function e(e){return t.call(this,e)||this}return a(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Ga(i),Ha(r),kc(t,e,n,r,i,"max")},e}(Tc);Cc.className="MaxPooling3D",e.serialization.registerClass(Cc);var Ec=function(t){function e(e){return t.call(this,e)||this}return a(e,t),e.prototype.poolingFunction=function(t,e,n,r,i){return Ga(i),Ha(r),kc(t,e,n,r,i,"avg")},e}(Tc);Ec.className="AveragePooling3D",e.serialization.registerClass(Ec);var Fc=function(t){function e(e){var n=t.call(this,e)||this;return n.inputSpec=[new is({ndim:3})],n}return a(e,t),e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,e){throw new ua},e}(ls),Dc=function(t){function n(e){return t.call(this,e||{})||this}return a(n,t),n.prototype.call=function(t,n){return e.tidy((function(){var e=Xo(t);return r.mean(e,1)}))},n}(Fc);Dc.className="GlobalAveragePooling1D",e.serialization.registerClass(Dc);var Lc=function(t){function n(e){return t.call(this,e||{})||this}return a(n,t),n.prototype.call=function(t,n){return e.tidy((function(){var e=Xo(t);return r.max(e,1)}))},n}(Fc);Lc.className="GlobalMaxPooling1D",e.serialization.registerClass(Lc);var _c=function(t){function e(e){var n=t.call(this,e)||this;return n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ga(n.dataFormat),n.inputSpec=[new is({ndim:4})],n}return a(e,t),e.prototype.computeOutputShape=function(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,e){throw new ua},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(ls),Oc=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var e=Xo(t);return"channelsLast"===i.dataFormat?r.mean(e,[1,2]):r.mean(e,[2,3])}))},n}(_c);Oc.className="GlobalAveragePooling2D",e.serialization.registerClass(Oc);var Rc=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var e=Xo(t);return"channelsLast"===i.dataFormat?r.max(e,[1,2]):r.max(e,[2,3])}))},n}(_c);Rc.className="GlobalMaxPooling2D",e.serialization.registerClass(Rc);var Mc=function(t){function e(e){var n=t.call(this,e)||this;return n.layer=e.layer,n}return a(e,t),e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(t){null!=this.layer&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)},e.fromConfig=function(t,e,n){void 0===n&&(n={});var r=Ns(e.layer,n);delete e.layer;var i={layer:r};return Object.assign(i,e),new t(i)},e}(ls),Bc=function(t){function n(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n}return a(n,t),n.prototype.build=function(e){if((e=$o(e)).length<3)throw new sa("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),t.prototype.build.call(this,e)},n.prototype.computeOutputShape=function(t){var e=[(t=$o(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),r=t[1];return[n[0],r].concat(n.slice(1))},n.prototype.call=function(t,n){var r=this;return e.tidy((function(){return Dl((function(t,e){return[Xo(r.layer.call(t,n)),[]]}),t=Xo(t),[],!1,null,null,!1,!0)[1]}))},n}(Mc);Bc.className="TimeDistributed",e.serialization.registerClass(Bc);var Pc=function(t){function n(e){var n=t.call(this,e)||this,r=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=r,n.forwardLayer=Ns(i),r.goBackwards=!0!==r.goBackwards;var a,o={};if(o.className=e.layer.getClassName(),o.config=r,n.backwardLayer=Ns(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,a=n.mergeMode,Na(qa,"BidirectionalMergeMode",a),e.weights)throw new ua("weights support is not implemented for Bidirectional layer yet.");return n._stateful=e.layer.stateful,n.returnSequences=e.layer.returnSequences,n.returnState=e.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=e.layer.inputSpec,n.numConstants=null,n}return a(n,t),Object.defineProperty(n.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),n.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},n.prototype.setWeights=function(t){var e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))},n.prototype.computeOutputShape=function(t){var e,n,r,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),e=i[0]):e=i[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):fa(n)},n.prototype.apply=function(e,n){var r,i,a=null==n?null:n.initialState,o=null==n?null:n.constants;null==n&&(n={});var s=Fl(e,a,o,this.numConstants);if(e=s.inputs,a=s.initialState,o=s.constants,Array.isArray(e)&&(a=e.slice(1),e=e[0]),(null==a||0===a.length)&&null==o)return t.prototype.apply.call(this,e,n);var l=[],h=[];if(null!=a){var p=a.length;if(p%2>0)throw new sa("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=a,l.push.apply(l,c(a));var f=a.map((function(t){return new is({shape:t.shape})}));this.forwardLayer.stateSpec=f.slice(0,p/2),this.backwardLayer.stateSpec=f.slice(p/2),h.push.apply(h,c(f))}if(null!=o)throw new ua("Support for constants in Bidirectional layers is not implemented yet.");var d=l[0]instanceof as;try{for(var g=u(l),y=g.next();!y.done;y=g.next()){if(y.value instanceof as!==d)throw new sa("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(t){r={error:t}}finally{try{y&&!y.done&&(i=g.return)&&i.call(g)}finally{if(r)throw r.error}}if(d){var v=[e].concat(l),m=this.inputSpec.concat(h),b=this.inputSpec;this.inputSpec=m;var w=t.prototype.apply.call(this,v,n);return this.inputSpec=b,w}return t.prototype.apply.call(this,e,n)},n.prototype.call=function(t,n){var i=this;return e.tidy((function(){var e,a,o,s,u=n.initialState;if(null==u)e=i.forwardLayer.call(t,n),a=i.backwardLayer.call(t,n);else{var l=u.slice(0,u.length/2),c=u.slice(u.length/2);e=i.forwardLayer.call(t,Object.assign(n,{initialState:l})),a=i.backwardLayer.call(t,Object.assign(n,{initialState:c}))}return i.returnState&&(Array.isArray(e)&&(o=e.slice(1).concat(a.slice(1))),e=e[0],a=a[0]),i.returnSequences&&(a=r.reverse(a,1)),"concat"===i.mergeMode?s=co([e,a]):"sum"===i.mergeMode?s=r.add(e,a):"ave"===i.mergeMode?s=r.mul(.5,r.add(e,a)):"mul"===i.mergeMode?s=r.mul(e,a):null==i.mergeMode&&(s=[e,a]),i.returnState?null==i.mergeMode?s.concat(o):[s].concat(o):s}))},n.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},n.prototype.build=function(t){var e=this;Ya(this.forwardLayer.name,(function(){e.forwardLayer.build(t)})),Ya(this.backwardLayer.name,(function(){e.backwardLayer.build(t)})),this.built=!0},n.prototype.computeMask=function(t,e){var n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(t){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n},Object.defineProperty(n.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),n.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)},n.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},n.fromConfig=function(t,e){var n=Ns(e.layer);if(delete e.layer,null!=e.numConstants)throw new ua("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=e;return r.layer=n,new t(r)},n}(Mc);function Uc(t){return new Nc(t)}function jc(t){return new Ac(t)}function Wc(t){return new Ec(t)}function Vc(t){return new Lc(t)}function qc(t){return new Rc(t)}function Kc(t){return new Sc(t)}function Gc(t){return new Ic(t)}Pc.className="Bidirectional",e.serialization.registerClass(Pc);var Hc={__proto__:null,inputLayer:function(t){return new ps(t)},elu:function(t){return new cl(t)},reLU:function(t){return new sl(t)},leakyReLU:function(t){return new ul(t)},prelu:function(t){return new ll(t)},softmax:function(t){return new pl(t)},thresholdedReLU:function(t){return new hl(t)},conv1d:function(t){return new Al(t)},conv2d:function(t){return new kl(t)},conv2dTranspose:function(t){return new Sl(t)},conv3d:function(t){return new xl(t)},conv3dTranspose:function(t){return new Nl(t)},separableConv2d:function(t){return new Il(t)},cropping2D:function(t){return new Tl(t)},upSampling2d:function(t){return new Cl(t)},depthwiseConv2d:function(t){return new El(t)},activation:function(t){return new Xl(t)},dense:function(t){return new Jl(t)},dropout:function(t){return new Hl(t)},spatialDropout1d:function(t){return new Zl(t)},flatten:function(t){return new Yl(t)},repeatVector:function(t){return new $l(t)},reshape:function(t){return new Ql(t)},permute:function(t){return new tc(t)},embedding:function(t){return new nc(t)},add:function(t){return new ic(t)},average:function(t){return new oc(t)},concatenate:function(t){return new lc(t)},maximum:function(t){return new sc(t)},minimum:function(t){return new uc(t)},multiply:function(t){return new ac(t)},dot:function(t){return new hc(t)},batchNormalization:function(t){return new vc(t)},layerNormalization:function(t){return new mc(t)},zeroPadding2d:function(t){return new bc(t)},averagePooling1d:Uc,avgPool1d:function(t){return Uc(t)},avgPooling1d:function(t){return Uc(t)},averagePooling2d:jc,avgPool2d:function(t){return jc(t)},avgPooling2d:function(t){return jc(t)},averagePooling3d:Wc,avgPool3d:function(t){return Wc(t)},avgPooling3d:function(t){return Wc(t)},globalAveragePooling1d:function(t){return new Dc(t)},globalAveragePooling2d:function(t){return new Oc(t)},globalMaxPooling1d:Vc,globalMaxPooling2d:qc,maxPooling1d:Kc,maxPooling2d:Gc,maxPooling3d:function(t){return new Cc(t)},gru:function(t){return new Bl(t)},gruCell:function(t){return new Ml(t)},lstm:function(t){return new Ul(t)},lstmCell:function(t){return new Pl(t)},simpleRNN:function(t){return new Rl(t)},simpleRNNCell:function(t){return new Ol(t)},convLstm2d:function(t){return new Gl(t)},convLstm2dCell:function(t){return new Kl(t)},rnn:function(t){return new Ll(t)},stackedRNNCells:function(t){return new jl(t)},bidirectional:function(t){return new Pc(t)},timeDistributed:function(t){return new Bc(t)},globalMaxPool1d:Vc,globalMaxPool2d:qc,maxPool1d:Kc,maxPool2d:Gc,Layer:ls,RNN:Ll,RNNCell:_l,input:Ou,gaussianNoise:function(t){return new pc(t)},gaussianDropout:function(t){return new fc(t)},alphaDropout:function(t){return new dc(t)},masking:function(t){return new ec(t)}};var Zc={__proto__:null,binaryAccuracy:function(t,e){return Os(t,e)},binaryCrossentropy:function(t,e){return Us(t,e)},sparseCategoricalAccuracy:function(t,e){return js(t,e)},categoricalAccuracy:function(t,e){return Rs(t,e)},categoricalCrossentropy:function(t,e){return Ws(t,e)},precision:function(t,e){return Bs(t,e)},recall:function(t,e){return Ps(t,e)},cosineProximity:function(t,e){return Ds(t,e)},meanAbsoluteError:function(t,e){return As(t,e)},meanAbsolutePercentageError:function(t,e){return Ts(t,e)},MAPE:function(t,e){return Ts(t,e)},mape:function(t,e){return Ts(t,e)},meanSquaredError:function(t,e){return Is(t,e)},MSE:function(t,e){return Is(t,e)},mse:function(t,e){return Is(t,e)}},Jc={__proto__:null,modelFromJSON:function(t,n){return o(this,void 0,void 0,(function(){var r,i,a,o,l,c,h,p,f,d;return s(this,(function(s){switch(s.label){case 0:return"modelTopology"in t||(t={modelTopology:t}),null!=(r=(t=t).modelTopology).model_config&&(r=r.model_config),i=tu(r),a=Ns(i,n),null==t.weightsManifest?[3,2]:[4,e.io.loadWeights(t.weightsManifest,t.pathPrefix,a.weights.map((function(t){return t.originalName})))];case 1:o=s.sent(),l={};try{for(c=u(a.weights),h=c.next();!h.done;h=c.next())p=h.value,l[p.originalName]=o[p.originalName]}catch(t){f={error:t}}finally{try{h&&!h.done&&(d=c.return)&&d.call(c)}finally{if(f)throw f.error}}a.loadWeights(l),e.dispose(o),s.label=2;case 2:return[2,a]}}))}))}};var Yc={__proto__:null,l1l2:function(t){return new nl(t)},l1:function(t){return tl(e=t),new nl({l1:null!=e?e.l1:null,l2:0});var e},l2:function(t){return tl(e=t),new nl({l2:null!=e?e.l2:null,l1:0});var e}},Xc=function(t){function e(){var e=t.apply(this,c(arguments))||this;return e.model=null,e}return a(e,t),e.prototype.setModel=function(t){if(!(t instanceof Fu))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(ys);function $c(t,e){return t<e}function Qc(t,e){return t>e}var th=function(t){function e(e){var n=t.call(this)||this;if(null==e&&(e={}),e.restoreBestWeights)throw new ua("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=e.monitor||"val_loss",n.minDelta=Math.abs(e.minDelta||0),n.patience=e.patience||0,n.verbose=e.verbose||0,n.mode=e.mode||"auto",n.baseline=e.baseline,-1===["auto","min","max"].indexOf(n.mode)&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),"min"===n.mode?n.monitorFunc=$c:"max"===n.mode||-1!==n.monitor.indexOf("acc")?n.monitorFunc=Qc:n.monitorFunc=$c,n.monitorFunc===$c&&(n.minDelta*=-1),n}return a(e,t),e.prototype.onTrainBegin=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(t){return this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===$c?1/0:-1/0,[2]}))}))},e.prototype.onEpochEnd=function(t,e){return o(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,ds(e)];case 1:return r.sent(),null==(n=this.getMonitorValue(e))?[2]:(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}}))}))},e.prototype.onTrainEnd=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(t){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]}))}))},e.prototype.getMonitorValue=function(t){null==t&&(t={});var e=t[this.monitor];return null==e&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(t)),e},e}(Xc);var eh={earlyStopping:function(t){return new th(t)}};t.Callback=Xc,t.CallbackList=vs,t.CustomCallback=ws,t.EarlyStopping=th,t.History=bs,t.InputSpec=is,t.LayerVariable=es,t.LayersModel=Fu,t.RNN=Ll,t.Sequential=_u,t.SymbolicTensor=as,t.callbacks=eh,t.constraints=Pa,t.initializers=qo,t.input=Ou,t.layers=Hc,t.loadLayersModel=function(t,n){return null==n&&(n={}),function(t,n){return o(this,void 0,void 0,(function(){var r;return s(this,(function(i){if(null==n&&(n={}),"string"==typeof t){if(0===(r=e.io.getLoadHandlers(t,n)).length)r.push(e.io.browserHTTPRequest(t,n));else if(r.length>1)throw new sa("Found more than one ("+r.length+") load handlers for URL '"+t+"'");t=r[0]}return[2,Lu(t,void 0,n)]}))}))}(t,n)},t.metrics=Zc,t.model=function(t){return new Fu(t)},t.models=Jc,t.registerCallbackConstructor=function(t,e){xs.registerCallbackConstructor(t,e)},t.regularizers=Yc,t.sequential=function(t){return new _u(t)},t.version_layers=nu,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=tf-layers.min.js.map
